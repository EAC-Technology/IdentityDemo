<plugin author="" description="" guid="6787f2ab-39ff-4dbc-9d1a-04a6ee684857" name="IdentityDemo" picture="" version="">
	
	
	<custom_event>
		
	
		<name>loaddata</name>
		
	
		<guid>c957ee1c-d5a2-40c1-a04b-1bdbb74b710a</guid>
	</custom_event>
	
	
	<resource>
		
	
		<name>dialog_v2_callback.js</name>
		
	
		<res_source>Lyo9PT09PT09PT09PT09PT09PT09PT09PT09PQ0KZGlhbG9nX3YyX2NhbGxiYWNrIEpTIGZ1bmN0aW9ucw0KPT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8NCg0KDQpqUXVlcnkoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgew0KCSBqUXVlcnkoZTJ2ZG9tU1ZbJ0RpYWxvZ0dVSUQnXSkuZGlhbG9nKCdyZWdpc3RlckNhbGxiYWNrcycsIHsNCgkJCSdzZWxlY3RFbHRPZlBhdGgnIDogZnVuY3Rpb24oZGF0YSl7DQoJCQkJCQkJZXZhbCgnZGF0YT0nK2RhdGEpOw0KCQkJCQkJCWV4ZWNFdmVudEJpbmRlZCgnOGZhNjMyMzNfNjhjOF80M2VhXzg0ZmVfZDM2YTI1N2JlMWZiJywgJ2l0ZW1jbGljaycsIGRhdGEpOw0KCQkJfSwNCgkJCSdydW5Qcm9ncmVzcycgOiBmdW5jdGlvbigpewkJCQkJCQ0KCQkJCQkJJHRvcExvYWRlci5zZXRQcm9ncmVzcyhkYXRhKTsJCQkJCQkNCgkJCX0NCgkJfSkNCgl9DQopDQoNCg0KZnVuY3Rpb24gbG9naW4gKHRva2VuKSB7DQoJYXBpZGF0YSA9e307DQoNCgkkLnBvc3QoICJyZXN0YXBpLnB5IiwgeyANCgkJCQkJCQlhcHBpZDogImIwYTI3NGYwLTIyYmMtNDRiZS1iZTQ4LWRhNmVjOTE4MDI2OCIsIA0KCQkJCQkJCW9iamlkOiAiNTA3M2ZmNzUtZGE5OS00NGZiLWE1ZDctZTQ0ZTVhYjI4NTk4IiwgDQoJCQkJCQkJYWN0aW9uX25hbWU6ICJsb2dpbiIsDQoJCQkJCQkJeG1sX2RhdGEgOiAie1wibG9naW5cIjogXCJyb290XCIsIFwicGFzc3dvcmRcIjogXCJyb290XCJ9IiwgDQoJCQkJCQkJY2FsbGJhY2sgOiAicGFyc2VSZXR1cm4iIH0pDQoJCS5kb25lKGZ1bmN0aW9uKCBkYXRhICkgew0KCQkgICBldmFsKGRhdGEpOw0KICAgICAgICB9KTsNCn0NCg0KZnVuY3Rpb24gZ2V0QW5zd2VyKG9iamFuc3dlcikgew0KCWlmIChvYmphbnN3ZXJbMF0gPT0gInN1Y2Nlc3MiKSB7DQoJCXJldHVybiBvYmphbnN3ZXJbMV07DQoJfQ0KfQ0KDQpmdW5jdGlvbiBzaG93UHJvZ3Jlc3MoKSB7DQoJJCgnI3RvcExvYWRlcicpLmNzcygndmlzaWJpbGl0eScsJ3Zpc2libGUnKTsNCgl0b3BMb2FkZXJSdW5uaW5nID0gdHJ1ZTsNCn0NCg0KZnVuY3Rpb24gaGlkZVByb2dyZXNzKCkgew0KCSQoJyN0b3BMb2FkZXInKS5jc3MoJ3Zpc2liaWxpdHknLCdoaWRkZW4nKTsNCgl0b3BMb2FkZXJSdW5uaW5nID0gZmFsc2U7DQp9DQoNCmZ1bmN0aW9uIGdldFByb2dyZXNzKFByb2dyZXNzSUQpIHsNCglhcGlkYXRhID17fTsNCglhcGlkYXRhWyJwbHVnaW5fZ3VpZCJdID0gIjk1NTMzYTc0LWJiZTMtNDk2Mi05NDA1LTlhYTk2YTQwOTJjZCI7DQoJYXBpZGF0YVsiYXN5bmMiXT1mYWxzZTsNCglhcGlkYXRhWyJuYW1lIl09ImdldHByb2dyZXNzIjsNCglhcGlkYXRhWyJkYXRhIl09UHJvZ3Jlc3NJRDsNCgkNCgljbnhkYXRhID0geyANCgkJCQlhcHBpZDogImIwYTI3NGYwLTIyYmMtNDRiZS1iZTQ4LWRhNmVjOTE4MDI2OCIsIA0KCQkJCW9iamlkOiAiNTA3M2ZmNzUtZGE5OS00NGZiLWE1ZDctZTQ0ZTVhYjI4NTk4IiwgDQoJCQkJYWN0aW9uX25hbWU6ICJjYWxsX21hY3JvIiwNCgkJCQl4bWxfZGF0YSA6IEpTT04uc3RyaW5naWZ5KGFwaWRhdGEpLCANCgkJCQljYWxsYmFjayA6ICJnZXRBbnN3ZXIiIA0KCQkJfTsNCgkNCgkkLnBvc3QoICJyZXN0YXBpLnB5IiwgY254ZGF0YSApDQoJCS5kb25lKGZ1bmN0aW9uKCBkYXRhICkgew0KCQkJcHJvZ3Jlc3NEYXRhID0gSlNPTi5wYXJzZShldmFsKGRhdGEucmVwbGFjZSgiLyoqLyIsIiIpKSk7DQoJCQkkdG9wTG9hZGVyLnNldFZhbHVlKHByb2dyZXNzRGF0YVsibGFiZWwiXSk7DQoJCSAgICAkdG9wTG9hZGVyLnNldFByb2dyZXNzKHByb2dyZXNzRGF0YVsidmFsdWUiXSk7DQoJCQlpZigkKCcudWktd2lkZ2V0LW92ZXJsYXknKS5jc3MoJ3otaW5kZXgnKSkNCgkJCQl7aWYgKCQoJyN0b3BMb2FkZXInKS5jc3MoJ3Zpc2liaWxpdHknKT09J3Zpc2libGUnKQ0KCQkJCQl7dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKXtnZXRQcm9ncmVzcyhQcm9ncmVzc0lEKX0sIDUwMCk7fQ0KCQkJCX0gDQogICAgICAgIH0pOyANCn0NCg0KZnVuY3Rpb24gZ2V0VGFibGUoY3N2bmFtZSxwb3MsdG9rZW4pIHsNCglhcGlkYXRhID17fTsNCglhcGlkYXRhWyJwbHVnaW5fZ3VpZCJdID0gIjk1NTMzYTc0LWJiZTMtNDk2Mi05NDA1LTlhYTk2YTQwOTJjZCI7DQoJYXBpZGF0YVsiYXN5bmMiXT1mYWxzZTsNCglhcGlkYXRhWyJuYW1lIl09ImdldHRhYmxlIjsNCglmdW5jZGF0YSA9e307DQoJZnVuY2RhdGFbImNzdm5hbWUiXSA9IGNzdm5hbWU7DQoJZnVuY2RhdGFbInBvcyJdID0gcG9zOw0KCWZ1bmNkYXRhWyJ0b2tlbiJdID0gdG9rZW47DQoJYXBpZGF0YVsiZGF0YSJdPUpTT04uc3RyaW5naWZ5KGZ1bmNkYXRhKTsNCg0KCWNueGRhdGEgPSB7IA0KCQkJCWFwcGlkOiAiYjBhMjc0ZjAtMjJiYy00NGJlLWJlNDgtZGE2ZWM5MTgwMjY4IiwgDQoJCQkJb2JqaWQ6ICI1MDczZmY3NS1kYTk5LTQ0ZmItYTVkNy1lNDRlNWFiMjg1OTgiLCANCgkJCQlhY3Rpb25fbmFtZTogImNhbGxfbWFjcm8iLA0KCQkJCXhtbF9kYXRhIDogSlNPTi5zdHJpbmdpZnkoYXBpZGF0YSksIA0KCQkJCWNhbGxiYWNrIDogImdldEFuc3dlciIgDQoJCQl9Ow0KCQkJDQoJJC5wb3N0KCAicmVzdGFwaS5weSIsIGNueGRhdGEgKQ0KCQkuZG9uZShmdW5jdGlvbiggZGF0YSApIHsNCgkJCWh0bWxUYWJsZSA9IEpTT04ucGFyc2UoZXZhbChkYXRhLnJlcGxhY2UoIi8qKi8iLCIiKSkpOw0KCQkJJCgiI2RhdGFncmlkXyIrdG9rZW4pLmh0bWwoaHRtbFRhYmxlWyJjb2RlIl0pDQoJCX0pOwkNCgkNCn0=</res_source>
	</resource>
	
	
	<resource>
		
	
		<name>jquery.percentageloader-0.1.css</name>
		
	
		<res_source>QGZvbnQtZmFjZSB7DQogICAgZm9udC1mYW1pbHk6ICdCZWJhc05ldWVSZWd1bGFyJzsNCiAgICBzcmM6IHVybCgnQmViYXNOZXVlLXdlYmZvbnQuZW90Jyk7DQogICAgc3JjOiB1cmwoJ0JlYmFzTmV1ZS13ZWJmb250LmVvdCNpZWZpeCcpIGZvcm1hdCgnZW1iZWRkZWQtb3BlbnR5cGUnKSwNCiAgICAgICAgIHVybCgnYmFzTmV1ZS13ZWJmb250LndvZmYnKSBmb3JtYXQoJ3dvZmYnKSwNCiAgICAgICAgIHVybCgnQmViYXNOZXVlLXdlYmZvbnQudHRmJykgZm9ybWF0KCd0cnVldHlwZScpLA0KICAgICAgICAgdXJsKCdCZWJhc05ldWUtd2ViZm9udC5zdmcnKSBmb3JtYXQoJ3N2ZycpOw0KICAgIGZvbnQtd2VpZ2h0OiBub3JtYWw7DQogICAgZm9udC1zdHlsZTogbm9ybWFsOw0KDQp9</res_source>
	</resource>
	
	
	<resource>
		
	
		<name>jquery.percentageloader-0.1.min.js</name>
		
	
		<res_source>KGZ1bmN0aW9uKGUpeyJ1c2Ugc3RyaWN0Ijt2YXIgdD0iZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFJQUFBQUNBQ0FJQUFBQk1YUGFjQUFBQUdYUkZXSFJUYjJaMGQyRnlaUUJCWkc5aVpTQkpiV0ZuWlZKbFlXUjVjY2xsUEFBQUF5SnBWRmgwV0UxTU9tTnZiUzVoWkc5aVpTNTRiWEFBQUFBQUFEdy9lSEJoWTJ0bGRDQmlaV2RwYmowaTc3dS9JaUJwWkQwaVZ6Vk5NRTF3UTJWb2FVaDZjbVZUZWs1VVkzcHJZemxrSWo4K0lEeDRPbmh0Y0cxbGRHRWdlRzFzYm5NNmVEMGlZV1J2WW1VNmJuTTZiV1YwWVM4aUlIZzZlRzF3ZEdzOUlrRmtiMkpsSUZoTlVDQkRiM0psSURVdU1DMWpNRFl3SURZeExqRXpORGMzTnl3Z01qQXhNQzh3TWk4eE1pMHhOem96TWpvd01DQWdJQ0FnSUNBZ0lqNGdQSEprWmpwU1JFWWdlRzFzYm5NNmNtUm1QU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh4T1RrNUx6QXlMekl5TFhKa1ppMXplVzUwWVhndGJuTWpJajRnUEhKa1pqcEVaWE5qY21sd2RHbHZiaUJ5WkdZNllXSnZkWFE5SWlJZ2VHMXNibk02ZUcxd1BTSm9kSFJ3T2k4dmJuTXVZV1J2WW1VdVkyOXRMM2hoY0M4eExqQXZJaUI0Yld4dWN6cDRiWEJOVFQwaWFIUjBjRG92TDI1ekxtRmtiMkpsTG1OdmJTOTRZWEF2TVM0d0wyMXRMeUlnZUcxc2JuTTZjM1JTWldZOUltaDBkSEE2THk5dWN5NWhaRzlpWlM1amIyMHZlR0Z3THpFdU1DOXpWSGx3WlM5U1pYTnZkWEpqWlZKbFppTWlJSGh0Y0RwRGNtVmhkRzl5Vkc5dmJEMGlRV1J2WW1VZ1VHaHZkRzl6YUc5d0lFTlROU0JOWVdOcGJuUnZjMmdpSUhodGNFMU5Pa2x1YzNSaGJtTmxTVVE5SW5odGNDNXBhV1E2TURNNFJqZEZOelE1TXpBeU1URkZNVUZGUVRkRU5VVkRORFV3T0VJMlJVWWlJSGh0Y0UxTk9rUnZZM1Z0Wlc1MFNVUTlJbmh0Y0M1a2FXUTZNRE00UmpkRk56VTVNekF5TVRGRk1VRkZRVGRFTlVWRE5EVXdPRUkyUlVZaVBpQThlRzF3VFUwNlJHVnlhWFpsWkVaeWIyMGdjM1JTWldZNmFXNXpkR0Z1WTJWSlJEMGllRzF3TG1scFpEb3dNemhHTjBVM01qa3pNREl4TVVVeFFVVkJOMFExUlVNME5UQTRRalpGUmlJZ2MzUlNaV1k2Wkc5amRXMWxiblJKUkQwaWVHMXdMbVJwWkRvd016aEdOMFUzTXprek1ESXhNVVV4UVVWQk4wUTFSVU0wTlRBNFFqWkZSaUl2UGlBOEwzSmtaanBFWlhOamNtbHdkR2x2Ymo0Z1BDOXlaR1k2VWtSR1BpQThMM2c2ZUcxd2JXVjBZVDRnUEQ5NGNHRmphMlYwSUdWdVpEMGljaUkvUHY0QlN6b0FBQStPU1VSQlZIamExRjFia3V0S0VhelNkVUFFcklBZHNWYUNUZkROQXZoZ0hYQ0plODQ0OGNpVzNJOTZkcmRtWUdKaXdwWWwyNU5abGZYb1ZqZmpuMzhsSnVHSHhhZnNuUkI0NnJ3MCtCRW9ucUk0QWZZNXhOTEIvUUZMQjhXM0RaL1FQSDZjdVhYSGxCOTRSeUp2NHA0WmY1TTFQK3krQXU5cndudEw2Qi94ZUdtTDR2czZna0dVdnhyWjhMZmo2SGVFNkhiZVkraWYrM3k4Sld5ODV3QXJRSWYrSEplYnUyemdZZk4zUmM5R3Z5WmdDUWRCb0w5RGhURC9LcStRL3ZwTnRyVFdYNkU4VjRET3JnbXo3Qk1jRW5kNEh4ZEJmNDhCVWFzZkZhSUJKL2dxbnJMbWtWWWtELzNEQTVaek1JdmFWNGRzNk9adngxNVJmT0xvVTVVRllSMEhBM3hnbWFQWWNaVk0vVW41d1R6NlhoRE9jcEJWbSsvSVRXRTgwTTBmc1VpVFJSOStFTVlGeW9IL1JSV2E1NC95NkZNb0NHT0ZFR1dWNTlvWXkwYTlhcGgvTGpBRTBBOEhZVndwUkNzY0FLRkdsbW0vWGtNTU1mRkpvVStKVmtTY2cyeG5DWmVyRVpZcURDYlFoeFVERm5Bd25kTGdDOElBQ3c3QlR0MkxERVBOaFZxSXhrZ3JBdXZhT0pnMlppeDJDQVRkZ3MyMGg3MmtxSFlVS1F1YU1ueU1vSVpMbENlS3IyZitWblNKZVlhUm5tNEM0clNJZzIvRlhaRVgxaHI5MERVa0x2MWlIOGt1RGhZRzRYQkFUdUNPTEN0WjVRT0gvcTJWNkxQV2pvNXdNTk52R0xEM3VEZHdFdmVZK2NjanNJMCs5SmIxbGdzQWlRd0h6amU2THUva2FQMFZOSDgvSStMWS84cHRVb1JvSlR5WWNjYUVDSXR3andmWUFORGk2SHk4Z3dSVGR2S1ZNSzNqSUkzeWVscWcvVU1zSCt3djhmdDNYY2RDcThYTWRqU1djcERUMUNsSGtiOHBxNzBFbUF6Qnk2OWdpcjVkaTYwcnhMSVRCTDc2aDJGL0M1Ykk2S1EvaUg2cUdZZTJnbDNlZ1RDRTZGSjYySWtOc0FQRERQcHNOU1JxQ1lJa0ZHNENtcmI5ZkNhUDJUQUFRMzlNOHhjRGJ3cDl4RXJpWm1MV2hDdkVPUmh3Z2hSMzdPdFBhLzRjaWdRcDlGM0RWd294a1laWi9WbUgrSmRFRVdqSmFJYyt1Z2ZCVGx6cFRGb3pEa3YxNTN5TVFNay9pemhzeFRmTlA0VithL2hzcGtNTmN2eDZRNk1aRjNZRmxWOHpJT2VnejVjUGI2QTVHQ2VnOXlGODlFMEFxSnVrZlh3eGR1c0FSRzBmOFV3ZmFhdGZOTlczTi84UU1kd0tqb0crYmZoNEdUNC9QenRXQndEV3NIdGNnZ3dPaHJ0MVNkQU5vWmVQZEpkWG9sL0lEc2lqb1lOZUdoRVRYYUZYcE9Fd0VMUjZMSUplMGgvMW96TG9CdzIva2ZzRytxWU9DUFFoQm1hZ1dCd2dweTNpK1prZVhLWGozTGJibHFBdkcvNGg5M0RxZ0NnTmlpdkFzd1N0d25LVDhNeW9RSEM4eGY5TWx0UE5wbXF6OUtmUUhDT1IzRUw2TXprWkN3WUFHSWZiZHg2V0N5Z3BFN1VxdGZKTTFqdWp4ZVVSNk0zeEFQZGc3d3BaRG56Tm1ZckkwYjRxeS9rK3hKQ3JHRDdxYWlBSWZlRUJRY08zYWNoS2tCZ01vRkJvT29jMkxRN3NtTCtBS1N1ZmFScCtKL2NoNkVtWW1LWEYzckZwY2FzNFNMb0JxRW81cUxOaVdkazE5RHZaRWQ1Qk1Yd2JlaVVOVGRoK3pCV0lyRExHYm5uQ3F3OGlVMUxOMjREZlVMSlZHSU1VRGlhZ2YvN2NYczlZK1NmWVBDZzh4ZXRtYXh6SHkzT2VCeUU5eGY0dmdPc2o5VWN6ZFVlanVKZUlDNjdnb2E4WHdFeXg4U2N0UGJ1MXI3TnlIV2RvWUx5L2ZvbDFDVHBSaTNYL2x6UWFKTkhuOWhCRUdqejAvU0tBVHF2MzJ6N2t6WG01cVZiRW5rTVlOR2l1b0pIeC92dTR5cndrV1lLOW94aFhvYkpIUDJqNFowMmJtSUtvZjdGRGdsajM1d1UwY0dYdlpLdlF3WUZCbU1jSHFPb01VeTArcUUrTG9EOERQYnlWQzI3dHNiZ0VPU3BVWkRpaUt4Z3FSRWN3a0VHUHVzTnA3SkRDUUkrK21vTWVtb1B3d0FjRnBpUmhSSUp5NXQ4cDB2TkwyUjdRTTlReTZpNkl3Zkt6a28vT0p6VDBOZWlESnUvT00vRWtLTUpFbklZek9Cc2VRSjBRaWUrbUswLzF0MEJjUlorRkxMT1B0STc1SjNHdlBjQ1FvSGhZYms0VGdkTmNRZU9BMklMZWt5SklLdFIwOFBVVXlJTGVyVE15SG1DOFBoOFBMQnJZeWtGTERvUnZBdjFPYTM2anpCME5DdnFhNWtRbTVGSnlRbk56L0taYitGQThhT0FtU2MzZklpTmxDZTBsRU01aHRlOVp0bjBhaGFrU1VKWTdDdTBFRm5GMFpRNTNLUWJJSTBqc3U0VjRYQXNKa09nNUZZbWw3SWdzMGRjR0EwN3o3MjIvcGFUS2Z4em93U0hjVStadlN4QUd5V0F6SkRTZWNTclMrVjRDQjFBVG0vYnpHYlg1aXhHNFV5RU9WRjZKbW91Q001dFlKRUFqUTNRT3d3TU1MV29ldTRwVWN0Q1VlQjFZZlNKMFo1bUovWHpXeWk1NzBERSt0QUhUYmxCTGtPZnZNaC9zUkdNL0lPdVpEVGNleVdweFFLMiszeHYwaGF5VXpZbzMzK2Z4RUJjWnV2bk93ellmSFJtOVc5aE93T0xNTGJZaU0wUlJaS290L2NXQklFR3NKRDhqZzNnYTRzSGJCVytKd1QyL1ZrQjlBbmM2bzBpUTlxa29jczBIa0J1cVprM0J4RXQ4K0JQMCszNXVnLzY5a0hzRVpqOUVEVCtHdVBIU1RYNlI1eWdSblFOSkpzN0ttV29PN256YzFYQ0VnUVBCTzcwTS8wa0QrSFVFaDl6YnZZZFFtT1VwdVB0emJybjM0RHdsdlhNZ3RWWVZkaWFPYWNSUER0cHU1NmVxdkQyQUd3L2dSdjNWamx2L0QzbHd6OS90ZVNQS29XR2s0U0ZLaEpzMVdBakQ1ZCtuWXQ5M09kcDJVTStBZkl5QlBuSC8ySCtmNkI4Y3NKaUFHdU5jMmN5U2tqTnBFSktnckNoRm5BWmF4UXVoYzk5endFZWV1aDBuOGpHcFk3ZjlEOW9Kb0JjVGo3UHZVdUpQNXYzdjhRcDJDUmtaRHhqbXlTQUdvdWlmajduajREbHVmRno4ZWNMekduNGcvbk9qbnk4QytGNm4vNlJQUU1kcVNjbGVlNk8xUDNHZVlOVmJSOGV0SE8vbE53MlBsN2I5TFI1L2IvU3gwVzhiL1hod3dQelJWRjRrMzRFMHN6enQydnQwYm92ZmJ6aG9hNjBPbEYzT1UzeDRUNGYycDcvblgzK2hYemYrY1NTZ3h1ekJ0VGhpRFFHWC91Q2l5NDhYL28xLy9PbmlmK0hpSDhiZi8vS2xMamVHZTNOejJUUEIvQUQ5UmgvL3V2L3R6My84QTNBRC9YS0VhcTRHSW5QSlJMejkrdjhnUVFrS1lRbHowK1M4Ny9yemsrNC9QbC80eng0aGZrZTQ3V25SODVjUDNXb21EVVg0d0FWTThFb0ptcmx4T3J1MGQ5dGZ4bUgraEk5WEdQaEo5T1B6WCtRNzhBdS8vR0E3Z2dVWFpQUk13R09DcHlFT1pFRlliZW9ESy9iWkN4MmQwRC9SdjMraWo4ZGZ2T3FJUnhxNnR5MTRQd3NidjNKYUxqUFllbkNUb2ZacXgrd2FROWRtSldoNjZ3WTNBeGRzSDFWZStjRDl2aU4vTHlyaFQ1YzR0Z0RDWjdGdzlpOU9Hb2lxQjlYTUk2Uk5uZ01ZUkh6aTVnQ3pkcFYvWkRTSER1anBEZjJuZWQvUjNzTE1uMEZoMi8rKytuNDdCeHRSU1FNVjN0Qk9ST0p1YXVzUTlKeVVhbjROeWw5UjRRVUxIdFh3VVV2LzZ4ZFBpYm0vSDVldDBySm8yN3R1ZUpzOHY0ZmQySjBFbkZRV251aGgzaGFYZ0VqU2dLNXBLdDRGY2FKL1B6TFN6bEZmYloralBudHlzTGVMY0svRHdFbURQUkZiQkk4aHRCSXhHaDdZeW9JbW0wOXAyNGQxRzBwcDd4RHV6b0RDd1M0bXpJY3I5RFJBYVY5cFMzbVhyWFNXMGpyMjJzR2RCNnh0aFl3c05nZTVUVnc4d0JHSFQvTUgwT04xUm9ydGZQQU1EKzNnOHB1R000eHpRR2VnazZIeDRWSnlHeGVXc1NTSHVsdkRpR3dDS3ZSaDNaYjA3cjZoYW4vZTl3MEwrYmlKc1lxM25MUS9oUXhxbkVQUHlWbjJnS3orQkpWSGxSMll5WStBdnZOMStLWE9wNnpqaU14Ymhaa3lFVU9oZ2ZVSlRWcEd4QVh4MU5VY3BNNE5uZlNEeFBxdUh2VFVvWDllMTlURHVoODhuYUQ5OEpvRFFYWU84RGcyaXNIbURKQktmQlRuQ0JSaVdLZzhuUm1ZSEFEb3hLV05IV0xrUkEwTkJQelkzdCtrdVN6ckI2TG9Wd2ZaN2dYTks3NEx2Y2NCVU4zeGlxWXpZWDYxRW1RV2IrTkdvSkk5Nm9hVUg3Q051eFFHYmxPaTcrUThDTjIzM1QxdDBZZE9wMGxES1VRS2ZrZkJGcUNCdlhuRzdNMUpFMEVhbGFBeDZBUGlBemlMSzhMb0E4UTdWWHlXVkN5cUZOZkJ3NkJCYStkRjNDSXZRYjRmd0ovY0ZFUWZIZHhJbUFwM3JNRHlBeEpkd2FYQmRnZ0tITGt0aTdjUjZFMFBFTkNIbnI5NjN6bFNFREdYZ05iQ3BQbEVUUU41RHVFeWNadmQ5OUdHbnFKTGRrQmJyNk0rR1hyVDF0ZzFBTkJEYU0xQmVhNmdSUUVhS01uRWJjTGtTZWlrRHVrUHRMV0JFQ2p1NG5La3FYYkYwREhaU0wrZFdhUmhJQ3BJbFhBaTVDSmNlVG42QTZrWEJIazFzZWd1bE56VnlRUXJiK0ZqQkUwNlM3MTdxcVRoL0NkY2gyaU9iR0tsMDFXV05mU0FkWTQ3dU9paFA3NkNHZXVyam5QN1RVSDJhazFzdGdlN0IyeDloSXFsR2dNaWFoUHN1T242STZNL3NYUTBrbmVQQ3crTzlMU2ErNmd2Y2tGaGI5Q2VSdFlOaGRCN0dWaFEya2FmM05aUVp0bEt4UWxnanoxTGZnQmp0U1p0WlNySkc3U25kaVdNOUwzZk1Sb0U5RkY4NExxcFN1SWFFOXJpTFJES3ROZWdqdWdLVG5rc2VVUHZtc3JDcmFMVlUyWm5zUWo2SkZXNVNzU09MQUN1dVJ6cDl6NUNHNHhvYnlaZ01wYVAxdDNDOWdacFIyMERldVFsQ0ZJaUgrbkh1VWxYMGc4eW5jQzNDZmNjSklSSXAwSGJ5QzBHdlJ0N2RRc0VXVnNJVEc1bHE5M2lvaTEySGhpUEVEaUFzbEpaWkFIaGNqU3VXVFV4QS8zb1pnNHdSbU9VRnIvemFtWTh3bG1zTmN5QktFZHdvZGRwMktMUVU5SVBNdWg3N3p3YmxIUEtFMXE4a29NZW9NckVRVU40K1hxTSs0R0xQaUkwNUJHUHJGNkk0UHNJVGlNc2FaUFl3dVNnWWN0Qkh3OEFFZDBYNWVYaWZaeVJjUVhxbHRDdDM1UFJiUWtRVWlFaENBY0hlSk03eVVBVGtEamM1OUJ3L0JLTytRU0hoSWo4RlExNFVJV3NPaUJpK0Y3NGJkR1BpTStYN0h1STVOOFVCMWtWaXUwcG53Ky9QdnJmaEsvckswRU8rckNjY2dWOUE0ZFU0eUdMdnBqNG05dWM0R3A2MkNMSnFoVGxCWVU0MGhFdW4zcGJtT1JqZ0lVK3JDWlRJcEt1ZGliWFhiVDljVzBPWFBOZkh3TkM2STlGNHptYTdEUS9rc3RtTmhIamlQbVQzSTZtOFJJc2lqN015dGJXbjFVclcrUjFQOHVCTFVla2J1ZzhHb0VSTEZreHVUZk1yRU9RNXdRSXREUWlIQmh5cERUakppSXc3QjR4a25veFRVOTJ6NDJwamMwbERtdzVvdWdtUGluMFkxMjVzUG5qYWxkb1FlZFI4NWM0Nk9SSXJRbTJ5UnA0RUgzM1EzRmh3V0RzWVQ1by90Nm10c1V0KysyN3hRb3hHa0ovVXFjdmF3U05OWG45MWFTN1RwOFdFbWhKSWVham56Si83Y3BoaG5pSUh2WXo1SVVjWURnSXc1VUpURDFlSGhjd1lmVXA2RFVPeEF4MU1Bakw2SnRDOUdWTDNtVDNxOWVjWUFaNmtRUE5GYmJzY0ppUHZwSDRoMWEveGhkVEZTVHNJZzYyVkNZZVFoOXpZT2FpeFRVK3dla3V5VEFIa1MzTlI5RnZEdURMclp4em1SZVVhQnhDMlI0SjBEbUlCdUVSOUlPMi9CMzZrM1dPK083c0tqRnNiK1k1ajM2MkViUHdwWFc4SVNCRVNEb0VLWk5UNloyRytpa1FRbE9USStLejVLcFJBMTgrOURuQVFlTUttNHMrc2hQVGJiN3dmV1h4QUpROElqdVJKZGhodFNLYVp6TXp0RktvenF5Qi9iMDhEWlNoTEc3b0xLQS9VbE5oRk1UMXFQSjBYcytKZUljOEI5c3Mrc3U4WWZuU2pZdFp6T2FnUVE2MjVlaEhvK2dxNFZyS3lvemNqN1crdG1Yb1Q1djRGZTR4SUIwUkoxaWdQOVhNT0JmOWhiMlYvNEdRT3V3TjRaWk40dkVXUWo4clB0OHRPTXVyWXNTY1lPRHg1bU00SUQ2VHcraHIrZUMwSVFmTlBMNnpvZkVtL3hWZ0FDYXU1TlFoTUdaS0FBQUFBRWxGVGtTdVFtQ0MiLG49bmV3IEltYWdlO24uc3JjPXQ7ZS5mbi5wZXJjZW50YWdlTG9hZGVyPWZ1bmN0aW9uKHQpe3ZhciByLGkscyxvLHUsYSxmLGwsYyxoLHAsZCx2LG0sZyx5LGIsdyxFLFMseCxULE4sQyxrLEwsQSxPLE0sXyxEO3I9e3dpZHRoOjI1NixoZWlnaHQ6MjU2LHByb2dyZXNzOjAsdmFsdWU6IjBrYiIsY29udHJvbGxhYmxlOmZhbHNlfTtpZih0IT09dW5kZWZpbmVkKXtlLmV4dGVuZChyLHQpfWVsc2V7dD1yfUQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7RC5zdHlsZS53aWR0aD1yLndpZHRoKyJweCI7RC5zdHlsZS5oZWlnaHQ9ci5oZWlnaHQrInB4IjtELnN0eWxlLnBvc2l0aW9uPSJyZWxhdGl2ZSI7ZSh0aGlzKS5hcHBlbmQoRCk7aT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJjYW52YXMiKTtpLnNldEF0dHJpYnV0ZSgid2lkdGgiLHIud2lkdGgpO2kuc2V0QXR0cmlidXRlKCJoZWlnaHQiLHIuaGVpZ2h0KTtELmFwcGVuZENoaWxkKGkpO3M9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7cy5zdHlsZS53aWR0aD1yLndpZHRoLnRvU3RyaW5nKCktMisicHgiO3Muc3R5bGUudGV4dEFsaWduPSJjZW50ZXIiO3Muc3R5bGUuaGVpZ2h0PSI1MHB4IjtzLnN0eWxlLmxlZnQ9MDtzLnN0eWxlLnBvc2l0aW9uPSJhYnNvbHV0ZSI7bz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTtvLnN0eWxlLndpZHRoPShyLndpZHRoLTIpLnRvU3RyaW5nKCkrInB4IjtvLnN0eWxlLnRleHRBbGlnbj0iY2VudGVyIjtvLnN0eWxlLmhlaWdodD0iMHB4IjtvLnN0eWxlLm92ZXJmbG93PSJoaWRkZW4iO28uc3R5bGUubGVmdD0wO28uc3R5bGUucG9zaXRpb249ImFic29sdXRlIjt1PVtvLHNdO2ZvcihhPTA7YTx1Lmxlbmd0aDthKz0xKXtmPXVbYV07bD1bIi13ZWJraXQtdXNlci1zZWxlY3QiLCIta2h0bWwtdXNlci1zZWxlY3QiLCItbW96LXVzZXItc2VsZWN0IiwiLW8tdXNlci1zZWxlY3QiLCJ1c2VyLXNlbGVjdCJdO2ZvcihjPTA7YzxsLmxlbmd0aDtjKz0xKXtlKGYpLmNzcyhsW2NdLCJub25lIil9fUQuYXBwZW5kQ2hpbGQocyk7RC5hcHBlbmRDaGlsZChvKTtoPWkuZ2V0Q29udGV4dCgiMmQiKTt2PWkud2lkdGgvMi0xO209aS5oZWlnaHQvMi0xO2c9aC5jcmVhdGVMaW5lYXJHcmFkaWVudCh2LDAsdixpLmhlaWdodCk7Zy5hZGRDb2xvclN0b3AoMCwiI2Q2ZWVmZiIpO2cuYWRkQ29sb3JTdG9wKDEsIiNiNmQ4ZjAiKTt5PWguY3JlYXRlTGluZWFyR3JhZGllbnQodix2Ki4xMzMzMzMsdixpLmhlaWdodC12Ki4xMzMzMzMpO3kuYWRkQ29sb3JTdG9wKDAsIiNmOWZjZmUiKTt5LmFkZENvbG9yU3RvcCgxLCIjZDllYmY3Iik7Yj1oLmNyZWF0ZUxpbmVhckdyYWRpZW50KHYsMCx2LGkuaGVpZ2h0KTtiLmFkZENvbG9yU3RvcCgwLCIjYzFkZmY0Iik7Yi5hZGRDb2xvclN0b3AoMSwiI2FhY2VlNiIpO3c9diouNjY2Njt4PXYtMjtFPXcrdiouMDY7Uz14LXYqLjA2O1Q9Mi4xNzA3OTYzMjY3OTQ5O049Ljk3MDc5NjMyNjc5NDkrTWF0aC5QSSoyO0M9ZmFsc2U7aC5saW5lV2lkdGg9MTtPPWZ1bmN0aW9uKGUsdCxuKXtyZXR1cm57eDplLngrTWF0aC5jb3ModCkqbix5OmUueStNYXRoLnNpbih0KSpufX07TT1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoZSx0KXt2YXIgbixyLGkscyxvLHUsYSxmO249e3g6dix5Om19O3I9TyhuLGUsRSk7aC5tb3ZlVG8oci54LHIueSk7YT1PKG4sdCxFKTtmPU8obix0LFMpO2k9dCszLjE0Mi8yO3M9diouMi00O289TyhhLGkscyk7dT1PKGYsaSxzKTtoLmFyYyh2LG0sRSxlLHQsZmFsc2UpO2guYmV6aWVyQ3VydmVUbyhvLngsby55LHUueCx1LnksZi54LGYueSk7aC5hcmModixtLFMsdCxlLHRydWUpO2E9TyhuLGUsRSk7Zj1PKG4sZSxTKTtpPWUtMy4xNDIvMjtvPU8oZixpLHMpO3U9TyhhLGkscyk7aC5iZXppZXJDdXJ2ZVRvKG8ueCxvLnksdS54LHUueSxhLngsYS55KX1oLmNsZWFyUmVjdCgwLDAsaS53aWR0aCxpLmhlaWdodCk7aC5maWxsU3R5bGU9ZztoLmJlZ2luUGF0aCgpO2guc3Ryb2tlU3R5bGU9IiNiMmQ1ZWQiO2guYXJjKHYsbSx4LDAsTWF0aC5QSSoyLEMpO2guZmlsbCgpO2guc3Ryb2tlKCk7aC5maWxsU3R5bGU9eTtoLmJlZ2luUGF0aCgpO2guYXJjKHYsbSx3LDAsTWF0aC5QSSoyLEMpO2guZmlsbCgpO2guc3Ryb2tlU3R5bGU9IiNiMmQ1ZWRhYSI7aC5zdHJva2UoKTtoLmJlZ2luUGF0aCgpO2guYmVnaW5QYXRoKCk7aC5zdHJva2VTdHlsZT0iI2JjZDRlNSI7ZShULE4pO2guZmlsbFN0eWxlPWI7aC5maWxsKCk7aC5zdHJva2UoKTtrPVQrcCooTi1UKTtoLmJlZ2luUGF0aCgpO2UoVCxrKTtoLnNhdmUoKTtoLmNsaXAoKTtoLmRyYXdJbWFnZShuLDAsMCxpLndpZHRoLGkuaGVpZ2h0KTtoLnJlc3RvcmUoKTtoLmJlZ2luUGF0aCgpO2UoVCxrKTtoLnN0cm9rZSgpOyhmdW5jdGlvbigpe3ZhciBlLHQsbixpO2U9di8yO3Muc3R5bGUudG9wPShyLmhlaWdodC8yLWUvMikudG9TdHJpbmcoKSsicHgiO3Muc3R5bGUuY29sb3I9IiM4MGE5YzgiO3Muc3R5bGUuZm9udD1lLnRvU3RyaW5nKCkrInB4IEJlYmFzTmV1ZVJlZ3VsYXIiO3Muc3R5bGUudGV4dFNoYWRvdz0iMCAxcHggMXB4ICNGRkZGRkYiO3Q9KHAqMTAwKS50b0ZpeGVkKDApKyIlIjtzLmlubmVySFRNTD10O249di81LjU7by5zdHlsZS5jb2xvcj0iIzgwYTljOCI7by5zdHlsZS5mb250PW4udG9TdHJpbmcoKSsicHggQmViYXNOZXVlUmVndWxhciI7by5zdHlsZS5oZWlnaHQ9bi50b1N0cmluZygpKyJweCI7by5zdHlsZS50ZXh0U2hhZG93PSJOb25lIjtpPXIuaGVpZ2h0Ki4xNjY2NjY2Ni1uO28uc3R5bGUudG9wPShyLmhlaWdodCouODMzMzMzMytpLzQpLnRvU3RyaW5nKCkrInB4In0pKCl9O189ZnVuY3Rpb24oKXtpZihwPDApe3A9MH1pZihwPjEpe3A9MX19O0w9ZnVuY3Rpb24oZSl7cD1lO18oKTtNKCl9O3RoaXMuc2V0UHJvZ3Jlc3M9TDtBPWZ1bmN0aW9uKGUpe2Q9ZTtvLmlubmVySFRNTD1kfTt0aGlzLnNldFZhbHVlPUE7dGhpcy5zZXRWYWx1ZShyLnZhbHVlKTtwPXIucHJvZ3Jlc3M7XygpO00oKTtpZih0LmNvbnRyb2xsYWJsZT09PXRydWUpeyhmdW5jdGlvbigpe3ZhciBuLHIsaTtyPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIE1hdGguc3FydChNYXRoLnBvdyhlLXYsMikrTWF0aC5wb3codC1tLDIpKX07bj1mYWxzZTtpPWZ1bmN0aW9uKGUsbil7dmFyIHIsaSxzLG8sdSxhO3I9ZS12O2k9bi1tO3M9TWF0aC5hdGFuMihpLHIpO2lmKHM+TWF0aC5QSS8yKXtzLT1NYXRoLlBJKjJ9bz1ULU1hdGguUEkqMjt1PU4tVDthPShzLW8pL3U7TChhKTtpZih0Lm9uUHJvZ3Jlc3NVcGRhdGUpe3Qub25Qcm9ncmVzc1VwZGF0ZShwKX19O2UoRCkubW91c2Vkb3duKGZ1bmN0aW9uKHQpe3ZhciBzLG8sdSxhO3M9ZSh0aGlzKS5vZmZzZXQoKTtvPXQucGFnZVgtcy5sZWZ0O3U9dC5wYWdlWS1zLnRvcDthPXIobyx1KTtpZihhPncmJmE8eCl7bj10cnVlO2kobyx1KX19KS5tb3VzZXVwKGZ1bmN0aW9uKCl7bj1mYWxzZX0pLm1vdXNlbW92ZShmdW5jdGlvbih0KXt2YXIgcixzLG87aWYobil7cj1lKEQpLm9mZnNldCgpO3M9dC5wYWdlWC1yLmxlZnQ7bz10LnBhZ2VZLXIudG9wO2kocyxvKX19KS5tb3VzZWxlYXZlKGZ1bmN0aW9uKCl7bj1mYWxzZX0pfSkoKX1yZXR1cm4gdGhpc319KShqUXVlcnkp</res_source>
	</resource>
	
	
	<macro>
		
	
		<name>MyProfile</name>
		
	
		<source>'#include(lib_utils)
'#include(lib_dialog_2)

abi = &quot;[{&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: true, &quot;&quot;name&quot;&quot;: &quot;&quot;guid&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;uint16&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_year&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_month&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_day&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;setBirthday&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_email&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;setEmail&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;address&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;addr&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;field&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;getAccess&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;bool&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_firstName&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;setFirstName&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;getLastName&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;address&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;addr&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;field&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;revokeAccess&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;getEmail&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;address&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;addr&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;field&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;grantAccess&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;getPhone&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: true, &quot;&quot;name&quot;&quot;: &quot;&quot;owner&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;address&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_lastName&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;setLastName&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;getFirstName&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;getBirthday&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;uint16&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;year&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;month&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;day&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_phone&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;setPhone&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_guid&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_firstName&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_lastName&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_email&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_phone&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint16&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_birthYear&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_birthMonth&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_birthDay&quot;&quot;}], &quot;&quot;type&quot;&quot;: &quot;&quot;constructor&quot;&quot;, &quot;&quot;payable&quot;&quot;: false}]&quot;
code = &quot;606060405234156200001057600080fd5b6040516200140f3803806200140f833981016040528080518201919060200180518201919060200180518201919060200180518201919060200180518201919060200180519060200190919080519060200190919080519060200190919050505b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508760019080519060200190620000c9929190620001fd565b508660029080519060200190620000e2929190620001fd565b508560039080519060200190620000fb929190620001fd565b50846004908051906020019062000114929190620001fd565b5083600590805190602001906200012d929190620001fd565b5082600660006101000a81548161ffff021916908361ffff16021790555081600660026101000a81548160ff021916908360ff16021790555080600660036101000a81548160ff021916908360ff16021790555060ff600760007313a45970e91b8845eadd8f539ae8822f0bbd611773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff021916908360ff1602179055505b5050505050505050620002ac565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200024057805160ff191683800117855562000271565b8280016001018555821562000271579182015b828111156200027057825182559160200191906001019062000253565b5b50905062000280919062000284565b5090565b620002a991905b80821115620002a55760008160009055506001016200028b565b5090565b90565b61115380620002bc6000396000f300606060405236156100d9576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680630ae6d46b146100de5780630e082b101461016d578063282b065a146101ac5780636305bd5b146102095780636392f76b146102665780636b109282146102c35780636f925535146103525780637e79e8ba1461039757806387ed1bd0146104265780638863bab01461046b5780638da5cb5b146104fa578063932754f91461054f578063932997f1146105ac5780639d344c5d1461063b578063dfe68b5414610686575b600080fd5b34156100e957600080fd5b6100f16106e3565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156101325780820151818401525b602081019050610116565b50505050905090810190601f16801561015f5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561017857600080fd5b6101aa600480803561ffff1690602001909190803560ff1690602001909190803560ff16906020019091905050610781565b005b34156101b757600080fd5b610207600480803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091905050610830565b005b341561021457600080fd5b61024c600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803560ff169060200190919050506108a1565b604051808215151515815260200191505060405180910390f35b341561027157600080fd5b6102c1600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190505061096f565b005b34156102ce57600080fd5b6102d66109e0565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156103175780820151818401525b6020810190506102fb565b50505050905090810190601f1680156103445780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561035d57600080fd5b610395600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803560ff16906020019091905050610a9d565b005b34156103a257600080fd5b6103aa610bb2565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156103eb5780820151818401525b6020810190506103cf565b50505050905090810190601f1680156104185780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561043157600080fd5b610469600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803560ff16906020019091905050610c6f565b005b341561047657600080fd5b61047e610d83565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156104bf5780820151818401525b6020810190506104a3565b50505050905090810190601f1680156104ec5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561050557600080fd5b61050d610e40565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561055a57600080fd5b6105aa600480803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091905050610e65565b005b34156105b757600080fd5b6105bf610ed6565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156106005780820151818401525b6020810190506105e4565b50505050905090810190601f16801561062d5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561064657600080fd5b61064e610f93565b604051808461ffff1661ffff1681526020018360ff1660ff1681526020018260ff1660ff168152602001935050505060405180910390f35b341561069157600080fd5b6106e1600480803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091905050610fe9565b005b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156107795780601f1061074e57610100808354040283529160200191610779565b820191906000526020600020905b81548152906001019060200180831161075c57829003601f168201915b505050505081565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141561082a5782600660006101000a81548161ffff021916908361ffff16021790555081600660026101000a81548160ff021916908360ff16021790555080600660036101000a81548160ff021916908360ff1602179055505b5b505050565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141561089d57806004908051906020019061089b92919061106e565b505b5b50565b6000806000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff1614156109025760019150610968565b600760008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16905060008360ff1660019060020a02821660ff16141591505b5092915050565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614156109dc5780600290805190602001906109da92919061106e565b505b5b50565b6109e86110ee565b6109f2600161105a565b15610a995760038054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610a8d5780601f10610a6257610100808354040283529160200191610a8d565b820191906000526020600020905b815481529060010190602001808311610a7057829003601f168201915b50505050509050610a9a565b5b90565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415610bac57600760008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1690508160ff1660019060020a02198116905080600760008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff021916908360ff1602179055505b5b505050565b610bba6110ee565b610bc4600261105a565b15610c6b5760048054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610c5f5780601f10610c3457610100808354040283529160200191610c5f565b820191906000526020600020905b815481529060010190602001808311610c4257829003601f168201915b50505050509050610c6c565b5b90565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415610d7d57600760008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1690508160ff1660019060020a028117905080600760008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff021916908360ff1602179055505b5b505050565b610d8b6110ee565b610d95600361105a565b15610e3c5760058054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610e305780601f10610e0557610100808354040283529160200191610e30565b820191906000526020600020905b815481529060010190602001808311610e1357829003601f168201915b50505050509050610e3d565b5b90565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415610ed2578060039080519060200190610ed092919061106e565b505b5b50565b610ede6110ee565b610ee8600061105a565b15610f8f5760028054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610f835780601f10610f5857610100808354040283529160200191610f83565b820191906000526020600020905b815481529060010190602001808311610f6657829003601f168201915b50505050509050610f90565b5b90565b6000806000610fa2600461105a565b15610fe357600660009054906101000a900461ffff16600660029054906101000a900460ff16600660039054906101000a900460ff16925092509250610fe4565b5b909192565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141561105657806005908051906020019061105492919061106e565b505b5b50565b600061106633836108a1565b90505b919050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106110af57805160ff19168380011785556110dd565b828001600101855582156110dd579182015b828111156110dc5782518255916020019190600101906110c1565b5b5090506110ea9190611102565b5090565b602060405190810160405280600081525090565b61112491905b80821115611120576000816000905550600101611108565b5090565b905600a165627a7a7230582015975d6824d8a722c7cde9691906ed68f7e12c5c861aafb34e03e11f11f702de0029&quot;

mainwallet = &quot;0xf34b6c32917f957068df1b2205b5061924fe13dd&quot;
mainpassword = &quot;12345&quot;
client_host = &quot;10.41.0.16&quot;
client_port = 8545
client_password = &quot;password&quot;

function save_account(a)
  set b = new buffer
  b.write(a)
  b.seek(0)
  tempresources.write(&quot;account&quot;, b)
end function

function save_contract(c)
  set b = new buffer
  b.write(c)
  b.seek(0)
  tempresources.write(&quot;contract&quot;, b)
end function

function save_transaction(t)
  set b = new buffer
  b.write(t)
  b.seek(0)
  tempresources.write(&quot;transaction&quot;, b)
end function

function read_account
  try
    read_account = tempresources.open(&quot;account&quot;).read()
    logger &quot;Account &quot; &amp; read_account
  catch
    read_account = &quot;&quot;
  end try
end function

function read_contract
try
    read_contract = tempresources.open(&quot;contract&quot;).read()
    logger &quot;Contract &quot; &amp; read_contract
  catch
    read_contract = &quot;&quot;
  end try
end function

function read_transaction
  try
    read_transaction = tempresources.open(&quot;transaction&quot;).read()
    logger &quot;Transaction &quot; &amp; read_transaction
  catch
    read_transaction = &quot;&quot;
  end try
end function

account_id = read_account()
contract_id = read_contract()
transaction_id = read_transaction()

set myclient = new web3client
myclient.host = client_host
myclient.port = client_port
if account_id &lt;&gt; &quot;&quot; then
  myclient.account = account_id
  myclient.unlock_account(client_password)
end if

function read_profile(client)
  d = new dictionary
  d(&quot;firstName&quot;) = client.contract_call(abi, contract_id, &quot;getFirstName&quot;)
  d(&quot;lastName&quot;) = client.contract_call(abi, contract_id, &quot;getLastName&quot;)
  d(&quot;email&quot;) = client.contract_call(abi, contract_id, &quot;getEmail&quot;)
  d(&quot;phone&quot;) = client.contract_call(abi, contract_id, &quot;getPhone&quot;)
  birthday = client.contract_call(abi, contract_id, &quot;getBirthday&quot;)
  d(&quot;birthday&quot;) = birthday(2) &amp; &quot;.&quot; &amp; birthday(1) &amp; &quot;.&quot; &amp; birthday(0)
  read_profile = d
end function

args = xml_dialog.get_answer

if &quot;step&quot; in args then
  if args( &quot;step&quot; )&lt;&gt;&quot;&quot; then
    operation_step = args( &quot;step&quot; )
  end if
else
  operation_step =&quot;&quot;
end if

if operation_step = &quot;&quot; then
  if account_id = &quot;&quot; then
    operation_step = &quot;NewAccount&quot;
  end if
  if (account_id &lt;&gt; &quot;&quot; and contract_id = &quot;&quot;) then
    operation_step = &quot;NewProfile&quot;
  end if
  if (account_id &lt;&gt; &quot;&quot; and contract_id &lt;&gt; &quot;&quot;) then
    operation_step = &quot;ExistingProfile&quot;
  end if
end if

set MyForms = New XMLDialogBuilder

MyForms.addScreen(&quot;NewAccount&quot;)
MyForms.Screen(&quot;NewAccount&quot;).width  = 600
MyForms.Screen(&quot;NewAccount&quot;).Height = 400
MyForms.Screen(&quot;NewAccount&quot;).Title = &quot;My Account&quot;
MyForms.Screen(&quot;NewAccount&quot;).addComponent(&quot;caption&quot;, &quot;text&quot;)
MyForms.Screen(&quot;NewAccount&quot;).Component(&quot;caption&quot;).value(&quot;Press the button below to create your Ethereum account&quot;)
MyForms.Screen(&quot;NewAccount&quot;).addComponent(&quot;btns&quot;, &quot;btngroup&quot;)
MyForms.Screen(&quot;NewAccount&quot;).Component(&quot;btns&quot;).addBtn(&quot;Create&quot;, &quot;Create&quot;)

MyForms.addScreen(&quot;NewProfile&quot;)
MyForms.Screen(&quot;NewProfile&quot;).width  = 600
MyForms.Screen(&quot;NewProfile&quot;).Height = 400
MyForms.Screen(&quot;NewProfile&quot;).Title = &quot;My Profile&quot;
MyForms.Screen(&quot;NewProfile&quot;).addComponent(&quot;account&quot;, &quot;text&quot;)
MyForms.Screen(&quot;NewProfile&quot;).Component(&quot;account&quot;).value(&quot;Your account is &quot; &amp; account_id)
MyForms.Screen(&quot;NewProfile&quot;).addComponent(&quot;caption&quot;, &quot;text&quot;)
MyForms.Screen(&quot;NewProfile&quot;).Component(&quot;caption&quot;).value(&quot;Fill the following fields to create your profile&quot;)
MyForms.Screen(&quot;NewProfile&quot;).addComponent(&quot;firstname&quot;, &quot;TextBox&quot;)
MyForms.Screen(&quot;NewProfile&quot;).Component(&quot;firstname&quot;).label(&quot;First name :&quot;)
MyForms.Screen(&quot;NewProfile&quot;).addComponent(&quot;lastname&quot;, &quot;TextBox&quot;)
MyForms.Screen(&quot;NewProfile&quot;).Component(&quot;lastname&quot;).label(&quot;Last name :&quot;)
MyForms.Screen(&quot;NewProfile&quot;).addComponent(&quot;email&quot;, &quot;TextBox&quot;)
MyForms.Screen(&quot;NewProfile&quot;).Component(&quot;email&quot;).label(&quot;E-mail :&quot;)
MyForms.Screen(&quot;NewProfile&quot;).addComponent(&quot;phone&quot;, &quot;TextBox&quot;)
MyForms.Screen(&quot;NewProfile&quot;).Component(&quot;phone&quot;).label(&quot;Phone number :&quot;)
MyForms.Screen(&quot;NewProfile&quot;).addComponent(&quot;birthday&quot;, &quot;TextBox&quot;)
MyForms.Screen(&quot;NewProfile&quot;).Component(&quot;birthday&quot;).label(&quot;Birthday :&quot;)
MyForms.Screen(&quot;NewProfile&quot;).addComponent(&quot;btns&quot;, &quot;btngroup&quot;)
MyForms.Screen(&quot;NewProfile&quot;).Component(&quot;btns&quot;).addBtn(&quot;OK&quot;, &quot;CreateProfile&quot;)

'####################################################################

function create_account
  acc = myclient.create_account(client_password)
  call save_account(acc)
  set wallet = new web3client
  wallet.host = client_host
  wallet.port = client_port
  wallet.account = mainwallet
  wallet.unlock_account(mainpassword)
  tid = wallet.send_ether(acc, 2)
  call save_transaction(tid)
  create_account = acc
end function

function create_profile
  param = Array
  Redim param(7)
  user = appinmail.currentuser()
  param(0) = user(&quot;guid&quot;)
  param(1) = args(&quot;firstname&quot;)
  param(2) = args(&quot;lastname&quot;)
  param(3) = args(&quot;email&quot;)
  param(4) = args(&quot;phone&quot;)
  param(5) = cint(split(args(&quot;birthday&quot;), &quot;.&quot;)(2))
  param(6) = cint(split(args(&quot;birthday&quot;), &quot;.&quot;)(1))
  param(7) = cint(split(args(&quot;birthday&quot;), &quot;.&quot;)(0))
  tid = myclient.deploy_contract(abi, code, param)
  call save_transaction(tid)
end function

'####################################################################

if instr(operation_step,&quot;&gt;&quot;)&lt;&gt;0 then
  mainStep = split(operation_step,&quot;&gt;&quot;)(0)
  subStep = split(operation_step,&quot;&gt;&quot;)(1)
else
  mainStep = operation_step
  subStep = &quot;&quot;
end if

Select case mainStep

  case &quot;NewAccount&quot;
    MyForms.ShowScreen(&quot;NewAccount&quot;)

  case &quot;Create&quot;
    acc = create_account()
    MyForms.addScreen(&quot;WaitInitialTransaction&quot;)
    MyForms.Screen(&quot;WaitInitialTransaction&quot;).width  = 600
    MyForms.Screen(&quot;WaitInitialTransaction&quot;).Height = 400
    MyForms.Screen(&quot;WaitInitialTransaction&quot;).Title = &quot;My Account&quot;
    MyForms.Screen(&quot;WaitInitialTransaction&quot;).addComponent(&quot;account&quot;, &quot;text&quot;)
    MyForms.Screen(&quot;WaitInitialTransaction&quot;).Component(&quot;account&quot;).value(&quot;Your account is &quot; &amp; acc)
    MyForms.Screen(&quot;WaitInitialTransaction&quot;).addComponent(&quot;caption&quot;, &quot;text&quot;)
    MyForms.Screen(&quot;WaitInitialTransaction&quot;).Component(&quot;caption&quot;).value(&quot;Transaction is being processed...&quot;)
    MyForms.Screen(&quot;WaitInitialTransaction&quot;).addComponent(&quot;btns&quot;, &quot;btngroup&quot;)
    MyForms.Screen(&quot;WaitInitialTransaction&quot;).Component(&quot;btns&quot;).addBtn(&quot;Update&quot;, &quot;WaitInitialTransaction&quot;)
    MyForms.ShowScreen(&quot;WaitInitialTransaction&quot;)

  case &quot;WaitInitialTransaction&quot;
    MyForms.addScreen(&quot;WaitInitialTransaction&quot;)
    MyForms.Screen(&quot;WaitInitialTransaction&quot;).width  = 600
    MyForms.Screen(&quot;WaitInitialTransaction&quot;).Height = 400
    MyForms.Screen(&quot;WaitInitialTransaction&quot;).Title = &quot;My Account&quot;
    MyForms.Screen(&quot;WaitInitialTransaction&quot;).addComponent(&quot;account&quot;, &quot;text&quot;)
    MyForms.Screen(&quot;WaitInitialTransaction&quot;).Component(&quot;account&quot;).value(&quot;Your account is &quot; &amp; account_id)
    set wallet = new web3client
    wallet.host = client_host
    wallet.port = client_port
    wallet.account = mainwallet
    wallet.unlock_account(mainpassword)
    rcpt = wallet.get_transaction_receipt(transaction_id)
    logger rcpt
    if isempty(rcpt) then
      MyForms.Screen(&quot;WaitInitialTransaction&quot;).addComponent(&quot;caption&quot;, &quot;text&quot;)
      MyForms.Screen(&quot;WaitInitialTransaction&quot;).Component(&quot;caption&quot;).value(&quot;Transaction is being processed...&quot;)
      MyForms.Screen(&quot;WaitInitialTransaction&quot;).addComponent(&quot;btns&quot;, &quot;btngroup&quot;)
      MyForms.Screen(&quot;WaitInitialTransaction&quot;).Component(&quot;btns&quot;).addBtn(&quot;Update&quot;, &quot;WaitInitialTransaction&quot;)
      MyForms.ShowScreen(&quot;WaitInitialTransaction&quot;)
    else
      MyForms.Screen(&quot;WaitInitialTransaction&quot;).addComponent(&quot;caption&quot;, &quot;text&quot;)
      MyForms.Screen(&quot;WaitInitialTransaction&quot;).Component(&quot;caption&quot;).value(&quot;Transaction complete&quot;)
      MyForms.Screen(&quot;WaitInitialTransaction&quot;).addComponent(&quot;btns&quot;, &quot;btngroup&quot;)
      MyForms.Screen(&quot;WaitInitialTransaction&quot;).Component(&quot;btns&quot;).addBtn(&quot;Next&quot;, &quot;NewProfile&quot;)
      MyForms.ShowScreen(&quot;WaitInitialTransaction&quot;)
    end if

  case &quot;NewProfile&quot;
    MyForms.ShowScreen(&quot;NewProfile&quot;)

  case &quot;CreateProfile&quot;
    call create_profile
    MyForms.addScreen(&quot;WaitProfile&quot;)
    MyForms.Screen(&quot;WaitProfile&quot;).width  = 600
    MyForms.Screen(&quot;WaitProfile&quot;).Height = 400
    MyForms.Screen(&quot;WaitProfile&quot;).Title = &quot;My Profile&quot;
    MyForms.Screen(&quot;WaitProfile&quot;).addComponent(&quot;caption&quot;, &quot;text&quot;)
    MyForms.Screen(&quot;WaitProfile&quot;).Component(&quot;caption&quot;).value(&quot;Transaction is being processed...&quot;)
    MyForms.Screen(&quot;WaitProfile&quot;).addComponent(&quot;btns&quot;, &quot;btngroup&quot;)
    MyForms.Screen(&quot;WaitProfile&quot;).Component(&quot;btns&quot;).addBtn(&quot;Update&quot;, &quot;WaitProfile&quot;)
    MyForms.ShowScreen(&quot;WaitProfile&quot;)

  case &quot;WaitProfile&quot;
    MyForms.addScreen(&quot;WaitProfile&quot;)
    MyForms.Screen(&quot;WaitProfile&quot;).width  = 600
    MyForms.Screen(&quot;WaitProfile&quot;).Height = 400
    MyForms.Screen(&quot;WaitProfile&quot;).Title = &quot;My Profile&quot;
    addr = myclient.get_contract_address(transaction_id)
    if isempty(addr) then
      MyForms.Screen(&quot;WaitProfile&quot;).addComponent(&quot;caption&quot;, &quot;text&quot;)
      MyForms.Screen(&quot;WaitProfile&quot;).Component(&quot;caption&quot;).value(&quot;Transaction is being processed...&quot;)
      MyForms.Screen(&quot;WaitProfile&quot;).addComponent(&quot;btns&quot;, &quot;btngroup&quot;)
      MyForms.Screen(&quot;WaitProfile&quot;).Component(&quot;btns&quot;).addBtn(&quot;Update&quot;, &quot;WaitProfile&quot;)
      MyForms.ShowScreen(&quot;WaitProfile&quot;)
    else
      call save_contract(addr)
      MyForms.Screen(&quot;WaitProfile&quot;).addComponent(&quot;caption&quot;, &quot;text&quot;)
      MyForms.Screen(&quot;WaitProfile&quot;).Component(&quot;caption&quot;).value(&quot;Transaction complete&quot;)
      MyForms.Screen(&quot;WaitProfile&quot;).addComponent(&quot;btns&quot;, &quot;btngroup&quot;)
      MyForms.Screen(&quot;WaitProfile&quot;).Component(&quot;btns&quot;).addBtn(&quot;OK&quot;, &quot;End&quot;)
      MyForms.ShowScreen(&quot;WaitProfile&quot;)
    end if

  case &quot;ExistingProfile&quot;
    p = read_profile(myclient)
    MyForms.addScreen(&quot;ExistingProfile&quot;)
    MyForms.Screen(&quot;ExistingProfile&quot;).width  = 600
    MyForms.Screen(&quot;ExistingProfile&quot;).Height = 400
    MyForms.Screen(&quot;ExistingProfile&quot;).Title = &quot;My Profile&quot;
    MyForms.Screen(&quot;ExistingProfile&quot;).addComponent(&quot;account&quot;, &quot;text&quot;)
    MyForms.Screen(&quot;ExistingProfile&quot;).Component(&quot;account&quot;).value(&quot;Your account is &quot; &amp; account_id)
    MyForms.Screen(&quot;ExistingProfile&quot;).addComponent(&quot;firstname&quot;, &quot;TextBox&quot;)
    MyForms.Screen(&quot;ExistingProfile&quot;).Component(&quot;firstname&quot;).label(&quot;First name :&quot;)
    MyForms.Screen(&quot;ExistingProfile&quot;).Component(&quot;firstname&quot;).defaultValue(p(&quot;firstName&quot;))
    MyForms.Screen(&quot;ExistingProfile&quot;).addComponent(&quot;lastname&quot;, &quot;TextBox&quot;)
    MyForms.Screen(&quot;ExistingProfile&quot;).Component(&quot;lastname&quot;).label(&quot;Last name :&quot;)
    MyForms.Screen(&quot;ExistingProfile&quot;).Component(&quot;lastname&quot;).defaultValue(p(&quot;lastName&quot;))
    MyForms.Screen(&quot;ExistingProfile&quot;).addComponent(&quot;email&quot;, &quot;TextBox&quot;)
    MyForms.Screen(&quot;ExistingProfile&quot;).Component(&quot;email&quot;).label(&quot;E-mail :&quot;)
    MyForms.Screen(&quot;ExistingProfile&quot;).Component(&quot;email&quot;).defaultValue(p(&quot;email&quot;))
    MyForms.Screen(&quot;ExistingProfile&quot;).addComponent(&quot;phone&quot;, &quot;TextBox&quot;)
    MyForms.Screen(&quot;ExistingProfile&quot;).Component(&quot;phone&quot;).label(&quot;Phone number :&quot;)
    MyForms.Screen(&quot;ExistingProfile&quot;).Component(&quot;phone&quot;).defaultValue(p(&quot;phone&quot;))
    MyForms.Screen(&quot;ExistingProfile&quot;).addComponent(&quot;birthday&quot;, &quot;TextBox&quot;)
    MyForms.Screen(&quot;ExistingProfile&quot;).Component(&quot;birthday&quot;).label(&quot;Birthday :&quot;)
    MyForms.Screen(&quot;ExistingProfile&quot;).Component(&quot;birthday&quot;).defaultValue(p(&quot;birthday&quot;))
    MyForms.Screen(&quot;ExistingProfile&quot;).addComponent(&quot;btns&quot;, &quot;btngroup&quot;)
    MyForms.Screen(&quot;ExistingProfile&quot;).Component(&quot;btns&quot;).addBtn(&quot;Update&quot;, &quot;UpdateProfile&quot;)
    MyForms.Screen(&quot;ExistingProfile&quot;).Component(&quot;btns&quot;).addBtn(&quot;Close&quot;, &quot;Close&quot;)
    MyForms.ShowScreen(&quot;ExistingProfile&quot;)

  case &quot;UpdateProfile&quot;
    p = read_profile(myclient)
    upd = 0

    if p(&quot;firstName&quot;) &lt;&gt; args(&quot;firstname&quot;) then
      myclient.contract_call(abi, contract_id, &quot;setFirstName&quot;, args(&quot;firstname&quot;), 0, true)
      upd = 1
    end if

    if p(&quot;lastName&quot;) &lt;&gt; args(&quot;lastname&quot;) then
      myclient.contract_call(abi, contract_id, &quot;setLastName&quot;, args(&quot;lastname&quot;), 0, true)
      upd = 1
    end if

    if p(&quot;email&quot;) &lt;&gt; args(&quot;email&quot;) then
      myclient.contract_call(abi, contract_id, &quot;setEmail&quot;, args(&quot;email&quot;), 0, true)
      upd = 1
    end if

    if p(&quot;phone&quot;) &lt;&gt; args(&quot;phone&quot;) then
      myclient.contract_call(abi, contract_id, &quot;setPhone&quot;, args(&quot;phone&quot;), 0, true)
      upd = 1
    end if

    if p(&quot;birthday&quot;) &lt;&gt; args(&quot;birthday&quot;) then
      param = Array
      Redim param(2)
      param(0) = cint(split(args(&quot;birthday&quot;), &quot;.&quot;)(2))
      param(1) = cint(split(args(&quot;birthday&quot;), &quot;.&quot;)(1))
      param(2) = cint(split(args(&quot;birthday&quot;), &quot;.&quot;)(0))
      myclient.contract_call(abi, contract_id, &quot;setBirthday&quot;, param, 0, true)
      upd = 1
    end if

    MyForms.addScreen(&quot;UpdateDone&quot;)
    MyForms.Screen(&quot;UpdateDone&quot;).width  = 600
    MyForms.Screen(&quot;UpdateDone&quot;).Height = 400
    MyForms.Screen(&quot;UpdateDone&quot;).Title = &quot;My Profile&quot;
    MyForms.Screen(&quot;UpdateDone&quot;).addComponent(&quot;caption&quot;, &quot;text&quot;)
    if upd &lt;&gt; 0 then
      MyForms.Screen(&quot;UpdateDone&quot;).Component(&quot;caption&quot;).value(&quot;Your profile was updated&quot;)
    else
      MyForms.Screen(&quot;UpdateDone&quot;).Component(&quot;caption&quot;).value(&quot;Nothing changed&quot;)
    end if
    MyForms.Screen(&quot;UpdateDone&quot;).addComponent(&quot;btns&quot;, &quot;btngroup&quot;)
    MyForms.Screen(&quot;UpdateDone&quot;).Component(&quot;btns&quot;).addBtn(&quot;Close&quot;, &quot;Close&quot;)
    MyForms.ShowScreen(&quot;UpdateDone&quot;)

end select</source>
		
	
		<class_name></class_name>
		
	
		<is_button>1</is_button>
		
	
		<ob_board>1</ob_board>
		
	
		<macros_picture></macros_picture>
		
	
		<description></description>
		
	
		<guid>bea34ecc-7abe-4bed-a827-a64a841d720d</guid>
		
	
		<timer_guid></timer_guid>
		
	
		<custom_event_guid></custom_event_guid>
		
	
		<page>home</page>
		
	
		<type>button</type>
	</macro>
	
	
	<macro>
		
	
		<name>lib_dialog_2</name>
		
	
		<source>'Remarks V2.1 // Rev 02-10-2014
'---------------------------------------
'Need searchit.js as a resource to work
'Because of bug in inheritence in VScript all variables of child class must be in mother class
'There is bug when a child call the same method as a function of its own but from his mother class
'the function can not return the 

class component
    
    'general variables
    dim name
    dim properties
    dim propertiesKeyWordsDict
    dim attributes
    dim componentTypeName
    dim datafromrender 'Variable used when a child call render to workaround the bug of calling function from child
    dim rulesCheck
    
    'varaibles for BtnGroup child class
    dim buttonType
    dim btnSize
    dim buttons 
    dim buttonsOrder
    dim buttonsHint
    dim showProgress
    
    'variables for PdfViewer
    dim FileGuid
    dim heightViewer
    
    'variables for Text
    dim center
    
    'variable for TabsGroup
    dim tab
    dim tabsOrder
    
    'Variable for AutoSubmit
    dim NextStep
    
    'Variable Timer
    dim timeout
    
    'Variable Reload
    dim urlGUID
    
    Sub Class_Initialize( )  
        me.componentTypeName = &quot;component&quot;
        me.properties = Dictionary
        me.attributes = Dictionary( &quot;id&quot;, &quot;&quot;, &quot;visible&quot;, &quot;1&quot;, &quot;disabled&quot;, &quot;0&quot;, &quot;fullsize&quot;,&quot;1&quot;  )
        me.propertiesKeyWordsDict = Dictionary(&quot;value&quot;,&quot;value&quot;,&quot;defaultvalue&quot;,&quot;defaultValue&quot;)
        me.rulesCheck = Array
    end sub
    
    Function wrappToCData( txt )
        wrappToCData = &quot;&lt;!--[CDATA[&quot;  &amp; txt &amp; &quot;]]--&gt;&quot;
    End Function

    sub SetTypeName(name)
      componentTypeName = name
    end sub
    
    sub SetName(name)
      attributes(&quot;id&quot;)=name
    end sub
    
    sub visible(value)
        if value then
            attributes(&quot;visible&quot;)=&quot;1&quot;
        else
            attributes(&quot;visible&quot;)=&quot;0&quot;
        end if
    end sub
    
    sub disabled(value)
        if value then
            attributes(&quot;disabled&quot;)=&quot;1&quot;
        else
            attributes(&quot;disabled&quot;)=&quot;0&quot;
        end if
    end sub
    
    sub fullsize(value)
        if value then
            attributes(&quot;fullsize&quot;)=&quot;1&quot;
        else
            attributes(&quot;fullsize&quot;)=&quot;0&quot;
        end if
    end sub
    
    sub setAttr(name,value)
      attributes(lcase(name))=value
    end sub
    
    function getAttr(name)
      getAttr=attributes(lcase(name))
    end function
    
    sub setProp(name,value)
      if lcase(name) in propertiesKeyWordsDict then
        properties(propertiesKeyWordsDict(lcase(name)))=value
      else
        properties(lcase(name))=value
      end if
    end sub
    
    function getProp(name)
      if lcase(name) in propertiesKeyWordsDict then
        getProp=propertiesKeyWordsDict(lcase(name))
      else
        getProp=properties(lcase(name))
      end if
    end function
    
    sub addRule(rule)
      AppendToArray(rulesCheck,rule)
    end sub
        
    function render
        
        'generate Attributes
        dim CreateXMLAtributes
        dim beginText
        dim middleText
        dim endText
        
        set CreateXMLAtributes = buffer.create
        for each key in attributes
            CreateXMLAtributes.write( key &amp; &quot;='&quot; &amp; attributes( key ) &amp; &quot;' &quot; )
        next
        
        beginText = &quot;&lt;&quot; &amp; componentTypeName &amp; &quot; &quot; &amp; CreateXMLAtributes.getvalue &amp; &quot;&gt;&lt;Properties&gt;&quot;
        'generate properties
        set CreatePropertyXML = buffer.create
        for each key in properties
            if key = &quot;options&quot; then
                CreatePropertyXML.write( &quot;&lt;Property name='&quot; &amp; key &amp; &quot;'&gt;&quot; )
                options = properties( key )
                if lcase(TypeName(options))=&quot;dictionary&quot; then
                    for each id in options
                        CreatePropertyXML.write( &quot;&lt;option id='&quot; &amp; id &amp; &quot;'&gt;&quot; &amp; wrappToCData(options( id )) &amp; &quot;&lt;/option&gt;&quot; )
                    next
                else
                    for i=0 to len(options)-1
                        CreatePropertyXML.write( &quot;&lt;option id='&quot; &amp; options(i) &amp; &quot;'&gt;&quot; &amp; wrappToCData(options( i )) &amp; &quot;&lt;/option&gt;&quot; )
                    next
                end if
                CreatePropertyXML.write( &quot;&lt;/Property&gt;&quot; )
            else
                CreatePropertyXML.write( &quot;&lt;Property name='&quot; &amp; key &amp; &quot;'&gt;&quot; &amp; wrappToCData(properties( key )) &amp; &quot;&lt;/Property&gt;&quot; )
            end if 
        next
        middleText = CreatePropertyXML.getvalue
      
        endText = &quot;&lt;/Properties&gt;&lt;/&quot; &amp; componentTypeName &amp; &quot;&gt;&quot;
        render = beginText &amp; middleText &amp; endText
        datafromrender = beginText &amp; middleText &amp; endText
    
    end function

end class

class Heading: inherits component

    Sub init
      mybase.SetTypeName(&quot;Heading&quot;)
      mybase.setProp(&quot;label&quot;,&quot;&quot;)
      mybase.setProp(&quot;defaultValue&quot;,&quot;&quot;)
    end sub
    
    function check(byref globalContext)
      check=true
    end function
    
end class

class LiveSearch: inherits component

    Sub init
      mybase.SetTypeName(&quot;LiveSearch&quot;)
      mybase.setProp(&quot;label&quot;,&quot;&quot;)
    end sub
    
    sub label(value)
      mybase.setProp(&quot;label&quot;,value)
    end sub
    
    sub sourceURI(value)
      mybase.setProp(&quot;sourceURI&quot;,value)
    end sub
    
	sub sourceEvent(value)
      mybase.setProp(&quot;sourceEvent&quot;,value)
    end sub
	
	sub sourceData(value)
      mybase.setProp(&quot;sourceData&quot;,value)
    end sub
	
    function check(byref globalContext)
      check=true
    end function
    
end class

class FileUpload: inherits component

    Sub init
      mybase.SetTypeName(&quot;FileUpload&quot;)
      mybase.setProp(&quot;label&quot;,&quot;&quot;)
    end sub
    
    sub label(value)
      mybase.setProp(&quot;label&quot;,value)
    end sub

    function check(byref globalContext)
      check=true
    end function
    
end class

class RichTextArea: inherits component

    Sub init
      mybase.SetTypeName(&quot;RichTextArea&quot;)
      mybase.setProp(&quot;label&quot;,&quot;&quot;)
      mybase.setProp(&quot;defaultValue&quot;,&quot;&quot;)
	  mybase.setProp(&quot;height&quot;,&quot;400&quot;)
    end sub
    
    sub label(value)
      mybase.setProp(&quot;label&quot;,value)
    end sub
    
    sub height(value)
      mybase.setProp(&quot;height&quot;,value)
    end sub
    
	sub defaultValue(value)
      mybase.setProp(&quot;defaultValue&quot;,value)
    end sub
	
    function check(byref globalContext)
      check=true
    end function
    
end class

class TextBox: inherits component

    Sub init
      mybase.SetTypeName(&quot;TextBox&quot;)
      mybase.setProp(&quot;label&quot;, &quot;&quot;)
      mybase.setProp(&quot;defaultValue&quot;,&quot;&quot;)
    end sub

    sub label(value)
      mybase.setProp(&quot;label&quot;, value)
    end sub

    sub defaultValue(value)
      mybase.setProp(&quot;defaultValue&quot;,value)
    end sub

    function check(byref globalContext)
      check=true
    end function

end class

class DropDown: inherits component

    Sub init
      mybase.SetTypeName(&quot;DropDown&quot;)
      mybase.setProp(&quot;label&quot;,&quot;&quot;)
      mybase.setProp(&quot;defaultValue&quot;,&quot;&quot;)
    end sub
    
    function check(byref globalContext)
      check=true
    end function
    
    sub label(value)
      mybase.setProp(&quot;label&quot;,value)
    end sub
    
    sub AddOption
    
    end sub
    
    sub removeOption
    
    end sub
    
end class

class CheckBox: inherits component

    Sub init
      mybase.SetTypeName(&quot;CheckBox&quot;)
      mybase.setProp(&quot;label&quot;,&quot;&quot;)
    end sub
    
    function check(byref globalContext)
      check=true
    end function

    sub label(value)
      mybase.setProp(&quot;label&quot;,value)
    end sub
    
    sub setSelected(key)
      mybase.setProp(&quot;selected&quot;, key)
    end sub

    sub setOptions(dict)
      mybase.setProp(&quot;options&quot;, dict)
    end sub

    sub breakline(value)
      mybase.setAttr(&quot;breakline&quot;, value)
    end sub

    sub AddOption
    
    end sub
    
    sub removeOption
    
    end sub
    
end class

class SimpleButton: inherits component

    Sub init
      mybase.SetTypeName(&quot;Button&quot;)
      mybase.setProp(&quot;value&quot;,&quot;&quot;)
    end sub

    function check(byref globalContext)
      check=true
    end function

end class

class Hypertext: inherits component

    Sub init
      mybase.SetTypeName(&quot;Hypertext&quot;)
      mybase.setProp(&quot;value&quot;,&quot;&quot;)
    end sub
    
    sub value(data)
       mybase.setProp(&quot;value&quot;,data)
    end sub
    
    function check(byref globalContext)
      check=true
    end function

    
end class

class Text: inherits component

    Sub init
      mybase.SetTypeName(&quot;Hypertext&quot;)
      mybase.setProp(&quot;value&quot;,&quot;&quot;)
      center = false
    end sub

    sub setCenter(value)
      center = value
    end sub
    
    sub value(data)
       if center then
         mybase.setProp(&quot;value&quot;,&quot;&lt;Center&gt;&quot; &amp; data &amp; &quot;&lt;/Center&gt;&quot;)
       else
         mybase.setProp(&quot;value&quot;,data)
       end if
    end sub
    
    function check(byref globalContext)
      check=true
    end function

end class

class AutoSubmit: inherits component

    Sub init
      mybase.SetTypeName(&quot;Hypertext&quot;)
      mybase.setProp(&quot;value&quot;,&quot;&quot;)
    end sub
    
    sub setNextStep(value)
      nextstep = value
    end sub
    
    function check(byref globalContext)
      check=true
    end function
    
    function render
        set renderedData = buffer.create
        set localrenderData = buffer.create
        localrenderData.write(&quot;&lt;script type='text/javascript'&gt;function setOperationStep(step){jQuery('input[name=step]').attr( 'value', step );}&lt;/script&gt;&quot;)
        localrenderData.write(&quot;&lt;script&gt; setOperationStep(&quot;&quot;&quot; &amp; nextstep &amp; &quot;&quot;&quot;);$(&quot;&quot;form.xml-dialog-form&quot;&quot;).submit();&lt;/script&gt;&quot;)
        mybase.visible(false)
        mybase.setProp(&quot;value&quot;,localrenderData.getValue)
        mybase.render
        renderedData.write(datafromrender)
        set myFakeButton = New SimpleButton
            myFakeButton.init
            myFakeButton.visible(false)
            
        renderedData.write(myFakeButton.render)
        render = renderedData.getValue
    end function
    
end class

class CTimer: inherits component

    Sub init
      mybase.SetTypeName(&quot;Hypertext&quot;)
      mybase.setProp(&quot;value&quot;,&quot;&quot;)
    end sub
    
    sub setTimer(value,vtime)
      nextstep = value
      timeout = vtime
    end sub
    
    function check(byref globalContext)
      check=true
    end function
    
    function render
        set renderedData = buffer.create
        set localrenderData = buffer.create
        localrenderData.write(&quot;&lt;script type='text/javascript'&gt;function setOperationStep(step){jQuery('input[name=step]').attr( 'value', step );}&lt;/script&gt;&quot;)
        localrenderData.write(&quot;&lt;script type='text/javascript'&gt;var varTime = setTimeout(function(){ setOperationStep(&quot;&quot;&quot; &amp; nextstep &amp; &quot;&quot;&quot;);window.clearTimeout(varTime);$(&quot;&quot;form.xml-dialog-form&quot;&quot;).submit();},&quot; &amp; timeout &amp; &quot;);&lt;/script&gt;&quot;)
        mybase.visible(false)
        mybase.setProp(&quot;value&quot;,localrenderData.getValue)
        mybase.render
        renderedData.write(datafromrender)
        set myFakeButton = New SimpleButton
            myFakeButton.init
            myFakeButton.visible(false)         
        renderedData.write(myFakeButton.render)
        render = renderedData.getValue
        
     end function
    
end class

class Refresh: inherits component

    Sub init
      mybase.SetTypeName(&quot;Hypertext&quot;)
      mybase.setProp(&quot;value&quot;,&quot;&quot;)
    end sub
    
    function check(byref globalContext)
      check=true
    end function

    function render
      set renderedData = buffer.create
      set localrenderData = buffer.create
      if urlGUID=&quot;&quot; then
        localrenderData.write(&quot;&lt;script type='text/javascript'&gt;location.reload();&lt;/script&gt;&quot;)
      else
        localrenderData.write(&quot;&lt;script type='text/javascript'&gt;window.location.href=&quot;&quot;home.vdom#&quot;&amp;urlGUID&amp;&quot;&quot;&quot;;location.reload();&lt;/script&gt;&quot;)
      end if
      mybase.visible(false)
      mybase.setProp(&quot;value&quot;,localrenderData.getValue)
      mybase.render
      renderedData.write(datafromrender)
      set myFakeButton = New SimpleButton
            myFakeButton.init
            myFakeButton.visible(false)         
        renderedData.write(myFakeButton.render)
        render = renderedData.getValue
    end function
    
end class


class PdfViewer: inherits component

    Sub init
      mybase.SetTypeName(&quot;Hypertext&quot;)
      mybase.setProp(&quot;value&quot;,&quot;&quot;)
    end sub
    
    sub setHeight(value)
      heightViewer = value
    end sub
    
    sub setFileGuid(value)
      FileGuid = value
    end sub
    
    function check(byref globalContext)
      check=true
    end function
    
    function render
        set renderedData = buffer.create
        mybase.setProp(&quot;value&quot;,&quot;&lt;iframe src=&quot;&quot;/get_pdf?id=&quot; &amp; FileGuid &amp; &quot;&quot;&quot; width=&quot;&quot;770&quot;&quot; height=&quot;&quot;&quot; &amp; heightViewer &amp; &quot;&quot;&quot; align=&quot;&quot;middle&quot;&quot;&gt;&lt;/iframe&gt; &quot;)
        mybase.render
        renderedData.write(datafromrender)
        render = renderedData.getValue
    end function
    
end class

class BtnGroup: inherits component
    
    Sub init    
      buttonType=&quot;text&quot;
      buttons = Dictionary
      buttonsHint = Dictionary
      buttonsOrder = Array
      mybase.SetTypeName(&quot;Hypertext&quot;)
      mybase.setProp(&quot;value&quot;,&quot;&quot;)
      showProgress = false
    end sub
    
    sub setToPicture
        buttonType=&quot;picture&quot;
    end sub
    
    sub setToText
        buttonType=&quot;text&quot;
    end sub
    
    sub addBtn(btnLegend,StepToGo)
        if instr(lcase(btnLegend),&quot;.png&quot;)&lt;&gt;0 or instr(lcase(btnLegend),&quot;.jpg&quot;)&lt;&gt;0 or instr(lcase(btnLegend),&quot;.gif&quot;)&lt;&gt;0 then
          buttonType=&quot;picture&quot;
        else
          buttonType=&quot;text&quot;
        end if
        buttons(btnLegend)=StepToGo
        buttonsHint(btnLegend)=&quot;&quot;
        AppendToArray(buttonsOrder,btnLegend)
    end sub
    
    sub SetHint(btnLegend,dataHint)
      buttonsHint(btnLegend)=dataHint
    end sub
    
    function check(byref globalContext)
      check=true
    end function
    
    function render
        set renderedData = buffer.create
        set html = buffer.create
        if showProgress then
          if sessiondictionary(&quot;ProgressID&quot;)&lt;&gt;&quot;&quot; then
            progressIndicatorStr = &quot;showProgress();getProgress('&quot;+sessiondictionary(&quot;ProgressID&quot;)+&quot;');&quot;
          else
            progressIndicatorStr = &quot;&quot;
          end if
        else
          progressIndicatorStr = &quot;&quot;
        end if
        
        html.write (&quot;&lt;script type='text/javascript'&gt;function setOperationStep(step){jQuery('input[name=step]').attr( 'value', step );&quot;+progressIndicatorStr+&quot;}&lt;/script&gt;&quot;)
        html.write (&quot;&lt;table width=&quot;&quot;100%&quot;&quot; align=&quot;&quot;center&quot;&quot; style=&quot;&quot;padding:0px; margin:0px;&quot;&quot;&gt;&lt;tr&gt;&quot;)
        host = system.application_hosts
        nbBtn = len(buttonsOrder)
        i=1
        for each elt in buttonsOrder
            nextstep = buttons(elt)
            if buttonType=&quot;text&quot; then
                action = &quot;'setOperationStep(&quot;&quot;&quot; &amp; nextstep &amp; &quot;&quot;&quot;)'&quot;
                html.write (&quot;&lt;td align=&quot;&quot;center&quot;&quot;&gt;&lt;input style=&quot;&quot;width:&quot; &amp; cstr(btnSize) &amp; &quot;px;&quot;&quot; type=&quot;&quot;submit&quot;&quot; name=&quot;&quot;&quot; &amp; nextstep &amp; &quot;&quot;&quot; value=&quot;&quot;&quot; &amp; elt &amp; &quot;&quot;&quot; onclick=&quot; &amp; action &amp; &quot;&gt;&lt;/td&gt;&quot;)
            else
                action = &quot;'setOperationStep(&quot;&quot;&quot; &amp; nextstep &amp; &quot;&quot;&quot;);$(&quot;&quot;form.xml-dialog-form&quot;&quot;).submit();'&quot;
                if elt in buttonsHint then
                  select case i
                    case 1 and nbBtn&lt;&gt;1
                      buttonsHintPos = &quot;right&quot;
                    case i=nbBtn
                      buttonsHintPos = &quot;left&quot;
                    case else
                      buttonsHintPos = &quot;top&quot;
                  end select
                  html.write (&quot;&lt;td align=&quot;&quot;center&quot;&quot;&gt;&lt;div class=&quot;&quot;hint--&quot;&amp;buttonsHintPos&amp;&quot; hint--info&quot;&quot; data-hint=&quot;&quot;&quot;&amp;buttonsHint(elt)&amp;&quot;&quot;&quot;&gt;&lt;img style='cursor: pointer;' src='//&quot; &amp; host(0) &amp; resources.public_link(elt) &amp; &quot;' name=&quot;&quot;&quot; &amp; nextstep &amp; &quot;&quot;&quot; onclick=&quot; &amp; action &amp; &quot;&gt;&lt;/div&gt;&lt;/td&gt;&quot;)
                else
                  html.write (&quot;&lt;td align=&quot;&quot;center&quot;&quot;&gt;&lt;img style='cursor: pointer;' src='//&quot; &amp; host(0) &amp; resources.public_link(elt) &amp; &quot;' name=&quot;&quot;&quot; &amp; nextstep &amp; &quot;&quot;&quot; onclick=&quot; &amp; action &amp; &quot;&gt;&lt;/td&gt;&quot;)
                end if
            end if
            i=i+1
        next
        html.write (&quot;&lt;/tr&gt;&lt;/table&gt;&quot;)
        set myFakeButton = New SimpleButton
            myFakeButton.init
            myFakeButton.visible(false)
            
        renderedData.write(myFakeButton.render)
        mybase.setProp(&quot;value&quot;,html.getValue)
        mybase.render
        renderedData.write(datafromrender)
        render = renderedData.getValue
        
    end function
    
end class

Function MakeTableRow( Cell1, Cell2 )
    MakeTableRow = &quot;&lt;tr&gt;&lt;td class=&quot;&quot;rigthCell&quot;&quot;&gt;&quot;&amp;Cell1&amp;&quot;&lt;/td&gt;&lt;td&gt;&quot;&amp;Cell2&amp;&quot;&lt;/td&gt;&lt;/tr&gt;&quot;
End Function

'Tab SpecificComponent
class TabInputText

  dim label
  dim name
  dim value
  dim defaultValue
  dim className
  dim incell
  dim full
  dim isCheckOk
  dim ruleList
  dim errTxt
  dim Hint
  dim isDate
  
  Sub Class_Initialize()
    incell = false
    full = false
    isCheckOk = True
    ruleList = Array
    isDate = false
  end sub
  
  sub addRule(ruleData)
    AppendToArray(ruleList,ruleData)
  end sub
  
  sub setToDate
    isDate=true
  end sub
  
  function check(byref globalContext)
    check=true
    set checkExpToEval = New Evaluator
    set checkExpToEval.EvaluatorContext = globalContext
    
    'set value received
    checkExpToEval.Eval(&quot;dim('me')&quot;)
    checkExpToEval.Eval(&quot;affect('me',&quot;&amp;name&amp;&quot;)&quot;)
    
    result = &quot;&quot;
    errTxt = &quot;&quot;
    i=0
    for each rule in ruleList
      if TypeName(rule)=&quot;dictionary&quot; then
        for each subrule in rule
          result = checkExpToEval.Eval(subrule)
        next
      else
        result = checkExpToEval.Eval(rule)
      end if
      if lcase(result)&lt;&gt;&quot;ok&quot; then
          check = false
          isCheckOk = false
          i=i+1
      logger (&quot;The rule : &quot; &amp; tojson(rule) &amp; &quot; on &lt;b&gt;&quot; &amp; name &amp; &quot;&lt;/b&gt; FAILED with result : {&quot;&amp;result&amp;&quot;}&quot;)
          errTxt = errTxt &amp; &quot;err &quot; &amp; cstr(i) &amp; &quot;: &quot; &amp; result &amp; &quot;;&quot;
          'showGrowl(result)
      end if
    next
  end function

  function render
      className = SimpleIf(isCheckOk,&quot;&quot;, &quot;alert &quot;)
      className = className &amp; SimpleIf(isDate,&quot;date &quot;, &quot;&quot;)
    
      if hint=&quot;&quot; then
        htmldata = &quot;&lt;div class='inputFullWidth'&gt;&lt;input class='inputFullWidth&quot; &amp; SimpleIf(isEmpty(className),&quot;&quot;, &quot; &quot; &amp; className) &amp; &quot;' type='text' name='&quot;&amp;name&amp;&quot;' value='&quot; &amp; SimpleIf(isEmpty(value),defaultValue, value ) &amp; &quot;'&gt;&quot; &amp; &quot;&lt;span style='font-family: tahoma; font-size: xx-small; color: crimson;' &gt;&quot; &amp; errTxt &amp; &quot;&lt;/span&gt;&lt;/div&gt;&quot;
      else
        htmldata = &quot;&lt;div class='inputFullWidth hint--top hint--info' data-hint=&quot;&quot;&quot;&amp;Hint&amp;&quot;&quot;&quot;&gt;&lt;input class='inputFullWidth&quot; &amp; SimpleIf(isEmpty(className),&quot;&quot;, &quot; &quot; &amp; className) &amp; &quot;' type='text' name='&quot;&amp;name&amp;&quot;' value='&quot; &amp; SimpleIf(isEmpty(value),defaultValue, value ) &amp; &quot;'&gt;&lt;span style='font-family: tahoma; font-size: xx-small; color: crimson;' &gt;&quot; &amp; errTxt &amp; &quot;&lt;/span&gt;&lt;/div&gt;&quot;
      end if
      if incell then
        render = htmldata
      elseif full then
        render = &quot;&lt;tr&gt;&lt;td colspan='2'&gt;&quot; &amp; label &amp; htmldata &amp; &quot;&lt;/td&gt;&lt;/tr&gt;&quot;
      else
        render = MakeTableRow (label, htmldata)
      end if
  end function
  
end class

class TabPicture
  
  dim incell
  dim picname
  dim align
  dim nextstep
  
  Sub Class_Initialize()
    incell = false
    align = &quot;middle&quot;
  end sub
  
  function check(byref globalContext)
    check=true
  end function
  
  function render
    host = system.application_hosts
    action = &quot;'setOperationStep(&quot;&quot;&quot; &amp; nextstep &amp; &quot;&quot;&quot;);$(&quot;&quot;form.xml-dialog-form&quot;&quot;).submit();'&quot;
    if incell then
      render = &quot;&lt;img &quot; &amp; SimpleIf(nextstep&lt;&gt;&quot;&quot;,&quot;style='cursor: pointer;'&quot;,&quot;&quot;) &amp; &quot; src='//&quot; &amp; host(0) &amp; resources.public_link(picname) &amp; &quot;'  &quot; &amp; SimpleIf(nextstep&lt;&gt;&quot;&quot;,&quot;onclick=&quot; &amp; action,&quot;&quot;) &amp; &quot; &gt;&quot;
    else
      render = &quot;&lt;tr&gt;&lt;td align='&quot; &amp; align &amp; &quot;' colspan='2' &gt;&lt;img &quot; &amp; SimpleIf(nextstep&lt;&gt;&quot;&quot;,&quot;style='cursor: pointer;'&quot;,&quot;&quot;) &amp; &quot; src='//&quot; &amp; host(0) &amp; resources.public_link(picname) &amp; &quot;' &quot; &amp; SimpleIf(nextstep&lt;&gt;&quot;&quot;,&quot;onclick=&quot; &amp; action,&quot;&quot;) &amp; &quot;  &gt;&lt;/td&gt;&lt;/tr&gt;&quot;
    end if
  end function
end class

class TabText
  
  dim incell
  dim align
  dim value
  dim overflow
  dim height
  
  Sub Class_Initialize()
    incell = false
    align = &quot;middle&quot;
    overflow = false
  end sub
  
  function check(byref globalContext)
    check=true
  end function
  
  function render
    
    if incell then
      render = value
    else
      if overflow then
        styleData=&quot;overflow: auto;&quot;
      end if
      if cstr(height)&lt;&gt;&quot;&quot; then
        styleData=styleData &amp; &quot;height: &quot;&amp;cstr(height)&amp;&quot;px;&quot;
      end if
      render = &quot;&lt;tr&gt;&lt;td align='&quot; &amp; align &amp; &quot;' colspan='2' &gt;&lt;div style='&quot;&amp;styleData&amp;&quot;'&gt;&quot;&amp;value&amp;&quot;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&quot;
    end if
    
  end function

end class

class TabPdfViewer

  dim height
  dim incell
  dim fileguid
  dim msg
  dim pdfTemplate
  dim ratio
  
  Sub Class_Initialize()
    incell = false
    height = &quot;500&quot;
    fileguid = &quot;&quot;
    msg = &quot;&quot;
    modeSession = false
    ratio = 0.75
  end sub
  
  function check(byref globalContext)
    check=true
  end function
  
  sub setPageStatus(obj)
    set pageStatus = obj
    modeSession = true
  end sub
  
  function getFileGuid
  
      i=0
      getFileGuid = false
      
      nodes = page_status.selected_nodes
      
      for each node in nodes
        i=i+1
        set nodeSelected = node
      next
    
      Select case i

        case 0
          msg = &quot;Vous devez sélectionner un fichier PDF en premier lieu !&quot;
          if SessionDictionary(&quot;fileguid&quot;)&lt;&gt;&quot;&quot; then
            msg = &quot;&quot;
            fileguid = SessionDictionary(&quot;fileguid&quot;)
            getFileGuid = true
          end if
        case 1
          if TypeName(nodeSelected)=&quot;Nothing&quot; then
            msg = &quot;Le fichier selectionné n'existe plus ! Veuillez recharger la page&quot;
          elseif nodeSelected.mimetype = &quot;folder&quot; then
            if SessionDictionary(&quot;fileguid&quot;)&lt;&gt;&quot;&quot; then
              msg = &quot;&quot;
              fileguid = SessionDictionary(&quot;fileguid&quot;)
              getFileGuid = true
            else
              msg = &quot;Vous avez sélectionné un répertoire et non un fichier de type PDF&quot;
            end if
          elseif nodeSelected.mimetype = &quot;application/pdf&quot; then
            fileguid = nodeSelected.guid
            getFileGuid = true
          else
            msg = &quot;Seul les fichiers PDF sont visibles&quot;
          end if
      case else
        if SessionDictionary(&quot;fileguid&quot;)&lt;&gt;&quot;&quot; then
            msg = &quot;&quot;
            fileguid = SessionDictionary(&quot;fileguid&quot;)
            getFileGuid = true 
        else
            msg = &quot;Vous ne pouvez visualiser qu'un seul fichier à la fois&quot;
        end if
      end select
  
  end function
  
  function render
  
    dim datatoshow
    dim nodes
    i=0
    
    if fileguid=&quot;&quot; then
    
        nodes = page_status.selected_nodes
   
        for each node in nodes
            i=i+1
            set nodeSelected = node
        next
      
            
        Select case i
            case 0
                if SessionDictionary(&quot;fileguid&quot;)&lt;&gt;&quot;&quot; then
                    fileguid = SessionDictionary(&quot;fileguid&quot;)
                    datatoshow = &quot;&lt;iframe src=&quot;&quot;/get_pdf?id=&quot; &amp; SessionDictionary(&quot;fileguid&quot;) &amp; &quot;&quot;&quot; width=&quot;&quot;100%&quot;&quot; height=&quot;&quot;&quot; &amp; height &amp; &quot;&quot;&quot; align=&quot;&quot;middle&quot;&quot;&gt;&lt;/iframe&gt;&quot;
                else
                    datatoshow = &quot;Vous devez sélectionner un fichier PDF en premier lieu !&quot;
                end if
            case 1
                if nodeSelected.mimetype = &quot;folder&quot; then
                    if SessionDictionary(&quot;fileguid&quot;)&lt;&gt;&quot;&quot; then
                      datatoshow = &quot;&lt;iframe src=&quot;&quot;/get_pdf?id=&quot; &amp; SessionDictionary(&quot;fileguid&quot;) &amp; &quot;&quot;&quot; width=&quot;&quot;100%&quot;&quot; height=&quot;&quot;&quot; &amp; height &amp; &quot;&quot;&quot; align=&quot;&quot;middle&quot;&quot;&gt;&lt;/iframe&gt;&quot;
                    else
                      datatoshow = &quot;Vous avez sélectionné un répertoire et non un fichier de type PDF&quot;
                    end if
                elseif nodeSelected.mimetype = &quot;application/pdf&quot; or instr(lcase(nodeSelected.name),&quot;.pdf&quot;)&lt;&gt;0 then
                    fileguid = nodeSelected.guid
                    'if pdfTemplate then
                    ' datatoshow = &quot;&lt;iframe src=&quot;&quot;/get_pdf?id=&quot; &amp; nodeSelected.guid &amp; &quot;&quot;&quot; height=&quot;&quot;100%&quot;&quot; width=&quot;&quot;&quot; &amp; height &amp; &quot;&quot;&quot; align=&quot;&quot;middle&quot;&quot;&gt;&lt;/iframe&gt;&quot;
                    'else
                      datatoshow = &quot;&lt;iframe src=&quot;&quot;/get_pdf?id=&quot; &amp; nodeSelected.guid &amp; &quot;&quot;&quot; width=&quot;&quot;100%&quot;&quot; height=&quot;&quot;&quot; &amp; height &amp; &quot;&quot;&quot; align=&quot;&quot;middle&quot;&quot;&gt;&lt;/iframe&gt;&quot;
                    'end if  
                else
                     datatoshow = &quot;Seul les fichiers PDF sont visibles&quot;
                end if
           case else
                if SessionDictionary(&quot;fileguid&quot;)&lt;&gt;&quot;&quot; then
                    fileguid = SessionDictionary(&quot;fileguid&quot;)
                    datatoshow = &quot;&lt;iframe src=&quot;&quot;/get_pdf?id=&quot; &amp; SessionDictionary(&quot;fileguid&quot;) &amp; &quot;&quot;&quot; width=&quot;&quot;100%&quot;&quot; height=&quot;&quot;&quot; &amp; height &amp; &quot;&quot;&quot; align=&quot;&quot;middle&quot;&quot;&gt;&lt;/iframe&gt;&quot;
                else
                    datatoshow = &quot;Vous ne pouvez visualiser qu'un seul fichier à la fois&quot;
                end if
                    
        end select
    else
        datatoshow = &quot;Erreur, l'identifiant du fichier est absent. &gt;&gt;&gt; fileguid = &quot; &amp; fileguid
    end if
  
    if incell or pdfTemplate then
        render = datatoshow
    else
        render = &quot;&lt;tr&gt;&lt;td align='&quot; &amp; align &amp; &quot;' colspan='2' &gt;&quot;&amp; datatoshow &amp;&quot;&lt;/td&gt;&lt;/tr&gt;&quot;
    end if
  
  end function

end class

function count_folders(folder) 
  result = 0
  for each file in folder.child_nodes
    if file.mimetype = &quot;folder&quot; then
      result = result + 1
    end if
  next
  count_folders = result
end function

Function drill(folder, indent, byref optionsArray,byRef optionsDict,profondeur,depth)
  if profondeur=depth then 
    exit function
  end if
  value = folder.guid
  if value = &quot;&quot; then value = &quot;00000000-0000-0000-0000-000000000000&quot;
  AppendToArray (optionsArray,indent &amp; &quot;--&quot; &amp; folder.name)
  optionsDict (cstr(len(optionsArray)))=folder.guid
  indent = replace(indent, &quot;`&quot;, &quot; &quot;)
  nodes = folder.child_nodes
  count = count_folders(folder)
  index = 1
  for each node in nodes 
    if node.mimetype = &quot;folder&quot; then
      if index = count then
        drill(node, indent &amp; &quot;  `&quot;, optionsArray, optionsDict,profondeur+1,depth)
      else 
        drill(node, indent &amp; &quot;  |&quot;, optionsArray, optionsDict,profondeur+1,depth)
      end if
      index = index + 1
    end if
  next

End Function


class TabDropDown

  dim optionlist
  dim name
  dim label
  dim selectedValue
  dim incell
  dim full
  dim isCheckOk
  dim ruleList
  dim errTxt
  dim Hint
  dim Editable
  dim Size
  dim bSubmit
  dim nextStep
  dim multiple
  dim optionListDict
  dim isOptionList
  
  Sub Class_Initialize()
    optionlist = array
    incell = false
    full = false
    isCheckOk = true
    ruleList = Array
    Size = 1
    bSubmit = false
    nextStep = &quot;Exit&quot;
    multiple = false
    optionListDict = Dictionary
    isOptionList = false
  end sub
  
  sub autoSubmit(nxtStep)
    bSubmit = true
    nextStep = nxtStep
  end sub
  
  sub addRule(ruleData)
    AppendToArray(ruleList,ruleData)
  end sub
  
  function check(byref globalContext)
    check=true
    set checkExpToEval = New Evaluator
    set checkExpToEval.EvaluatorContext = globalContext
    
    'set value received
    checkExpToEval.Eval(&quot;dim('me')&quot;)
    checkExpToEval.Eval(&quot;affect('me',&quot;&amp;name&amp;&quot;)&quot;)
    
    result = &quot;&quot;
    errTxt = &quot;&quot;
    i=0
    for each rule in ruleList
      if TypeName(rule)=&quot;dictionary&quot; then
        for each subrule in rule
          result = checkExpToEval.Eval(subrule)
        next
      else
        result = checkExpToEval.Eval(rule)
      end if
      if lcase(result)&lt;&gt;&quot;ok&quot; then
          check = false
          isCheckOk = false
          i=i+1
      logger (&quot;The rule : &quot; &amp; tojson(rule) &amp; &quot; on &lt;b&gt;&quot; &amp; name &amp; &quot;&lt;/b&gt; FAILED with result : {&quot;&amp;result&amp;&quot;}&quot;) 
          errTxt = errTxt &amp; &quot;err &quot; &amp; cstr(i) &amp; &quot;: &quot; &amp; result &amp; &quot;;&quot;
          'showGrowl(result)
      end if
    next
  end function
  
  sub addOption(optionName)
    AppendToArray(optionlist,optionname)  
  end sub
  
  sub buildFromPath(pathStart,depth)
    set folder = ProShare.get_by_path(pathStart) 
    drill(folder, &quot;&quot;, optionlist,optionListDict,0,depth)
    isOptionList = true
  end sub
  
  sub buildFromUsers(groupName)
    if groupName=&quot;&quot; then
      groupName=&quot;Everyone&quot;
    end if
    try
      UsersList = ProAdmin.groups(groupName)(0).get_users
    catch
      UsersList = Array
    end try
    For each user in UsersList
      AppendToArray(optionlist,user.name)
      optionListDict (cstr(len(optionlist))) = user.guid
      isOptionList = true
    next
  end sub
  
  sub loadfromdb
    if &quot;_&quot; &amp; name &amp; &quot;_&quot; in dbdictionary then
      optionlist = asjson(dbdictionary(&quot;_&quot;&amp;lcase(name)&amp;&quot;_&quot;))
    else
      dbdictionary(&quot;_&quot; &amp; name &amp; &quot;_&quot;)=tojson(array())
    end if
  end sub
  
  sub loadfrompath(path,type)
    pathOK = true
    try
      set localNode = Proshare.get_by_path(path)
      pathType = localNode.mimetype
    catch
      pathOK = false
    end try
    
    if pathOK and Typename(localNode)&lt;&gt;&quot;Nothing&quot; then
      if pathType = &quot;folder&quot; then
        allChildNodes = localNode.child_nodes
        select case lcase(type)
          case &quot;all&quot;
            for each node in allChildNodes 
              AppendToArray(optionlist,node.name)
            next
          case &quot;folders&quot;
            for each node in allChildNodes
              if node.mimetype = &quot;folder&quot; then
                AppendToArray(optionlist,node.name)
              end if
            next
          case &quot;files&quot;
            for each node in allChildNodes
              if node.mimetype &lt;&gt; &quot;folder&quot; then
                AppendToArray(optionlist,node.name)
              end if
            next
          case else
            AppendToArray(optionlist,&quot;Invalid type&quot;)
        end select
     else
       AppendToArray(optionlist,&quot;Path is not a folder&quot;)
     end if
   else
     AppendToArray(optionlist,&quot;Invalid path&quot;)
   end if
  
  end sub
  
  sub setEditable
    Editable = true
  end sub
  
  sub sort
    'if typename(optionlist)=&quot;array&quot; then
    '  if len(optionlist)&gt;0 then
        optionlist = ArraySort(optionlist)
    '  end if
    'end if
  end sub
  
  function render
    
    className = SimpleIf(isCheckOk,&quot;&quot;, &quot;alert&quot;)
    
    set renderdata = buffer.create
    if bSubmit then
      action = &quot;onclick='setOperationStep(&quot;&quot;&quot; &amp; nextstep &amp; &quot;&quot;&quot;);$(&quot;&quot;form.xml-dialog-form&quot;&quot;).submit();'&quot;
    else
      action = &quot;&quot;
    end if
    renderdata.write(&quot;&lt;div &quot;&amp;action&amp;&quot; class='inputFullWidth&quot; &amp; SimpleIf(Hint=&quot;&quot;,&quot;'&quot;,&quot; hint--top hint--info' data-hint=&quot;&quot;&quot;&amp;Hint&amp;&quot;&quot;&quot;&quot;) &amp; &quot;&gt;&quot;)
    renderdata.write(&quot;&lt;select &quot;&amp;SimpleIf(multiple,&quot;multiple&quot;,&quot;&quot;)&amp;&quot; Size='&quot;&amp;cstr(Size)&amp;&quot;' class='inputFullWidth' &quot; &amp; SimpleIf(isEmpty(className),&quot;&quot;, &quot; &quot; &amp; className) &amp; &quot;' name='&quot;&amp;name&amp;&quot;'&gt;&quot;)
    i=1
    for each elt in optionlist
      if isOptionList then
        renderdata.write(&quot;&lt;option value='&quot;&amp;optionListDict(cstr(i))&amp;&quot;' &quot; &amp; SimpleIf(selectedValue=optionListDict(cstr(i)), &quot;selected&quot;, &quot;&quot; )&amp;&quot;&gt;&quot; &amp; elt &amp; &quot;&lt;/option&gt;&quot;)
        i=i+1
      else
        renderdata.write(&quot;&lt;option value='&quot;&amp;elt&amp;&quot;' &quot; &amp; SimpleIf(selectedValue=elt, &quot;selected&quot;, &quot;&quot; )&amp;&quot;&gt;&quot; &amp; elt &amp; &quot;&lt;/option&gt;&quot;)
      end if  
    next
    renderdata.write(&quot;&lt;/select&gt;&quot; &amp; &quot;&lt;span style='font-family: tahoma; font-size: xx-small; color: crimson;' &gt;&quot; &amp; errTxt &amp; &quot;&lt;/span&gt;&quot;)
    renderdata.write(&quot;&lt;/div&gt;&quot;)
    codeEditBefore = &quot;&quot;
    codeEditAfter = &quot;&quot;
    if Editable then
      host = system.application_hosts
      args = xml_dialog.get_answer
      renderdata.write (&quot;&lt;script type='text/javascript'&gt;function setOperationStep(step){jQuery('input[name=step]').attr( 'value', step );}&lt;/script&gt;&quot;)
      'renderdata.write (&quot;&lt;script type='text/javascript'&gt;function setInternalOperationStep(step){jQuery('input[name=internalstep]').attr( 'value', step );}&lt;/script&gt;&quot;)
      'action = &quot;'setInternalOperationStep(&quot;&quot;&quot; &amp; replace(ToJson(Dictionary(&quot;step&quot;,&quot;manageDropDown&quot;,&quot;data&quot;,name,&quot;laststep&quot;,mainStep)),&quot;&quot;&quot;&quot;,&quot;&quot;&quot;&quot;&quot;&quot;) &amp; &quot;&quot;&quot;);setOperationStep(&quot;&quot;Internal&quot;&quot;);$(&quot;&quot;form.xml-dialog-form&quot;&quot;).submit();'&quot;
      sessionDictionary(&quot;_internalData&quot; &amp; &quot;_&quot; &amp; normalize(name))=Dictionary(&quot;step&quot;,&quot;manageDropDown&quot;,&quot;data&quot;,name,&quot;laststep&quot;,mainStep)
      action = &quot;'setOperationStep(&quot;&quot;Internal&gt;&quot; &amp; normalize(name) &amp; &quot;&quot;&quot;);$(&quot;&quot;form.xml-dialog-form&quot;&quot;).submit();'&quot;
      codeEditBefore = &quot;&lt;div class='hint--top hint--info' data-hint='Editer le champ'&gt;&lt;img style='cursor: pointer;' src='//&quot; &amp; host(0) &amp; resources.public_link(&quot;crayon.png&quot;) &amp; &quot;' onclick=&quot; &amp; action &amp; &quot;&gt;&amp;nbsp;&amp;nbsp;&quot;
      codeEditAfter = &quot;&lt;/div&gt;&quot;
    end if
    
    if incell then
      render = codeEditBefore &amp; renderdata.getvalue &amp; codeEditAfter
    elseif full then
      render = &quot;&lt;tr&gt;&lt;td colspan='2'&gt;&quot; &amp; codeEditBefore &amp; label &amp; renderdata.getvalue &amp; codeEditAfter &amp; &quot;&lt;/td&gt;&lt;/tr&gt;&quot;
    else
      render = MakeTableRow (codeEditBefore &amp; label &amp; codeEditAfter,renderdata.getvalue)
    end if
    
  end function

end class

class TabFieldSet 

  dim optionlist
  dim name
  dim label
  dim selectedValueList
  dim args
  dim isCheckOk
  dim ruleList
  dim stateList
  dim height
  dim identifier

  Sub Class_Initialize()
    optionlist = array
    selectedValueList = array
    incell = false
    args = xml_dialog.get_answer
    isCheckOk = dictionary
    stateList = dictionary
    ruleList = Array
    height = 130
    identifier = &quot;&quot;
  end sub
  
  sub addOption(optionName)
    AppendToArray(optionlist,optionname)
    isCheckOk(optionName) = true
    stateList(optionName) = false
  end sub
  
  sub setOptionState(optionName,state)
    if state then
        stateList(optionName) = true
    else
        stateList(optionName) = false
    end if
  end sub
  
  sub addRule(ruleData)
    AppendToArray(ruleList)
  end sub
  
  function check(byref globalContext)
    check=true
  end function
  
  sub loadfromdb
    if &quot;_&quot; &amp; name &amp; &quot;_&quot; in dbdictionary then
      optionlist = asjson(dbdictionary(&quot;_&quot; &amp; lcase(name) &amp; &quot;_&quot;))
      for each elt in optionlist
        isCheckOk(elt) = true
      next
    else
      dbdictionary(&quot;_&quot; &amp; name &amp; &quot;_&quot;)=tojson(array())
    end if
  end sub
  
  sub sort
    optionlist = ArraySort(optionlist)
  end sub
 
  function render
    set renderdata = buffer.create
    renderdata.write(&quot;&lt;tr&gt;&lt;td colspan='2'&gt;&lt;fieldset&gt;&lt;legend&gt;&quot;&amp;label&amp;&quot;&lt;/legend&gt;&quot;)
    renderdata.write(&quot;&lt;div style='width: 99%; overflow: auto; height: &quot;&amp;cstr(height)&amp;&quot;px;'&gt;&quot;)
    for each elt in optionlist
      renderdata.write(&quot;&lt;div&gt;&lt;input type='checkbox' name='&quot; &amp; SimpleIf(identifier=&quot;&quot;,normalize(elt),identifier+&quot;_&quot;+normalize(elt)) &amp; &quot;'&quot;)
      if normalize(elt) in args then
        if args(normalize(elt))=&quot;on&quot; then
          renderdata.write(&quot;checked&quot;)
        end if
      elseif stateList(elt) then
          renderdata.write(&quot;checked&quot;)
      end if
      renderdata.write(&quot;&gt;&lt;span &quot; &amp; SimpleIf(isCheckOk(elt),&quot;&quot;, &quot;class='alert'&quot;) &amp; &quot;&gt;&quot; &amp; elt &amp; &quot;&lt;/span&gt;&lt;/div&gt;&quot;)
    next
    renderdata.write(&quot;&lt;/div&gt;&quot;)
    renderdata.write(&quot;&lt;/fieldset&gt;&lt;/td&gt;&lt;/tr&gt;&quot;)
    render = renderdata.getvalue
  end function

end class

class TabTextArea

  dim label
  dim name
  dim value
  dim defaultValue
  dim className
  dim incell
  dim full
  dim isCheckOk
  dim ruleList
  dim errTxt
  dim Hint
  dim row
  dim editor
  
  Sub Class_Initialize()
    incell = false
    full = false
    isCheckOk = true
    ruleList = Array
    row = 3
    editor = false
  end sub

  sub addRule(ruleData)
    AppendToArray(ruleList,ruleData)
  end sub
  
  function check(byref globalContext)
    check=true
    set checkExpToEval = New Evaluator
    set checkExpToEval.EvaluatorContext = globalContext
    
    'set value received
    checkExpToEval.Eval(&quot;dim('me')&quot;)
    checkExpToEval.Eval(&quot;affect('me',&quot;&amp;name&amp;&quot;)&quot;)
    
    result = &quot;&quot;
    errTxt = &quot;&quot;
    i=0
    for each rule in ruleList
      if TypeName(rule)=&quot;dictionary&quot; then
        for each subrule in rule
          result = checkExpToEval.Eval(subrule)
        next
      else
        result = checkExpToEval.Eval(rule)
      end if
      if lcase(result)&lt;&gt;&quot;ok&quot; then
          check = false
          isCheckOk = false
          i=i+1
          logger (&quot;The rule : &quot; &amp; tojson(rule) &amp; &quot; on &lt;b&gt;&quot; &amp; name &amp; &quot;&lt;/b&gt; FAILED with result : {&quot;&amp;result&amp;&quot;}&quot;) 
          errTxt = errTxt &amp; &quot;err &quot; &amp; cstr(i) &amp; &quot;: &quot; &amp; result &amp; &quot;;&quot;
          'showGrowl(result)
      end if
    next
  end function

  function render
    
    className = SimpleIf(isCheckOk,&quot;&quot;, &quot;alert&quot;)
    editoroptions = SimpleIf(editor,&quot; spellcheck='false' wrap='off'&quot;, &quot;&quot;)
    host = system.application_hosts
    
    set txtAreaCode = Buffer.create
    'if editor then
    '  txtAreaCode.write(&quot;&lt;script src=&quot;&quot;//tinymce.cachefly.net/4.0/tinymce.min.js&quot;&quot;&gt;&lt;/script&gt;&quot;)
    'end if
    txtAreaCode.write(&quot;&lt;div class='inputFullWidth'&quot; &amp; SimpleIf(Hint=&quot;&quot;,&quot;&quot;,&quot;class='hint--top hint--info' data-hint='&quot;&amp;Hint&amp;&quot;'&quot;) &amp; &quot;&gt;&quot;)
    txtAreaCode.write(&quot;&lt;textarea class='inputFullWidth&quot; &amp; SimpleIf(isEmpty(className),&quot;&quot;, &quot; &quot; &amp; className) &amp; &quot;' &quot;+editoroptions+&quot; rows='&quot;&amp;cstr(row)&amp;&quot;' type='text' name='&quot;&amp;name&amp;&quot;'&gt;&quot;&amp;SimpleIf( isEmpty( value ), defaultValue, value )&amp;&quot;&lt;/textarea&gt;&lt;span style='font-family: tahoma; font-size: xx-small; color: crimson;' &gt;&quot; &amp; errTxt &amp; &quot;&lt;/span&gt;&quot;)
    txtAreaCode.write(&quot;&lt;/div&gt;&quot;)
    'if editor then
    '  txtAreaCode.write(&quot;&lt;script&gt;tinymce.init({selector:'textarea'});&lt;/script&gt;&quot;)
    'end if
    if incell then
      render = txtAreaCode.getValue
    elseif full then
      render = &quot;&lt;tr&gt;&lt;td colspan='2'&gt;&quot;&amp;label&amp;txtAreaCode.getValue&amp;&quot;&lt;/td&gt;&lt;/tr&gt;&quot;
    else
      render = MakeTableRow (label, txtAreaCode.getValue)
    end if
  end function

end class

class TabHistoryList

  dim label
  dim name
  dim defaultValue
  dim className
  dim incell
  dim full
  dim height
  
  Sub Class_Initialize()
    incell = false
    full = true
    height = &quot;500&quot;
  end sub

  
  function check(byref globalContext)
    check=true
  end function
  
  sub addComment(type,msg)
  
    try
      jsonInternalData = asjson(defaultValue)
    catch
      jsonInternalData = Dictionary
    end try
    
    set user = ProAdmin.current_user
    
    newComment         = Dictionary
    newComment(&quot;who&quot;)  = user.name
    newComment(&quot;date&quot;) = now
    newComment(&quot;msg&quot;)  = EscapeStr(msg)
    
    select case type
      case &quot;indoc&quot;
        newComment(&quot;type&quot;)=&quot;arrive_doc.png&quot;
      case &quot;move&quot;
        newComment(&quot;type&quot;)=&quot;deplacement.png&quot;
      case &quot;comment&quot;
        newComment(&quot;type&quot;)=&quot;commentaire.png&quot;
      case &quot;updatestate&quot;
        newComment(&quot;type&quot;)=&quot;change.png&quot;
    end select
    randomize
    guid = md5(cstr(now))
    jsonInternalData(guid)=newComment
    defaultValue = tojson(jsonInternalData)
 
  end sub

  function render
  
    host = system.application_hosts
    try
      jsonInternalData = asjson(defaultValue)
    catch
      jsonInternalData = Dictionary
    end try
    
    set HistoryListCodeCode = Buffer.create
    HistoryListCodeCode.write(&quot;&lt;div style='display:none;'&gt;&lt;textarea name='&quot;&amp;name&amp;&quot;'&gt;&quot; &amp; defaultValue &amp; &quot;&lt;/textarea&gt;&lt;/div&gt;&quot;)
    HistoryListCodeCode.write(&quot;&lt;style type=&quot;&quot;text/css&quot;&quot;&gt;div#wrapdisctable{overflow-y: scroll; width:100%; height:&quot;&amp;cstr(height)&amp;&quot;px}div.msgheader{clear: left;}div.msgcomment{clear: left;}table#disctable td{border-bottom: 1px dotted #dbdbdb;}table#disctable tr:last-child td{border-style: none;}table#disctable tr td{padding-bottom: 15px;}.msgheader{font-size: 12px;color: #999999;}&lt;/style&gt;&quot;)
    HistoryListCodeCode.write(&quot;&lt;script type=&quot;&quot;text/javascript&quot;&quot;&gt;jQuery(&quot;&quot;table#disctable tr&quot;&quot;).sortElements(function(a,b){return (new Date($(a).attr(&quot;&quot;id&quot;&quot;)))&lt;(new Date($(b).attr(&quot;&quot;id&quot;&quot;)))?1:-1});&lt;/script&gt;&quot;)
    
    if typename(jsonInternalData)=&quot;Dictionary&quot; then
      if len(jsonInternalData)=0 then
        HistoryListCodeCode.write(&quot;&lt;div style=&quot;&quot;clear:left&quot;&quot;&gt;Aucun historique disponible&lt;/div&gt;&quot;)
      else
        HistoryListCodeCode.write(&quot;&lt;div id=&quot;&quot;wrapdisctable&quot;&quot;&gt;&lt;table id=&quot;&quot;disctable&quot;&quot; width=&quot;&quot;100%&quot;&quot;&gt;&quot;)
        for each elt in jsonInternalData
          m = jsonInternalData(elt)
          d = CDate( m(&quot;date&quot; ) )
          part2 = Hour(d) &amp; &quot;:&quot; &amp; Minute(d) &amp; &quot;:&quot; &amp; Second(d)
          part11 = Month(d) &amp; &quot;/&quot; &amp; Day(d) &amp; &quot;/&quot; &amp; Year(d) &amp; &quot; &quot; &amp; part2
          part12 = Day(d) &amp; &quot;.&quot; &amp; Month(d) &amp; &quot;.&quot; &amp; Year(d) &amp; &quot; &quot; &amp; part2
          
          HistoryListCodeCode.write(&quot;&lt;tr id=&quot;&quot;&quot; &amp; part11 &amp; &quot;&quot;&quot;&gt;&lt;td&gt;&lt;div class=&quot;&quot;msgheader&quot;&quot;&gt;&lt;img src='//&quot; &amp; host(0) &amp; resources.public_link(m(&quot;type&quot;)) &amp; &quot;'&gt;&quot; &amp; m(&quot;who&quot;) &amp; &quot; (&quot; &amp; part12 &amp; &quot;)&lt;/div&gt;&quot;)
          HistoryListCodeCode.write(&quot;&lt;div class=&quot;&quot;msgcomment&quot;&quot;&gt;&quot; &amp; m(&quot;msg&quot;) &amp; &quot;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&quot;)
          
        next
        HistoryListCodeCode.write(&quot;&lt;/table&gt;&lt;/div&gt;&quot;)
      end if
    end if
    
    if incell then
      render = HistoryListCodeCode.getValue
    elseif full then
      render = &quot;&lt;tr&gt;&lt;td colspan='2'&gt;&quot;&amp;HistoryListCodeCode.getValue&amp;&quot;&lt;/td&gt;&lt;/tr&gt;&quot;
    else
      render = MakeTableRow (&quot;Historique&quot;, HistoryListCodeCode.getValue)
    end if
  end function

end class


class TabButton

  dim size
  dim incell
  dim nextstep
  dim align
  dim label
  dim visible

  Sub Class_Initialize()
    incell    = false
    size      = 70
    nextstep  = &quot;Exit&quot;
    align     = &quot;center&quot;
    label     = &quot;button&quot;
    visible   = true
  end sub
  
  function check(byref globalContext)
    check=true
  end function

  function render
  
    if visible then
      action = &quot;'setOperationStep(&quot;&quot;&quot; &amp; nextstep &amp; &quot;&quot;&quot;)'&quot;
      if incell then
          render = &quot;&lt;input style=&quot;&quot;width:&quot; &amp; cstr(Size) &amp; &quot;px;&quot;&quot; type=&quot;&quot;submit&quot;&quot; value=&quot;&quot;&quot; &amp; label &amp; &quot;&quot;&quot; onclick=&quot; &amp; action &amp; &quot;&gt;&quot;
      else
          render = &quot;&lt;tr&gt;&lt;td align='&quot; &amp; align &amp; &quot;' colspan='2' &gt;&lt;input style=&quot;&quot;width:&quot; &amp; cstr(Size) &amp; &quot;px;&quot;&quot; type=&quot;&quot;submit&quot;&quot; value=&quot;&quot;&quot; &amp; label &amp; &quot;&quot;&quot; onclick=&quot; &amp; action &amp; &quot;&gt;&lt;td&gt;&lt;/tr&gt;&quot;
      end if
    else
      render = &quot;&quot;
    end if
  end function

end class

class TabCell

  dim nbCell
  dim size
  dim align
  dim valign
  
  Sub Class_Initialize()
    size = Array
    align = Array
    valign = Array
  end sub
  
  sub CreateCell(nb)
    nbCell = nb
    for i = 1 to nb
      AppendToArray(size,cstr(cint(100/nb)) &amp; &quot;%&quot;)
      AppendToArray(align,&quot;center&quot;)
      AppendToArray(valign,&quot;middle&quot;)
    next
  end sub
  
end class


'Tab components container
class TabContainer

  dim Component
  dim ComponentsOrder
  dim TabName
  dim args
  dim pdfTemplate
  
  Sub Class_Initialize()
    Component = Dictionary
    ComponentsOrder = Array
    args = xml_dialog.get_answer
    pdfTemplate = false
  end sub
  
  sub addComponent(id,componentType)
    typeFound = true
    
    select case lcase(componentType)
    
      case &quot;inputtext&quot;
        set Component(id)= New TabInputText
        Component(id).name = normalize(id)
        if normalize(id) in args then
          component(id).defaultValue = args(normalize(id))
        end if
        
      case &quot;group&quot;
        set Component(id)= New TabCell
            
      case &quot;picture&quot;
        set Component(id)= New TabPicture
  
      case &quot;text&quot;
        set Component(id)= New TabText
 
      case &quot;pdfviewer&quot;
        set Component(id)= New TabPdfViewer
            Component(id).pdfTemplate = pdfTemplate
      
      case &quot;dropdown&quot;
        set Component(id)= New TabDropDown
        Component(id).name = normalize(id)
        if normalize(id) in args then
          component(id).selectedValue = args(normalize(id))
        end if
        
      case &quot;fieldset&quot;
        set Component(id)= New TabFieldSet
        Component(id).name = normalize(id)
      
      case &quot;textarea&quot;
        set Component(id)= New TabTextArea
        Component(id).name = normalize(id)
        if normalize(id) in args then
          component(id).defaultValue = args(normalize(id))
        end if
        
      case &quot;button&quot;
        set Component(id)= New TabButton
      
      case &quot;history&quot;
        set Component(id)= New TabHistoryList
        Component(id).name = normalize(id)
        if normalize(id) in args then
          component(id).defaultValue = args(normalize(id))
        end if
      
      case else
        typeFound = false
    end select
    
    if typefound then
      appendToArray(ComponentsOrder,id)
    end if
  
  end sub
  
  function check(byref globalContext)
    check=true
    for each elt in ComponentsOrder
      try
        check = CBool(check) and CBool(Component(elt).check(globalContext))
      catch
        logger (&quot;Check Tab Component : &quot; &amp; elt &amp; &quot; FAIL no method Check for class &quot; &amp; TypeName(Component(elt)))
      end try
    next
  end function
  
  function render
  
    dim iscell
    iscell = false
    
    set html = buffer.create
    html.write(&quot;&lt;div id=&quot;&quot;&quot;&amp;normalize(TabName)&amp;&quot;&quot;&quot;&gt;&quot;)
    
    if PdfTemplate then
      html.write(&quot;&lt;table id='pdfTemplate' width=&quot;&quot;100%&quot;&quot; cellpadding=&quot;&quot;0&quot;&quot;&gt;&lt;tr&gt;&lt;td id='pdf' width='{0}' &gt;{pdf}&lt;/td&gt;&lt;td valign='top'&gt;&quot;)
    end if
    html.write(&quot;&lt;table width=&quot;&quot;100%&quot;&quot; cellpadding=&quot;&quot;1&quot;&quot;&gt;&lt;thead&gt;&lt;tr&gt;&lt;td width=&quot;&quot;30%&quot;&quot;&gt;&lt;/td&gt;&lt;td width=&quot;&quot;70%&quot;&quot;&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&quot; )    
    

    'render components
    i=0
    for each elt in ComponentsOrder
      if pdfTemplate and lcase(TypeName(Component(elt)))=&quot;tabpdfviewer&quot; then
            memPdfViewerRender = Component(elt).render
            memSize = Component(elt).height
            memRatio = Component(elt).ratio
      else
        if iscell then
          if i=Component(saveelt).nbCell then
            html.write(&quot;&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;&quot;)
            if lcase(TypeName(Component(elt)))=&quot;tabcell&quot; then
              saveelt = elt
              i=0
              html.write(&quot;&lt;tr&gt;&lt;td colspan='2'&gt;&lt;table width='100%'&gt;&lt;tr&gt;&quot;)
            else
              try
                html.write(Component(elt).render)
              catch
                logger (&quot;Oups ! This component can not be rendered : &quot; &amp; elt)
              end try
              iscell = false
              i=0
            end if  
          else
            html.write(&quot;&lt;td width='&quot; &amp; Component(saveelt).size(i) &amp; &quot;' align='&quot; &amp; Component(saveelt).align(i) &amp; &quot;' valign='&quot; &amp; Component(saveelt).valign(i) &amp; &quot;'&gt;&quot;)
            try
              Component(elt).incell = true
              html.write(Component(elt).render)
            catch
            end try
            html.write(&quot;&lt;/td&gt;&quot;)
            i=i+1
          end if
        else
          if lcase(TypeName(Component(elt)))=&quot;tabcell&quot; then
            saveelt = elt
            iscell = true
            i=0
            html.write(&quot;&lt;tr&gt;&lt;td colspan='2'&gt;&lt;table width='100%'&gt;&lt;tr&gt;&quot;)
          else
            html.write(Component(elt).render)          
          end if
        end if
      end if
    next
    if i&lt;&gt;0 then
      html.write(&quot;&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;&quot;)
    end if
    html.write( &quot;&lt;/tbody&gt;&lt;/table&gt;&quot;)
    
    if pdfTemplate then
      html.write(&quot;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;)
    end if
    html.write( &quot;&lt;/div&gt;&quot; )
    if pdfTemplate then
      datatorender = replace(html.getvalue,&quot;{pdf}&quot;,replace(replace(memPdfViewerRender,&quot;&lt;tr&gt;&quot;,&quot;&quot;),&quot;&lt;/tr&gt;&quot;,&quot;&quot;))
      render = replace(datatorender,&quot;{0}&quot;,cstr(cint(memSize*memRatio)))
    else
      render = html.getvalue
    end if

    
  end function
  
end class

class TabGroup: inherits component 

    Sub init   
      tab       = Dictionary
      tabsorder = Array
      mybase.SetTypeName(&quot;Hypertext&quot;)
      mybase.setProp(&quot;value&quot;,&quot;&quot;)
    end sub
    
    sub addTab(TabName)
      set tab(TabName)= New TabContainer
      tab(TabName).TabName=TabName
      AppendToArray(tabsorder,TabName)
    end sub
    
    function check(byref globalContext)
      check=true
      for each elt in tabsorder
        'Try
          check = Cbool(check) and Cbool(tab(elt).check(globalContext))
        'catch
        '  logger (&quot;FAIL to Check TAB(&quot;&amp;elt&amp;&quot;)&quot;)
        'end try
      next
    end function
    
    function render
      set html = buffer.create
      'Tab style'
      html.write( &quot;&lt;style type=&quot;&quot;text/css&quot;&quot; media=&quot;&quot;screen&quot;&quot;&gt;.rigthCell {text-align: right;} .inputFullWidth {width: 100%;} .alert {background-color: rgba(255, 5, 5, 0.2);} div.customTabs background: #333;padding: 1em;}div.customContainer {margin: auto; width: 90%; margin-bottom: 10px;} ul.customTabNavigation {list-style: none; margin: 0; padding: 0;} ul.customTabNavigation li {display: inline;} ul.customTabNavigation li a {background-color: #666;padding: 3px 9px; color: #D1D1D1; text-decoration: none;} ul.customTabNavigation li a.selected, ul.customTabNavigation li a.selected:hover {background: #FFF;color: #000;} ul.customTabNavigation li a:hover {background: #ccc;background: #ccc; color: #000;} ul.customTabNavigation li a:focus {outline: 0;} div.customTabs div {padding: 5px; margin-top: 3px; border: 1px solid #FFF; background: #FFF;}&lt;/style&gt;&quot; )
      'Tab script'
      html.write( &quot;&lt;script type=&quot;&quot;text/javascript&quot;&quot;&gt;$(function(){var tabContainers = $('div.customTabs &gt; div');tabContainers.hide().filter(':first').show();$('div.customTabs ul.customTabNavigation a').click(function(){tabContainers.hide();tabContainers.filter(this.hash).show();$('div.customTabs ul.customTabNavigation a').removeClass('selected');$(this).addClass('selected');return false;}).filter(':first').click();});&lt;/script&gt;&quot;) 
      html.write (&quot;&lt;script type='text/javascript'&gt;function setMemTab(tabname){jQuery('input[name=tabselected]').attr( 'value', tabname );}&lt;/script&gt;&quot;)
      html.write( &quot;&lt;div class=&quot;&quot;customTabs&quot;&quot;&gt;&quot; )
    
      'Tab buttons'
      html.write( &quot;&lt;ul class=&quot;&quot;customTabNavigation&quot;&quot;&gt;&quot;)
      for each elt in tabsorder
        html.write( &quot;&lt;li&gt;&lt;a id='a&quot;&amp;normalize(elt)&amp;&quot;' href='#&quot; &amp; normalize(elt) &amp; &quot;' onclick=&quot;&quot;setMemTab('&quot; &amp; normalize(elt) &amp; &quot;')&quot;&quot; &gt;&quot; &amp; elt &amp; &quot;&lt;/a&gt;&lt;/li&gt;&quot;)
        
      next
      html.write( &quot;&lt;/ul&gt;&quot; )
      
      for each elt in tabsorder
        html.write(tab(elt).render)
      next
      args = xml_dialog.get_answer
      
      if args(&quot;tabselected&quot;)&lt;&gt;&quot;&quot; then
        html.write (&quot;&lt;script type='text/javascript'&gt;&quot;)
        for each elt in tabsorder
          if normalize(elt)=args(&quot;tabselected&quot;) then
            html.write (&quot;jQuery('div[id=&quot;&amp;normalize(elt)&amp;&quot;]').attr( 'style', 'display: block;' );&quot;)
            html.write (&quot;jQuery('a[id=a&quot;&amp;normalize(elt)&amp;&quot;]').attr( 'class', 'selected' );&quot;)
          else
            html.write (&quot;jQuery('div[id=&quot;&amp;normalize(elt)&amp;&quot;]').attr( 'style', 'display: none;' );&quot;)
            html.write (&quot;jQuery('a[id=a&quot;&amp;normalize(elt)&amp;&quot;]').attr( 'class', '' );&quot;)
          end if
        next
        html.write (&quot;setMemTab('&quot;&amp;args(&quot;tabselected&quot;)&amp;&quot;');&quot;)
        html.write (&quot;&lt;/script&gt;&quot;)
      end if
    
      mybase.setProp(&quot;value&quot;,html.getValue)
      mybase.render
      render = datafromrender
    
    end function

end class

class XMLScreen

    dim component
    dim compOrder
    dim DropDownSearchable
    dim Title
    dim Width
    dim Height
    dim NextStep
    dim args
    
    Sub Class_Initialize( )
        DropDownSearchable = false
        component = Dictionary
        compOrder = Array
        Title = &quot;Screen&quot; 
        Width = 400
        Height = 150
        NextStep=&quot;Exit&quot;
    end
    
    function getNextStep
      getNextStep=NextStep
    end function
    
    sub SetNextStep(NextStepName)
      NextStep=NextStepName
    end sub
    
    sub addComponent(Name,ComponentType)
        typeFound = true
        select case lcase(ComponentType)
            case &quot;heading&quot;
                set component(Name) = New Heading
                    
            case &quot;textbox&quot;
                set component(Name) = New TextBox
                    
            case &quot;textarea&quot;
                set component(Name) = New TextArea
            
            case &quot;pdfviewer&quot;
                set component(Name) = New PdfViewer
                
            case &quot;dropdown&quot;
                set component(Name) = New DropDown
                
            case &quot;checkbox&quot;
                set component(Name) = New CheckBox
            
            case &quot;simplebutton&quot;
                set component(Name) = New SimpleButton
            
            case &quot;hypertext&quot;
                set component(Name) = New Hypertext
                    
            case &quot;text&quot;
                set component(Name) = New Text
            
            case &quot;btngroup&quot;
                set component(Name) = New BtnGroup
                    
            case &quot;tabgroup&quot;
                set component(Name) = New TabGroup
            
            case &quot;autosubmit&quot;
                set component(Name) = New AutoSubmit
            
            case &quot;timer&quot;
                set component(Name) = New CTimer
                
            case &quot;refresh&quot;
                set component(Name) = New Refresh
			
			case &quot;livesearch&quot;
                set component(Name) = New LiveSearch
				
			case &quot;richtextarea&quot;
                set component(Name) = New RichTextArea	

			case &quot;fileupload&quot;
                set component(Name) = New FileUpload

            case else
                typeFound = false
        end select
        
        if typeFound then
            AppendToArray(compOrder,Name)
            component(Name).init
            component(Name).SetName(normalize(name))
            args = xml_dialog.get_answer
            if normalize(name) in args then
              try
                component(Name).defaultValue(args(normalize(name)))
              catch
              end try
            end if
        end if
        
    end sub
    
    sub SetDropDownSearchable
        DropDownSearchable = true
    end sub
    
    sub UnSetDropDownSearchable
        DropDownSearchable = false
    end sub
    
    sub SetVisibility(ArrayOfComponent,value)
        for each elt in ArrayOfComponent
            component(Name).visible(value)
        next
    end sub
    
    sub SetDisability(ArrayOfComponent,value)
        for each elt in ArrayOfComponent
            component(Name).disabled(value)
        next
    end sub
    
    function check(byref globalContext)
      check = true
      for each elt in compOrder
        Try
          check = CBool(check) and CBool(component(elt).check(globalContext))
        catch
          Logger (&quot;FAIL to Check Component :&quot; &amp; elt)
        end try
      next
    end function
    
    function render
        host = system.application_hosts
        'Add Script to make drowndown searchable
        if DropDownSearchable then
            set component(&quot;--DropDownSearchable&quot;) = New Hypertext
                component(&quot;--DropDownSearchable&quot;).init
                component(&quot;--DropDownSearchable&quot;).SetName(&quot;--DropDownSearchable&quot;)
                AppendToArray(compOrder,&quot;--DropDownSearchable&quot;)
                set html = buffer.create
                html.write(&quot;&lt;script type=&quot;&quot;text/javascript&quot;&quot; src='//&quot; &amp; host(0) &amp; resources.public_link(&quot;searchit.js&quot;) &amp; &quot;'&gt;&lt;/script&gt;&quot;)
                html.write(&quot;&lt;script type=&quot;&quot;text/javascript&quot;&quot;&gt;$(document).ready(function() {$(&quot;&quot;select&quot;&quot;).searchit({ textFieldClass: 'searchbox' });});&lt;/script&gt;&quot;)
                html.write(&quot;&lt;style type=&quot;&quot;text/css&quot;&quot;&gt; body {}.searchbox {border:1px solid #456879;border-radius:6px;height: 22px;width: 100%;margin-top: 5px;}&lt;/style&gt;&quot;)
                component(&quot;--DropDownSearchable&quot;).setProp(&quot;value&quot;,html.getValue)      
        end if
        'Add CSS to manage hint
        
        set renderBuffer = Buffer.create
        for each elt in compOrder
            renderBuffer.write(component(elt).render)
        next
        render = renderBuffer.getValue
    end function
    
    function componentCount
        componentCount = len(compOrder)
    end function
    
end class

Class XMLDialogBuilder

    dim Screen
    dim templateScreen
    dim internalStep
    dim globalContext
    
    Sub Class_Initialize( )
        Screen = Dictionary
        templateScreen = &quot;&quot;
    end
    
    Function wrappToCData( txt )
      wrappToCData = &quot;&lt;!--[CDATA[&quot;  &amp; txt &amp; &quot;]]--&gt;&quot;
    End Function
    
    sub AddScreen(ScreenName)
        set Screen(ScreenName)=New XMLScreen
    end sub
    
    sub RemoveScreen(ScreenName)
        remove Screen(ScreenName)
    end sub
    
    function checkScreen(screenName)
        args = xml_dialog.get_answer
        set globalContext = New EvalContext
        for each var in args
          if isnumeric(var) then
            globalContext.setVariable(var,cint(args(var)))
          else
            globalContext.setVariable(var,args(var))
          end if
        next
        Screen(screenName).UnSetDropDownSearchable
        checkScreen = Cbool(Screen(screenName).check(globalContext))
      
    end function
    
    function CompileScreen(screenName)
        CompileScreen = Screen(screenName).render
    end function
    
    sub setCompiledScreen(compiledData)
        templateScreen = compiledData
    end sub
    
    sub SaveScreenToDB(screenName)
      DBDictionary(&quot;XMLScreen_&quot; &amp; screenName) = Screen(screenName).render
    end sub
    
    sub RemoveScreenFromDB(screenName)
      DBDictionary.remove(&quot;XMLScreen_&quot; &amp; screenName)
    end sub
    
    sub loadTemplate(screenName)
      templateScreen = DBDictionary(&quot;XMLScreen_&quot; &amp; screenName)
    end sub
    
    sub runInternalProcess
      args = xml_dialog.get_answer
      dim Title
      set xml_components = Buffer.create
      xml_footer = &quot;&lt;/Components&gt;&lt;/VDOMFormContainer&gt;&quot;
      endOfInternalProcess = false
      EndMsg = &quot;&quot;
      
      if instr(args(&quot;step&quot;),&quot;&gt;&quot;)&lt;&gt;0 then
        mainStep = split(args(&quot;step&quot;),&quot;&gt;&quot;)(0)
        objSender = split(args(&quot;step&quot;),&quot;&gt;&quot;)(1)
        sessionDictionary(&quot;objSender&quot;) = objSender
      else
        mainStep = args(&quot;step&quot;)
        objSender = sessionDictionary(&quot;objSender&quot;)
      end if

      'logger (&quot;_internalData&quot; &amp; &quot;_&quot; &amp; objSender &amp; &quot; -- &quot; &amp;  TypeName(sessionDictionary(&quot;_internalData&quot; &amp; &quot;_&quot; &amp; objSender)))
      if TypeName(sessionDictionary(&quot;_internalData&quot; &amp; &quot;_&quot; &amp; objSender))=&quot;Dictionary&quot; then
        set internalScreen = New XMLScreen
        select case sessionDictionary(&quot;_internalData&quot; &amp; &quot;_&quot; &amp; objSender)(&quot;step&quot;)
          case &quot;manageDropDown&quot;
            if mainStep=&quot;Internal&quot; then
              'Initialization of the Internal process
              sessionDictionary(&quot;_memLastScreenData&quot;)= args
              Title = &quot;Gestion d'un champ de formulaire&quot;
              internalScreen.Width = 400 
              internalScreen.Height = 170
              internalScreen.addComponent(&quot;msg&quot;,&quot;Hypertext&quot;)
              internalScreen.component(&quot;msg&quot;).setProp(&quot;Value&quot;,&quot;Gestion du champ : &lt;b&gt;&quot; &amp; sessionDictionary(&quot;_internalData&quot; &amp; &quot;_&quot; &amp; objSender)(&quot;data&quot;) &amp; &quot;&lt;/b&gt;.&lt;br&gt;Veuillez choisir une option :&quot;)
              internalScreen.addComponent(&quot;btns&quot;,&quot;btngroup&quot;)
              internalScreen.Component(&quot;btns&quot;).addBtn(&quot;Ajouter&quot;,&quot;Internal:AddValue&quot;)
              internalScreen.Component(&quot;btns&quot;).addBtn(&quot;Modifier&quot;,&quot;Internal:UpdateValue&quot;)
              internalScreen.Component(&quot;btns&quot;).addBtn(&quot;Supprimer&quot;,&quot;Internal:DeleteValue&quot;)
              internalScreen.Component(&quot;btns&quot;).addBtn(&quot;Retour&quot;,&quot;Internal:End&quot;)
            else
              subprocess = split(mainStep,&quot;:&quot;)
              select case subprocess(1)
                case &quot;mainScreen&quot;
                  Title = &quot;Gestion d'un champ de formulaire&quot;
                  internalScreen.Width = 400 
                  internalScreen.Height = 170
                  internalScreen.addComponent(&quot;msg&quot;,&quot;Hypertext&quot;)
                  internalScreen.component(&quot;msg&quot;).setProp(&quot;Value&quot;,&quot;Gestion du champ : &lt;b&gt;&quot; &amp; sessionDictionary(&quot;_internalData&quot; &amp; &quot;_&quot; &amp; objSender)(&quot;data&quot;) &amp; &quot;&lt;/b&gt;.&lt;br&gt;Veuillez choisir une option :&quot;)
                  internalScreen.addComponent(&quot;btns&quot;,&quot;btngroup&quot;)
                  internalScreen.Component(&quot;btns&quot;).addBtn(&quot;Ajouter&quot;,&quot;Internal:AddValue&quot;)
                  internalScreen.Component(&quot;btns&quot;).addBtn(&quot;Modifier&quot;,&quot;Internal:UpdateValue&quot;)
                  internalScreen.Component(&quot;btns&quot;).addBtn(&quot;Supprimer&quot;,&quot;Internal:DeleteValue&quot;)
                  internalScreen.Component(&quot;btns&quot;).addBtn(&quot;Retour&quot;,&quot;Internal:End&quot;)
                case &quot;AddValue&quot;
                  Title = &quot;Ajouter une valeur&quot;
                  internalScreen.Width = 400 
                  internalScreen.Height = 170
                  internalScreen.addComponent(&quot;newvalue&quot;,&quot;TextBox&quot;)
                  internalScreen.Component(&quot;newvalue&quot;).label(&quot;Nouvelle valeur :&quot;)
                  internalScreen.addComponent(&quot;btns&quot;,&quot;btngroup&quot;)
                  internalScreen.Component(&quot;btns&quot;).addBtn(&quot;Valider&quot;,&quot;Internal:SaveValue&quot;)
                  internalScreen.Component(&quot;btns&quot;).addBtn(&quot;Annuler&quot;,&quot;Internal:mainScreen&quot;)
                  
                case &quot;SaveValue&quot;
                  tmpValue = asjson(DbDictionary(&quot;_&quot; &amp; sessionDictionary(&quot;_internalData&quot; &amp; &quot;_&quot; &amp; objSender)(&quot;data&quot;) &amp; &quot;_&quot;))
                  AppendToArray(tmpValue,args(&quot;newvalue&quot;))
                  DbDictionary(&quot;_&quot; &amp; sessionDictionary(&quot;_internalData&quot; &amp; &quot;_&quot; &amp; objSender)(&quot;data&quot;) &amp; &quot;_&quot;)=toJson(tmpValue)
                  Title = &quot;Mémorisation&quot;
                  internalScreen.Width = 400 
                  internalScreen.Height = 150
                  internalScreen.addComponent(&quot;msg&quot;,&quot;Hypertext&quot;)
                  internalScreen.component(&quot;msg&quot;).setProp(&quot;Value&quot;,&quot;La valeur &lt;b&gt;&quot; &amp; args(&quot;newvalue&quot;) &amp; &quot;&lt;/b&gt; a bien été ajouté au champ &lt;b&gt;&quot; &amp; sessionDictionary(&quot;_internalData&quot; &amp; &quot;_&quot; &amp; objSender)(&quot;data&quot;) &amp; &quot;&lt;/b&gt;.&quot;)                  
                  internalScreen.addComponent(&quot;btns&quot;,&quot;btngroup&quot;)
                  internalScreen.Component(&quot;btns&quot;).addBtn(&quot;Ajouter une autre&quot;,&quot;Internal:AddValue&quot;)
                  internalScreen.Component(&quot;btns&quot;).addBtn(&quot;Retour au menu&quot;,&quot;Internal:mainScreen&quot;)
                  internalScreen.Component(&quot;btns&quot;).addBtn(&quot;Terminer&quot;,&quot;Internal:End&quot;)
                  
                case &quot;UpdateValue&quot;
                  Title = &quot;Modifier une valeur&quot;
                  internalScreen.Width = 400 
                  internalScreen.Height = 250
                  internalScreen.addComponent(&quot;oldvalue&quot;,&quot;DropDown&quot;)
                  internalScreen.Component(&quot;oldvalue&quot;).label(&quot;La valeur :&quot;)
                  internalScreen.Component(&quot;oldvalue&quot;).setProp(&quot;options&quot;,ArraySort(asjson(DbDictionary(&quot;_&quot; &amp; sessionDictionary(&quot;_internalData&quot; &amp; &quot;_&quot; &amp; objSender)(&quot;data&quot;) &amp; &quot;_&quot;))))
                  internalScreen.addComponent(&quot;newvalue&quot;,&quot;TextBox&quot;)
                  internalScreen.Component(&quot;newvalue&quot;).label(&quot;Sera remplacée par :&quot;)
                  internalScreen.addComponent(&quot;btns&quot;,&quot;btngroup&quot;)
                  internalScreen.Component(&quot;btns&quot;).addBtn(&quot;Valider&quot;,&quot;Internal:SaveUpdate&quot;)
                  internalScreen.Component(&quot;btns&quot;).addBtn(&quot;Annuler&quot;,&quot;Internal:mainScreen&quot;)
                  
                case &quot;SaveUpdate&quot;
                  tmpArray = Array
                  for each elt in asjson(DbDictionary(&quot;_&quot; &amp; sessionDictionary(&quot;_internalData&quot; &amp; &quot;_&quot; &amp; objSender)(&quot;data&quot;) &amp; &quot;_&quot;))
                    if elt &lt;&gt; args(&quot;oldvalue&quot;) then
                      AppendToArray(tmpArray,elt)
                    else
                      AppendToArray(tmpArray,args(&quot;newvalue&quot;))
                    end if
                  next
                  DbDictionary(&quot;_&quot; &amp; sessionDictionary(&quot;_internalData&quot; &amp; &quot;_&quot; &amp; objSender)(&quot;data&quot;) &amp; &quot;_&quot;)=tojson(tmpArray)
                  
                  Title = &quot;Mémorisation&quot;
                  internalScreen.Width = 400 
                  internalScreen.Height = 180
                  internalScreen.addComponent(&quot;msg&quot;,&quot;Hypertext&quot;)
                  internalScreen.component(&quot;msg&quot;).setProp(&quot;Value&quot;,&quot;La valeur &lt;b&gt;&quot; &amp; args(&quot;oldvalue&quot;) &amp; &quot;&lt;/b&gt; a bien été remplacée par la valeur &lt;b&gt;&quot; &amp; args(&quot;newvalue&quot;) &amp; &quot;&lt;/b&gt;.&quot;)                  
                  internalScreen.addComponent(&quot;btns&quot;,&quot;btngroup&quot;)
                  internalScreen.Component(&quot;btns&quot;).addBtn(&quot;Retour au menu&quot;,&quot;Internal:mainScreen&quot;)
                  internalScreen.Component(&quot;btns&quot;).addBtn(&quot;Terminer&quot;,&quot;Internal:End&quot;)
                
                case &quot;DeleteValue&quot;
                  Title = &quot;Supprimer une valeur&quot;
                  internalScreen.Width = 400 
                  internalScreen.Height = 200
                  internalScreen.addComponent(&quot;thevalue&quot;,&quot;DropDown&quot;)
                  internalScreen.Component(&quot;thevalue&quot;).label(&quot;La valeur :&quot;)
                  internalScreen.Component(&quot;thevalue&quot;).setProp(&quot;options&quot;,ArraySort(asjson(DbDictionary(&quot;_&quot; &amp; sessionDictionary(&quot;_internalData&quot; &amp; &quot;_&quot; &amp; objSender)(&quot;data&quot;) &amp; &quot;_&quot;))))
                  internalScreen.addComponent(&quot;msg&quot;,&quot;Hypertext&quot;)
                  internalScreen.component(&quot;msg&quot;).setProp(&quot;Value&quot;,&quot;Va être supprimée.&quot;)
                  internalScreen.addComponent(&quot;btns&quot;,&quot;btngroup&quot;)
                  internalScreen.Component(&quot;btns&quot;).addBtn(&quot;Valider&quot;,&quot;Internal:SaveDelete&quot;)
                  internalScreen.Component(&quot;btns&quot;).addBtn(&quot;Annuler&quot;,&quot;Internal:mainScreen&quot;)
                  
                case &quot;SaveDelete&quot;
                  tmpArray = Array
                  for each elt in asjson(DbDictionary(&quot;_&quot; &amp; sessionDictionary(&quot;_internalData&quot; &amp; &quot;_&quot; &amp; objSender)(&quot;data&quot;) &amp; &quot;_&quot;))
                    if elt &lt;&gt; args(&quot;thevalue&quot;) then
                      AppendToArray(tmpArray,elt)
                    end if
                  next
                  DbDictionary(&quot;_&quot; &amp; sessionDictionary(&quot;_internalData&quot; &amp; &quot;_&quot; &amp; objSender)(&quot;data&quot;) &amp; &quot;_&quot;)=tojson(tmpArray)
                  
                  Title = &quot;Mémorisation&quot;
                  internalScreen.Width = 400 
                  internalScreen.Height = 150
                  internalScreen.addComponent(&quot;msg&quot;,&quot;Hypertext&quot;)
                  internalScreen.component(&quot;msg&quot;).setProp(&quot;Value&quot;,&quot;La valeur &lt;b&gt;&quot; &amp; args(&quot;thevalue&quot;) &amp; &quot;&lt;/b&gt; a bien été supprimée&quot;)                  
                  internalScreen.addComponent(&quot;btns&quot;,&quot;btngroup&quot;)
                  internalScreen.Component(&quot;btns&quot;).addBtn(&quot;Retour au menu&quot;,&quot;Internal:mainScreen&quot;)
                  internalScreen.Component(&quot;btns&quot;).addBtn(&quot;Terminer&quot;,&quot;Internal:End&quot;)
                  
                
                case &quot;End&quot;
                  EndMsg = &quot;&lt;center&gt;&lt;br&gt;&lt;br&gt;Fin du traitement, vous allez retourner au formulaire.&lt;/center&gt;&quot;
                  endOfInternalProcess = true
             
                case else
                
              end select
            end if
          case else
          
        end select
        
        if endOfInternalProcess then
          Title =&quot;Retour au formulaire&quot;
          internalScreen.Height = 150
          internalScreen.addComponent(&quot;msg&quot;,&quot;Hypertext&quot;)
          internalScreen.component(&quot;msg&quot;).setProp(&quot;Value&quot;,EndMsg)
          for each key in sessionDictionary(&quot;_memLastScreenData&quot;)
            if (key &lt;&gt; &quot;macros_id&quot;) and (key &lt;&gt; &quot;macros_id&quot;) and (key &lt;&gt; &quot;id&quot;) and (key &lt;&gt; &quot;sender&quot;) then
              internalScreen.addComponent(key,&quot;TextBox&quot;)
              internalScreen.component(key).visible(false)
              internalScreen.component(key).setProp(&quot;defaultValue&quot;,replace(sessionDictionary(&quot;_memLastScreenData&quot;)(key),&quot;&quot;&quot;&quot;,&quot;&amp;quot;&quot;))
            end if
          next
          internalScreen.addComponent(&quot;go&quot;,&quot;autosubmit&quot;)
          internalScreen.Component(&quot;go&quot;).SetNextStep(sessionDictionary(&quot;_internalData&quot; &amp; &quot;_&quot; &amp; objSender)(&quot;laststep&quot;))
        else
          
        end if
        
        'Adding some additionnal textbox to store the Step
        internalScreen.addComponent(&quot;step&quot;,&quot;TextBox&quot;)
        internalScreen.component(&quot;step&quot;).visible(false)
        
        'Adding some additionnal textbox to store MacroID value
        internalScreen.addComponent(&quot;macros_id&quot;,&quot;TextBox&quot;)
        internalScreen.component(&quot;macros_id&quot;).visible(false)
        internalScreen.component(&quot;macros_id&quot;).setProp(&quot;defaultValue&quot;,xml_dialog.get_macros_id())
        xml_dialog.set_size( internalScreen.Width,internalScreen.Height)
        xml_components.write(internalScreen.render)
      else
        set errScreen = New XMLScreen
        
        title = &quot;Can not get internal sub process !&quot;
        errScreen.Height = 230
        
        'Create the message to show
        errScreen.addComponent(&quot;msg&quot;,&quot;Hypertext&quot;)
        errScreen.component(&quot;msg&quot;).setProp(&quot;Value&quot;,&quot;Impossible to find the variable internalstep to run any internal process ! &lt;br&gt;Something is going wrong ! Check the step in your main macro.&quot;)
        
        errScreen.addComponent(&quot;btn&quot;,&quot;SimpleButton&quot;)
        errScreen.component(&quot;btn&quot;).setProp(&quot;value&quot;,&quot;OK&quot;)
        
        'Adding some additionnal textbox to store MacroID value
        errScreen.addComponent(&quot;macros_id&quot;,&quot;TextBox&quot;)
        errScreen.component(&quot;macros_id&quot;).visible(false)
        errScreen.component(&quot;macros_id&quot;).setProp(&quot;defaultValue&quot;,xml_dialog.get_macros_id())
        
        xml_dialog.set_size( errScreen.Width,errScreen.Height)
        xml_components.write(errScreen.render)
      
      end if
      
      xml_header = &quot;&lt;?xml version='1.0' encoding='utf-8'?&gt;&lt;VDOMFormContainer&gt;&lt;Properties&gt;&lt;Property name='label'&gt;&quot; &amp; wrappToCData(title) &amp; &quot;&lt;/Property&gt;&lt;/Properties&gt;&lt;Components&gt;&quot; 
      xml_dialog.show_xml_form ( xml_header &amp; xml_components.getvalue &amp;  xml_footer  )
    
    end sub
    
    sub ProShareRefresh(itempos)
      xml_dialog.executeCallback(&quot;selectEltOfPath&quot;, &quot;{ itemid : &quot; &amp; cstr(itempos) &amp; &quot;}&quot;)
    end sub
    
    sub showScreen(screenName)
    
      dim Title
      set xml_components = Buffer.create
      xml_footer = &quot;&lt;/Components&gt;&lt;/VDOMFormContainer&gt;&quot;
 
      if screenName in Screen then
      
        host = system.application_hosts
        title = Screen(screenName).Title
        args = xml_dialog.get_answer
        
        'Adding some additionnal textbox to store the selected Tab
        Screen(screenName).addComponent(&quot;tabselected&quot;,&quot;TextBox&quot;)
        Screen(screenName).component(&quot;tabselected&quot;).visible(false)
        Screen(screenName).component(&quot;tabselected&quot;).setProp(&quot;defaultValue&quot;,args(&quot;tabselected&quot;))
        
        'Adding some additionnal textbox to store Next Step
        Screen(screenName).addComponent(&quot;step&quot;,&quot;TextBox&quot;)
        Screen(screenName).component(&quot;step&quot;).visible(false)
        Screen(screenName).component(&quot;step&quot;).setProp(&quot;defaultValue&quot;,Screen(screenName).getNextStep)
        
        'Adding some additionnal textbox to store MacroID value        
        Screen(screenName).addComponent(&quot;macros_id&quot;,&quot;TextBox&quot;)
        Screen(screenName).component(&quot;macros_id&quot;).visible(false)
        Screen(screenName).component(&quot;macros_id&quot;).setProp(&quot;defaultValue&quot;,xml_dialog.get_macros_id())
        
        'Adding css for tooltip
        Screen(screenName).addComponent(&quot;--HINT_CSS&quot;,&quot;Hypertext&quot;)
        Screen(screenName).component(&quot;--HINT_CSS&quot;).visible(false)
        Screen(screenName).component(&quot;--HINT_CSS&quot;).setProp(&quot;Value&quot;,&quot;&lt;style type=&quot;&quot;text/css&quot;&quot; media=&quot;&quot;screen&quot;&quot;&gt;.hint,[data-hint]{position:relative;display:inline-block}.hint:before,.hint:after,[data-hint]:before,[data-hint]:after{position:absolute;-webkit-transform:translate3d(0,0,0);-moz-transform:translate3d(0,0,0);transform:translate3d(0,0,0);visibility:hidden;opacity:0;z-index:1000000;pointer-events:none;-webkit-transition:.3s ease;-moz-transition:.3s ease;transition:.3s ease}.hint:hover:before,.hint:hover:after,.hint:focus:before,.hint:focus:after,[data-hint]:hover:before,[data-hint]:hover:after,[data-hint]:focus:before,[data-hint]:focus:after{visibility:visible;opacity:1}.hint:before,[data-hint]:before{content:'';position:absolute;background:transparent;border:6px solid transparent;z-index:1000001}.hint:after,[data-hint]:after{content:attr(data-hint);background:#383838;color:#fff;text-shadow:0 -1px 0 #000;padding:8px 10px;font-size:12px;line-height:12px;white-space:nowrap;box-shadow:4px 4px 8px rgba(0,0,0,.3)}.hint--top:before{border-top-color:#383838}.hint--bottom:before{border-bottom-color:#383838}.hint--left:before{border-left-color:#383838}.hint--right:before{border-right-color:#383838}.hint--top:before{margin-bottom:-12px}.hint--top:after{margin-left:-18px}.hint--top:before,.hint--top:after{bottom:100%;left:50%}.hint--top:hover:after,.hint--top:hover:before,.hint--top:focus:after,.hint--top:focus:before{-webkit-transform:translateY(-8px);-moz-transform:translateY(-8px);transform:translateY(-8px)}.hint--bottom:before{margin-top:-12px}.hint--bottom:after{margin-left:-18px}.hint--bottom:before,.hint--bottom:after{top:100%;left:50%}.hint--bottom:hover:after,.hint--bottom:hover:before,.hint--bottom:focus:after,.hint--bottom:focus:before{-webkit-transform:translateY(8px);-moz-transform:translateY(8px);transform:translateY(8px)}.hint--right:before{margin-left:-12px;margin-bottom:-6px}.hint--right:after{margin-bottom:-14px}.hint--right:before,.hint--right:after{left:100%;bottom:50%}.hint--right:hover:after,.hint--right:hover:before,.hint--right:focus:after,.hint--right:focus:before{-webkit-transform:translateX(8px);-moz-transform:translateX(8px);transform:translateX(8px)}.hint--left:before{margin-right:-12px;margin-bottom:-6px}.hint--left:after{margin-bottom:-14px}.hint--left:before,.hint--left:after{right:100%;bottom:50%}.hint--left:hover:after,.hint--left:hover:before,.hint--left:focus:after,.hint--left:focus:before{-webkit-transform:translateX(-8px);-moz-transform:translateX(-8px);transform:translateX(-8px)}.hint--error:after{background-color:#b34e4d;text-shadow:0 -1px 0 #592726}.hint--error.hint--top:before{border-top-color:#b34e4d}.hint--error.hint--bottom:before{border-bottom-color:#b34e4d}.hint--error.hint--left:before{border-left-color:#b34e4d}.hint--error.hint--right:before{border-right-color:#b34e4d}.hint--warning:after{background-color:#c09854;text-shadow:0 -1px 0 #6c5328}.hint--warning.hint--top:before{border-top-color:#c09854}.hint--warning.hint--bottom:before{border-bottom-color:#c09854}.hint--warning.hint--left:before{border-left-color:#c09854}.hint--warning.hint--right:before{border-right-color:#c09854}.hint--info:after{background-color:#3986ac;text-shadow:0 -1px 0 #193b4d}.hint--info.hint--top:before{border-top-color:#3986ac}.hint--info.hint--bottom:before{border-bottom-color:#3986ac}.hint--info.hint--left:before{border-left-color:#3986ac}.hint--info.hint--right:before{border-right-color:#3986ac}.hint--success:after{background-color:#458746;text-shadow:0 -1px 0 #1a321a}.hint--success.hint--top:before{border-top-color:#458746}.hint--success.hint--bottom:before{border-bottom-color:#458746}.hint--success.hint--left:before{border-left-color:#458746}.hint--success.hint--right:before{border-right-color:#458746}.hint--always:after,.hint--always:before{opacity:1;visibility:visible}.hint--always.hint--top:after,.hint--always.hint--top:before{-webkit-transform:translateY(-8px);-moz-transform:translateY(-8px);transform:translateY(-8px)}.hint--always.hint--bottom:after,.hint--always.hint--bottom:before{-webkit-transform:translateY(8px);-moz-transform:translateY(8px);transform:translateY(8px)}.hint--always.hint--left:after,.hint--always.hint--left:before{-webkit-transform:translateX(-8px);-moz-transform:translateX(-8px);transform:translateX(-8px)}.hint--always.hint--right:after,.hint--always.hint--right:before{-webkit-transform:translateX(8px);-moz-transform:translateX(8px);transform:translateX(8px)}.hint--rounded:after{border-radius:4px}.hint--bounce:before,.hint--bounce:after{-webkit-transition:opacity .3s ease,visibility .3s ease,-webkit-transform .3s cubic-bezier(0.71,1.7,.77,1.24);-moz-transition:opacity .3s ease,visibility .3s ease,-moz-transform .3s cubic-bezier(0.71,1.7,.77,1.24);transition:opacity .3s ease,visibility .3s ease,transform .3s cubic-bezier(0.71,1.7,.77,1.24)}&lt;/style&gt;&quot;)

        'Adding progessbar
        Screen(screenName).addComponent(&quot;progressbar&quot;,&quot;Hypertext&quot;)
        Screen(screenName).component(&quot;progressbar&quot;).visible(false)
        'topLoaderSize = cstr((cint(Screen(screenName).height)/3.2))
        if Screen(screenName).height &lt; 170 then
          topLoaderSize = cstr(Screen(screenName).height - 90)          
        else
          topLoaderSize = &quot;100&quot;
        end if
        'posLeft = cstr(cint((Screen(screenName).width - cint((Screen(screenName).height)/3.2))/2))
        posLeft = cstr(Screen(screenName).width - 125)
        'posTop = cstr(cint((Screen(screenName).height - 50 - cint((Screen(screenName).height)/3.2))/2))
        posTop = &quot;28&quot;
  
        set html = buffer.create
        logger tojson(host)
        html.write &quot;&lt;script src='//&quot; &amp; host(0) &amp; resources.public_link(&quot;jquery.percentageloader-0.1.min.js&quot;) &amp; &quot;'&gt;&lt;/script&gt;&quot;
        html.write &quot;&lt;style type=&quot;&quot;text/css&quot;&quot; media=&quot;&quot;screen&quot;&quot; &gt;&quot; &amp; resources.open(&quot;jquery.percentageloader-0.1.css&quot;).getvalue &amp; &quot;&lt;/style&gt;&quot;
        html.write &quot;&lt;script&gt;&quot;
        html.write &quot;$('#o_&quot; &amp; Replace(xml_dialog.containerGUID,&quot;-&quot;,&quot;_&quot;) &amp; &quot;').append( &quot;&quot;&lt;div id='topLoader' style='position: absolute; top: &quot;+posTop+&quot;px; left: &quot;+posLeft+&quot;px;'&gt;&lt;/div&gt;&quot;&quot; );&quot;
        html.write &quot;var $topLoader = $('#topLoader').percentageLoader({width: &quot;+topLoaderSize+&quot;, height: &quot;+topLoaderSize+&quot; , controllable : false, progress : 0.0, onProgressUpdate : function(val) {&quot;
        'html.write &quot;      $topLoader.setValue(Math.round(val * 100.0));&quot;
        html.write &quot;    }});&quot;
        'html.write &quot;var topLoaderRunning = false;&quot;
        'html.write &quot;topLoaderRunning = true;&quot;
        html.write &quot;$topLoader.setProgress(0);&quot;
        html.write &quot;$topLoader.setValue('...');&quot;
        html.write &quot;$('#topLoader').css('visibility','hidden')&quot;
        
        html.write &quot;&lt;/script&gt;&quot;
        
        Screen(screenName).component(&quot;progressbar&quot;).setProp(&quot;Value&quot;,html.getValue)

        'Adding some script for e2VDOM management for tooltip
        Screen(screenName).addComponent(&quot;E2VDOM&quot;,&quot;Hypertext&quot;)
        Screen(screenName).component(&quot;E2VDOM&quot;).visible(false)
        set html = buffer.create
        html.write &quot;&lt;script type='text/javascript'&gt;&quot;
        html.write &quot;e2vdomSV['DialogGUID'] = '#o_&quot; &amp; Replace(xml_dialog.containerGUID,&quot;-&quot;,&quot;_&quot;) &amp; &quot;';&quot;
        html.write &quot;e2vdomSV['MacrosID'] = '&quot; &amp; xml_dialog.get_macros_id() &amp; &quot;';&quot;
        
        'set callbackfunctions
        html.write resources.open(&quot;dialog_v2_callback.js&quot;).getvalue
        html.write &quot;&lt;/script&gt;&quot;
        Screen(screenName).component(&quot;E2VDOM&quot;).setProp(&quot;Value&quot;,html.getValue)
        
        xml_dialog.set_size( Screen(screenName).Width,Screen(screenName).Height)
        xml_components.write(Screen(screenName).render)
      else
        set errScreen = New XMLScreen
        
        title = &quot;No Screen found !&quot;
        
        'Create the message to show
        errScreen.addComponent(&quot;msg&quot;,&quot;Hypertext&quot;)
        errScreen.component(&quot;msg&quot;).setProp(&quot;Value&quot;,&quot;Impossible to find the screen (&lt;b&gt;&quot; &amp; screenName &amp; &quot;&lt;/b&gt;) in the list of screen created !&quot;)
        
        'Adding some additionnal textbox to store Next Step
        errScreen.addComponent(&quot;step&quot;,&quot;TextBox&quot;)
        errScreen.component(&quot;step&quot;).visible(false)
        errScreen.component(&quot;step&quot;).setProp(&quot;defaultValue&quot;,errScreen.getNextStep)
        
        'Adding some additionnal textbox to store MacroID value
        errScreen.addComponent(&quot;macros_id&quot;,&quot;TextBox&quot;)
        errScreen.component(&quot;macros_id&quot;).visible(false)
        errScreen.component(&quot;macros_id&quot;).setProp(&quot;defaultValue&quot;,xml_dialog.get_macros_id())
        
        xml_dialog.set_size( errScreen.Width,errScreen.Height)
        xml_components.write(errScreen.render)
      end if
      
      xml_header = &quot;&lt;?xml version='1.0' encoding='utf-8'?&gt;&lt;VDOMFormContainer&gt;&lt;Properties&gt;&lt;Property name='label'&gt;&quot; &amp; wrappToCData(title) &amp; &quot;&lt;/Property&gt;&lt;/Properties&gt;&lt;Components&gt;&quot; 
      xml_dialog.show_xml_form ( xml_header &amp; xml_components.getvalue &amp; templateScreen &amp;  xml_footer  )

    end sub
    
end class</source>
		
	
		<class_name></class_name>
		
	
		<is_button>0</is_button>
		
	
		<ob_board>0</ob_board>
		
	
		<macros_picture></macros_picture>
		
	
		<description></description>
		
	
		<guid>cf984487-f658-4871-8716-03f530cc79cf</guid>
		
	
		<timer_guid></timer_guid>
		
	
		<custom_event_guid></custom_event_guid>
		
	
		<page></page>
		
	
		<type>library</type>
	</macro>
	
	
	<macro>
		
	
		<name>lib_utils</name>
		
	
		<source>'####################################################################################################
'#                        Various functions that can simplify some operation                        #
'#--------------------------------------------------------------------------------------------------#
'# Some functions commonly used in macro.                                                           #
'#                                                                                                  #
'####################################################################################################

'Guid of macro
macrodic = Dictionary(&quot;Action&quot;,&quot;0b8b7eaf-439a-40f4-80e6-f9532ec980b7&quot;)


'-------------------------------------- ParseArg -----------------------------------------------
' if the key exist in args dictionary that should be this one made with arguments passed
' to the macro, return the value, if not return default value
'-----------------------------------------------------------------------------------------------

Function ParseArg( key, defaultValue )
  if key in args then
    if args(key) &lt;&gt; &quot;&quot; then
      ParseArg = args( key )
    else
      ParseArg = defaultValue
    end if
  else
    ParseArg = defaultValue
  end if
End Function

'-------------------------------------- SaveToDBdictionary -------------------------------------
' Save the value un the internal db dictionary, it value is Empty distroy the key.
' 
'-----------------------------------------------------------------------------------------------

Sub SaveToDBdictionary( key, value )
  if isEmpty( value ) then
    dbdictionary.remove( key )
  else
    dbdictionary( key ) = value 
  end if
End Sub

'-------------------------------------- IsEmptyArray -------------------------------------------
' Return true is the Array is empty, false if not.
' 
'-----------------------------------------------------------------------------------------------

Function IsEmptyArray( massive )
  if typename(massive)=&quot;Array&quot; then
    if len(massive) &lt;&gt; 0 then
      isEmptyArray = False
    else
      isEmptyArray = True
    end if
  end if
End Function

'-------------------------------------- AppendToArray ------------------------------------------
'append new value to the end of array
' 
'-----------------------------------------------------------------------------------------------

Function AppendToArray( mass, value )
  if typename(mass)=&quot;Array&quot; then
    array_len = -1
    if not IsEmptyArray( mass ) then
      array_len = ubound( mass )
    end if
    Redim Preserve mass( array_len + 1 )
    mass( array_len + 1 ) = value
    AppendToArray =  array_len + 1
  end if
End Function

'-------------------------------------- RemoveFromArray ------------------------------------------
'remove a value from an array
' 
'-----------------------------------------------------------------------------------------------

Function RemoveFromArray(mass, value )
'  logger (&quot;RemoveFromArray IN :&quot; &amp; tojson(mass))
'  logger (&quot;Value to DELETE :&quot; &amp; value)
  if typename(mass)=&quot;Array&quot; then
    oldArray = mass
    mass = Array
    for each element in oldArray
      if element&lt;&gt;value then
        AppendToArray(mass,element)
      end if
    next
  end if
'  logger (&quot;RemoveFromArray OUT :&quot; &amp; tojson(mass))
End Function

'-------------------------------------- ExistInArray ------------------------------------------
'Check if a value exist already in an Array
' 
'-----------------------------------------------------------------------------------------------
Function ExistInArray(mass, value )
  ExistInArray = false
  if typename(mass)=&quot;Array&quot; then
    for each element in mass
      if element=value then
        ExistInArray = true
        exit for
      end if
    next
  end if
end function

'-------------------------------------- normalize ----------------------------------------------
'Remove space &amp; accents
' 
'-----------------------------------------------------------------------------------------------

function normalize(byval str)

  normint=&quot;&quot;
  accents     = &quot;àáâãäçèéêëìíîïñòóôõöùúûüýÿÀÁÂÃÄÇÈÉÊËÌÍÎÏÑÒÓÔÕÖÙÚÛÜÝ&quot;
  noaccents   = &quot;aaaaaceeeeiiiinooooouuuuyyAAAAACEEEEIIIINOOOOOUUUUY&quot;

  str = lcase(str)
  'delete space
  str = replace (str,&quot; &quot; ,&quot;_&quot;)
  str = replace (str,&quot;'&quot; ,&quot;_&quot;)
  str = replace (str,&quot;’&quot; ,&quot;_&quot;)
  str = replace (str,&quot;°&quot; ,&quot;_&quot;)
  'delete special char
  set r = new RegExp
  r.IgnoreCase = true
  r.Global = true
  r.Pattern = &quot;[\\/:&quot;&quot;*?&lt;&gt;|]+&quot;
  str = r.Replace(str, &quot;&quot;)
  
  'remove accents
  for i=1 to len(str)
    v = mid(str,i,1)
    if InStr(accents,v) &lt;&gt; 0 then
     normint = normint + mid(noaccents,InStr(accents,v),1)
    else
     normint = normint + v
    end if
  next
  
  normalize = normint
  
end function

'-------------------------------------- toascii ------------------------------------------------
' convert with the notation &amp;#xxx; non ascii stuff
' 
'-----------------------------------------------------------------------------------------------

function toascii(byval str)

  toascii=&quot;&quot;
  for i=1 to len(str)
    v = mid(str,i,1)
    a = asc(v)
    if (a&gt;=48 and a&lt;=57) or (a&gt;=65 and a&lt;=90) or (a&gt;=95 and a&lt;=122) then
      toascii=toascii+v
    else
      toascii=toascii+&quot;&amp;#&quot;+cstr(a)+&quot;;&quot;
    end if
  next

end function

'-------------------------------------- getAppName ---------------------------------------------
' Return the name of the application stored in ProAdmin
' 
'-----------------------------------------------------------------------------------------------

function getAppName(appName)
  
    select case lcase(appName)
  
    case &quot;proadmin&quot;
      appGuid = &quot;491d4c93-4089-4517-93d3-82326298da44&quot;
    case &quot;procontact&quot;
      appGuid = &quot;526ae088-8004-469c-9d8e-cea715f8f63b&quot;
    case &quot;proplanning&quot;
      appGuid = &quot;22d43054-9861-48e8-875f-53d09bb1fd11&quot;
    case &quot;prosearch&quot;
      appGuid = &quot;fc2221b2-794b-4c40-991f-6c7c2f61dbc2&quot;
    case &quot;proshare&quot;
      appGuid = &quot;b0a274f0-22bc-44be-be48-da6ec9180268&quot;
      
  end select
  
  AppSearchName = &quot;&quot;
  
  for each app in proadmin.registeredApplications
    if app.guid = appGuid then
      AppSearchName = app.title
      Exit For
    end if
  next
  
  if AppSearchName=&quot;&quot; then
    getAppName = &quot;&quot;
  else
    getAppName = AppSearchName
  end if

end function

'-------------------------------------- ApplicationConnection -------------------------------
' Return an object that represent a connection to the App given in parameters
' 
'-----------------------------------------------------------------------------------------------

Function ApplicationConnection( appName, host, login, password )

  select case lcase(appName)
  
    case &quot;proadmin&quot;
      appGuid = &quot;491d4c93-4089-4517-93d3-82326298da44&quot;
    case &quot;procontact&quot;
      appGuid = &quot;526ae088-8004-469c-9d8e-cea715f8f63b&quot;
    case &quot;proplanning&quot;
      appGuid = &quot;22d43054-9861-48e8-875f-53d09bb1fd11&quot;
    case &quot;prosearch&quot;
      appGuid = &quot;fc2221b2-794b-4c40-991f-6c7c2f61dbc2&quot;
    case &quot;proshare&quot;
      appGuid = &quot;b0a274f0-22bc-44be-be48-da6ec9180268&quot;
      
  end select
  
  AppSearchName = &quot;&quot;
  
  for each app in proadmin.registeredApplications
    if app.guid = appGuid then
      AppSearchName = app.title
      Exit For
    end if
  next
  
  if AppSearchName=&quot;&quot; then
    ApplicationConnection = array(0)
    Exit Function
  else
    'logger &quot;App Name for &quot; &amp; appName &amp; &quot; is: &quot; &amp; AppSearchName

    Try
      Set ServerConnection = New WHOLEConnection
      ServerConnection.Open( host, login, password )
    Catch 
      ApplicationConnection = array(1)
      Exit Function
    End Try
    
    Set App = Nothing
    Try
      Set App = ServerConnection.Applications( AppSearchName )
    Catch
      ApplicationConnection = array(2)
      Exit Function
    End Try
    t = array(3,1)
    set t(1) = App
    ApplicationConnection = t
  end if
End Function

'-------------------------------------- BuildPath ----------------------------------------------
' If doesn't exist build a path given in paramter
' 
'-----------------------------------------------------------------------------------------------
function BuildPath(path)
  try
    pathArray = split(path,&quot;/&quot;) 
    for each fol in pathArray
      if fol=&quot;&quot; then 
        curPath=&quot;&quot;
      else
        set getNode = ProShare.get_by_path(curPath &amp; &quot;/&quot; &amp; fol)
        if TypeName(getNode) = &quot;Nothing&quot; then
          if curPath=&quot;&quot; then curPath=&quot;/&quot;
            ProShare.get_by_path(curPath).mkdir(fol)
          end if
          if curPath=&quot;/&quot; then
            curPath = &quot;/&quot; &amp; fol
          else
            curPath = curPath &amp; &quot;/&quot; &amp; fol
          end if
        end if
    next
    BuildPath = true
  catch
    BuildPath = false
  end try
end function

'-------------------------------------- EscapeStr ----------------------------------------------
' Escape special chat to fit with HTML representation
' 
'-----------------------------------------------------------------------------------------------

Function EscapeStr( data )  
  
  data = Replace( data, &quot;&amp;&quot;, &quot;&amp;&quot; &amp; &quot;amp;&quot;  )
  data = Replace( data, &quot;&lt;&quot;, &quot;&amp;&quot; &amp; &quot;lt;&quot;   )
  data = Replace( data, &quot;&gt;&quot;, &quot;&amp;&quot; &amp; &quot;gt;&quot;   )
  data = BBCode( data )
  EscapeStr = data
  
End Function

'-------------------------------------- BBCode ----------------------------------------------
' Replace specific code to its equivalent in HTML
' 
'-----------------------------------------------------------------------------------------------

Function BBCode( data )

  data = Replace( data, &quot;[b]&quot;, &quot;&lt;strong&gt;&quot; )
  data = Replace( data, &quot;[/b]&quot;, &quot;&lt;/strong&gt;&quot; ) 
  
  data = Replace( data, &quot;[i]&quot;, &quot;&lt;em&gt;&quot; )
  data = Replace( data, &quot;[/i]&quot;, &quot;&lt;/em&gt;&quot; ) 
  
  data = Replace( data, &quot;[u]&quot;, &quot;&lt;span style=&quot;&quot;text-decoration: underline;&quot;&quot;&gt;&quot; )
  data = Replace( data, &quot;[/u]&quot;, &quot;&lt;/span&gt;&quot; ) 
    
  data = Replace( data, &quot;[s]&quot;, &quot;&lt;span style=&quot;&quot;text-decoration:line-through&quot;&quot;&gt;&quot; )
  data = Replace( data, &quot;[/s]&quot;, &quot;&lt;/span&gt;&quot; ) 
  
  data = Replace( data, &quot;[code]&quot;, &quot;&lt;pre&gt;&quot; )
  data = Replace( data, &quot;[/code]&quot;, &quot;&lt;/pre&gt;&quot; ) 
  
  data = Replace( data, &quot;[crlf]&quot;, &quot;&lt;br/&gt;&quot; )
  
  BBCode = data

End Function

'-------------------------------------- WriteToHistory ------------------------------------------
' Write data into a specific dictionary attached to a file guid key.
' 
'-----------------------------------------------------------------------------------------------

sub WriteToHistory(file_guid,type,comment)
 
    set file = ProShare.node.get_by_guid( file_guid )
    set user = ProAdmin.current_user
    
    if TypeName(DBdictionary(file.guid)) = &quot;Empty&quot; then
      FileData = Dictionary(&quot;history&quot;,dictionary,&quot;context&quot;,&quot;&quot;)
    else
      FileData = asjson(replace(DBdictionary(file_guid),&quot;&quot;&quot;history&quot;&quot;: {}&quot;,&quot;&quot;&quot;history&quot;&quot;: &quot;&quot;&quot;&quot;&quot;))
    end if
    if typename(FileData(&quot;history&quot;))=&quot;Dictionary&quot; then
      InternalData       = FileData(&quot;history&quot;)
    else
      InternalData       = Dictionary
    end if
    
    newComment         = Dictionary
    newComment(&quot;who&quot;)  = user.name
    newComment(&quot;date&quot;) = now
    newComment(&quot;msg&quot;)  = EscapeStr(comment)
    
    select case type
      case &quot;indoc&quot;
        newComment(&quot;type&quot;)=&quot;arrive_doc.png&quot;
      case &quot;move&quot;
        newComment(&quot;type&quot;)=&quot;deplacement.png&quot;
      case &quot;comment&quot;
        newComment(&quot;type&quot;)=&quot;commentaire.png&quot;
      case &quot;updatestate&quot;
        newComment(&quot;type&quot;)=&quot;change.png&quot;
    end select
    randomize
    guid = md5(cstr(now)+cstr(rnd*1000))
    InternalData(guid)=newComment
    FileData(&quot;history&quot;) = InternalData
    DBdictionary(file.guid)= tojson(FileData)

end sub

'-------------------------------------- setRights ----------------------------------------------
' Generate tasks to modify the rights of a user over a given path. 
' 
'-----------------------------------------------------------------------------------------------

function setRights(path,userEmail)

  folder_list = Array              
  parents_path = split(path,&quot;/&quot;)
  pathstring=&quot;&quot;
  AppendToArray(folder_list,&quot;/&quot;)
              
  for each elt in parents_path
    if elt &lt;&gt; &quot;&quot; then
      pathstring = pathstring &amp; &quot;/&quot; &amp; elt
      AppendToArray(folder_list,pathstring)
    end if
  next
              
  if dbdictionary( &quot;RightToManage&quot; )= &quot;&quot; then
    ArrayOfTasks=Array
  else
    ArrayOfTasks=asjson(dbdictionary( &quot;RightToManage&quot; ))
  end if
              
  AppendToArray(ArrayOfTasks,dictionary(userEmail,folder_list))
  dbdictionary( &quot;RightToManage&quot; )=ToJson(ArrayOfTasks)
  set objTimer = GetTimer(&quot;BackgroundSetRights&quot;)
      objTimer.is_active=true
              
  Logger (&quot;Task to manage rights for users had been added to queue : &quot; &amp; dbdictionary( &quot;RightToManage&quot; ))

end function

'-------------------------------------- FormatEmail --------------------------------------------
' Replace each key like {KeyWord} in a given string by it's value &amp; format it to be sent by mail. 
' 
'-----------------------------------------------------------------------------------------------

Function FormatEmail(mail,data)

  mailformated = EscapeStr(mail)
  mailformated = replace(mailformated,chr(10),&quot;&lt;br&gt;&quot;)
  if lcase(TypeName(data))=&quot;dictionary&quot; then
    for each key in data
       mailformated = replace(mailformated,&quot;{&quot; &amp; key &amp; &quot;}&quot;,data(key))
    next
  end if
  
  FormatEmail = &quot;&lt;HTML&gt;&lt;BODY&gt; &quot; &amp; mailformated &amp; &quot;&lt;/BODY&gt;&lt;/HTML&gt;&quot;
end function

'-------------------------------------- FileExists ---------------------------------------------
' Return true if the file with absolute path exist &amp; false if not. 
' 
'-----------------------------------------------------------------------------------------------

Function FileExists(path)
  set file = ProShare.get_by_path(path)
  if isNothing(file) then
    FileExists = false
  else
    FileExists = true
  end if
End Function

'-------------------------------------- FixFilename ---------------------------------------------
' Delete from the file name the unapropriate char
' 
'-----------------------------------------------------------------------------------------------

Function FixFilename(filename) 
  set r = new RegExp
  r.IgnoreCase = true
  r.Global = true
  r.Pattern = &quot;[\\/:&quot;&quot;*?&lt;&gt;|]+&quot;
  FixFileName = r.Replace(filename, &quot;&quot;)
End Function

'-------------------------------------- MoveFile -----------------------------------------------
' Move a file from the current place to the target one. 
' 
'-----------------------------------------------------------------------------------------------

function MoveFile(ObjFile,targetPath)

  fileGUID = objFile.guid
  fileData = dbdictionary( fileGUID )
  
  if mid(targetPath,1,2)=&quot;./&quot; then
    targetPath = replace (targetPath,&quot;./&quot;,ObjFile.parent.path + &quot;/&quot;)  
  elseif mid(targetPath,1,3)=&quot;../&quot; then
    targetPath = replace (targetPath,&quot;../&quot;,ObjFile.parent.parent.path + &quot;/&quot;)
  elseif mid(targetPath,1,4)=&quot;.../&quot; then
    targetPath = replace (targetPath,&quot;.../&quot;,ObjFile.parent.parent.parent.path + &quot;/&quot;)
  end if

  buildPath(targetPath)
  
  while FileExists(targetPath &amp; &quot;/&quot; &amp; ObjFile.name) 
      ObjFile.name = &quot;_&quot; &amp; ObjFile.name
  wend

  filename = ObjFile.name  
  ObjFile.copy(targetPath)
  set objFolderTarget = ProShare.get_by_path(targetPath)
  readRules = objFolderTarget.rules( Empty, &quot;r&quot; )
  writeRules = objFolderTarget.rules( Empty, &quot;w&quot; )
  ownerRules = objFolderTarget.rules( Empty, &quot;d&quot; )
  ObjFile.delete
  set newFile = ProShare.get_by_path(targetPath &amp; &quot;/&quot; &amp; filename)
  for each srule in readRules
    newFile.addRule(srule.subject,&quot;r&quot;)
  next
  for each srule in writeRules
    newFile.addRule(srule.subject,&quot;w&quot;)
  next
  for each srule in ownerRules
    newFile.addRule(srule.subject,&quot;d&quot;)
  next
  dbdictionary( newFile.guid ) = fileData
  WriteToHistory(newFile.guid,&quot;move&quot;,&quot;Déplacement du fichier vers : &quot; &amp; targetPath) 
  
  set MoveFile = newFile

end function

'-------------------------------------- toISODate -----------------------------------------------
' Take a local date &amp; transform it to ISO format
' 
'-----------------------------------------------------------------------------------------------

Function toISODate(inDate)
	'if isDate(inDate) then
		jour	= mid(cstr(indate),1,2)
		mois  = mid(cstr(indate),4,2)
		annee   = mid(cstr(indate),7,4)
		toISODate = annee &amp; &quot;-&quot; &amp; mois &amp; &quot;-&quot; &amp; jour
	'Else
	'	toISODate = &quot;&quot;
	'End If
End Function

'-------------------------------------- fromISODate -----------------------------------------------
' reverse teh toISODate function
' 
'-----------------------------------------------------------------------------------------------

Function fromISODate(inDate)

	jour	= mid(cstr(indate),9,2)
	mois  = mid(cstr(indate),6,2)
	annee   = mid(cstr(indate),1,4)
	fromISODate = cstr(jour &amp; &quot;/&quot; &amp; mois &amp; &quot;/&quot; &amp; annee)
End Function

'-------------------------------------- SimpleIf -----------------------------------------------
' make If as a function
' 
'-----------------------------------------------------------------------------------------------

Function SimpleIf( expr, ret1, ret2 )
  if expr then
    SimpleIf = ret1
  else
    SimpleIf = ret2
  end if
End Function

'-------------------------------------- CreateGUID ---------------------------------------------
' generate a GUID like string
' 
'-----------------------------------------------------------------------------------------------

Function CreateGUID()
  Randomize
  Dim tmpCounter, tmpGUID
  Const strValid = &quot;0123456789abcdef&quot;
  For tmpCounter = 1 To 8
    tmpGUID = tmpGUID &amp; Mid(strValid, Int(Rnd(1) * Len(strValid)) + 1, 1)
  Next
  tmpGUID = tmpGUID &amp; &quot;-&quot;
  For tmpCounter = 1 To 4
    tmpGUID = tmpGUID &amp; Mid(strValid, Int(Rnd(1) * Len(strValid)) + 1, 1)
  Next
  tmpGUID = tmpGUID &amp; &quot;-&quot;
  For tmpCounter = 1 To 4
    tmpGUID = tmpGUID &amp; Mid(strValid, Int(Rnd(1) * Len(strValid)) + 1, 1)
  Next
  tmpGUID = tmpGUID &amp; &quot;-&quot;
  For tmpCounter = 1 To 4
    tmpGUID = tmpGUID &amp; Mid(strValid, Int(Rnd(1) * Len(strValid)) + 1, 1)
  Next
  tmpGUID = tmpGUID &amp; &quot;-&quot;
  For tmpCounter = 1 To 12
    tmpGUID = tmpGUID &amp; Mid(strValid, Int(Rnd(1) * Len(strValid)) + 1, 1)
  Next
  CreateGUID = tmpGUID
End Function

'-------------------------------------- FileDataManagement -------------------------------------
' Object that represent a file &amp; its meta data
' 
'-----------------------------------------------------------------------------------------------

class FileDataManagement

  dim fileGUID
  dim FileData
  

  Sub Class_Initialize( )
    try      
      set file = page_status.selected_nodes(0)
      fileGUID = file.guid
      loadFileDataFromDB
    catch
    end try
  end sub
  
  sub loadFileDataFromDB
    FileData= Dictionary
    if TypeName(DBdictionary(fileGUID)) = &quot;Empty&quot; then
      FileData = Dictionary(&quot;history&quot;,dictionary,&quot;context&quot;,&quot;&quot;)
    else
      FileData = asjson(replace(DBdictionary(fileGUID),&quot;&quot;&quot;history&quot;&quot;: {}&quot;,&quot;&quot;&quot;history&quot;&quot;: &quot;&quot;&quot;&quot;&quot;))
    end if

  end sub
  
  function getHistory
    getHistory = tojson(FileData(&quot;history&quot;))
  end function
  
  sub WrToHistory(type,msg)
    WriteToHistory(fileGUID,type,msg)
  end sub
  
  function getContext
 
    getContext = FileData(&quot;context&quot;)
  
  end function
  
  function storeContext(data)
    loadFileDataFromDB
    if typename(data)=&quot;Dictionary&quot; then
      if len(data) = 0 then
        FileData(&quot;context&quot;) = &quot;&quot;
      else
        FileData(&quot;context&quot;) = data
      end if
    else
      FileData(&quot;context&quot;) = data
    end if
    DBdictionary(FileData(&quot;context&quot;)(&quot;fileGUID&quot;)(&quot;value&quot;))= tojson(FileData)
  end function
  
  function getRulesList
     getActionList = FileData(&quot;rules&quot;)
  end function
  
end class

'-------------------------------------- Progress -------------------------------------
' This class allow to transmit data to the API progress indicator
' 
'-------------------------------------------------------------------------------------

class ProgressIndicator

  Sub Class_Initialize( )
     if sessiondictionary(&quot;ProgressID&quot;)=&quot;&quot; then
       sessiondictionary(&quot;ProgressID&quot;)=CreateGUID()
     end if
  end sub

  sub Progress (label,value,max)

    if sessiondictionary(&quot;ProgressID&quot;)&lt;&gt;&quot;&quot; then
      dbdictionary(sessiondictionary(&quot;ProgressID&quot;))= tojson(dictionary (&quot;label&quot;,cstr(label),&quot;value&quot;,value/max))
    end if
  
  end sub

  Sub Class_Terminate()
    if sessiondictionary(&quot;ProgressID&quot;)&lt;&gt;&quot;&quot; then
      if dbdictionary(sessiondictionary(&quot;ProgressID&quot;))&lt;&gt;&quot;&quot; then
        dbdictionary.remove(sessiondictionary(&quot;ProgressID&quot;))
      end if
    end if
  end sub

end class

'-------------------------------------- DateToUnixInt ------------------------------------------
' Convert a date to its unix format as a int in second from 01/01/1970
' 
'-----------------------------------------------------------------------------------------------

function DateToUnixInt(dateToConvert)
 
  if typename(dateToConvert)=&quot;Date&quot; then
    DateToUnixInt=DateDiff (&quot;s&quot;,cdate(&quot;01/01/1970&quot;),dateToConvert)
  else
    DateToUnixInt=0
  end if

end function


'-------------------------------------- UnixIntToDate ------------------------------------------
' Convert a date to its unix format as a int in second from 01/01/1970
' 
'-----------------------------------------------------------------------------------------------

function UnixIntToDate(intToConvert)

  if true then
    UnixIntToDate = DateAdd(&quot;s&quot;,intToConvert,cdate(&quot;01/01/1970&quot;))  
  end if

end function


'-------------------------------------- numInvoieTokenizer ------------------------------------------
' Usefull function needed for Analyse function in lib
' 
'-----------------------------------------------------------------------------------------------

function numInvoieTokenizer(curchar)
    select case lcase(curchar)
      case &quot;|&quot;
          numInvoieTokenizer =&quot;[NEEDED]&quot;
      case &quot;?&quot;
          numInvoieTokenizer =&quot;[ANY]&quot;
      case &quot;µ&quot;
          numInvoieTokenizer =&quot;[INVARIANT]&quot;
      case &quot;0&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,&quot;5&quot;,&quot;6&quot;,&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;~&quot;
          numInvoieTokenizer =&quot;[NUMERIC]&quot;
      case &quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;e&quot;,&quot;f&quot;,&quot;g&quot;,&quot;h&quot;,&quot;i&quot;,&quot;j&quot;,&quot;k&quot;,&quot;l&quot;,&quot;m&quot;,&quot;n&quot;,&quot;o&quot;,&quot;p&quot;,&quot;q&quot;,&quot;r&quot;,&quot;s&quot;,&quot;t&quot;,&quot;u&quot;,&quot;v&quot;,&quot;w&quot;,&quot;x&quot;,&quot;y&quot;,&quot;z&quot;,&quot;^&quot;
          numInvoieTokenizer =&quot;[ALPHA]&quot;
      case &quot;/&quot;,&quot;-&quot;,&quot;,&quot;,&quot;_&quot;,&quot;#&quot;,&quot; &quot;
          numInvoieTokenizer =&quot;[SPECIAL]&quot;
      case else
          numInvoieTokenizer =&quot;[UNKNOWN]&quot;
	end select
end function

'-------------------------------------- opMerging ----------------------------------------------
' function to merge 2 char in the context of learning procedure
' 
'-----------------------------------------------------------------------------------------------

function opMerging(mergedchar,curchar)

  select case numInvoieTokenizer(curchar)
      
      case &quot;[NUMERIC]&quot;
          select case numInvoieTokenizer(mergedchar)
              case &quot;[NUMERIC]&quot;
                  if mergedchar=curchar then
                      opMerging=curchar
                  else
                      opMerging =&quot;~&quot;
                  end if
              case &quot;[INVARIANT]&quot;
                  opMerging=curchar
              case else
                  opMerging =&quot;?&quot;             
          end select
          
      case  &quot;[ALPHA]&quot;
          select case numInvoieTokenizer(mergedchar)
              case &quot;[ALPHA]&quot;
                  if mergedchar=curchar then
                    opMerging=curchar
                  else
                    opMerging=&quot;^&quot;
                  end if
              case &quot;[INVARIANT]&quot;
                  opMerging=curchar
              case else
                  opMerging =&quot;?&quot;             
          end select      
      
      case &quot;[SPECIAL]&quot;
          select case numInvoieTokenizer(mergedchar)
              case &quot;[SPECIAL]&quot;
                  if mergedchar=curchar then
                    opMerging=curchar
                  else
                    opMerging=&quot;?&quot;
                  end if
              case &quot;[INVARIANT]&quot;
                  opMerging=curchar
              case else
                  opMerging =&quot;?&quot;             
          end select      
      
      case &quot;[UNKNOWN]&quot;
          select case numInvoieTokenizer(mergedchar)
              case &quot;[UNKNOWN]&quot;
                  if mergedchar=curchar then
                    opMerging=curchar
                  else
                    opMerging=&quot;?&quot;
                  end if
              case &quot;[INVARIANT]&quot;
                  opMerging=curchar
              case else
                  opMerging =&quot;?&quot;             
          end select      
      case else
          opMerging =&quot;?&quot;
  
  end select
      
end function

'-------------------------------------- BuildTemplate ------------------------------------------
' build a tempalte for the regEx generation based on exemples
' exmaxlen : Max len of the examples
'-----------------------------------------------------------------------------------------------

function BuildTemplate(exemples)
	if typename(exemples)=&quot;Array&quot; then
		exmaxlen = 0
		for each ex in exemples
			if len(ex)&gt;exmaxlen then
				exmaxlen = len(ex)
			end if
		next	
		outputTemplate = &quot;&quot;
		for i=1 to exmaxlen
			mergedchar = &quot;µ&quot;
			for each ex in exemples
				try
					curchar = mid(ex,i,1) 
				catch
					curchar = &quot;µ&quot;
				end try
				mergedchar = opMerging(mergedchar,curchar)
			next
			if mergedchar=&quot;^&quot; then
				mergedchar=&quot;A&quot;
			elseif numInvoieTokenizer(mergedchar) = &quot;[ALPHA]&quot; then
				mergedchar = &quot;|&quot;+mergedchar
			end if
            if mergedchar=&quot;~&quot; then
				mergedchar=&quot;0&quot;
			elseif numInvoieTokenizer(mergedchar) = &quot;[NUMERIC]&quot; then
				mergedchar = &quot;|&quot;+mergedchar
			end if
			outputTemplate = outputTemplate + mergedchar
			logger(&quot;outputTemplate : &quot; &amp; outputTemplate)
		next
		BuildTemplate = outputTemplate
	else
		BuildTemplate = &quot;&quot;
	end if
end function

'-------------------------------------- AnalyseBlock ------------------------------------------
' cut sequence with separators &amp; process analyse on each block recursively
' 
'-----------------------------------------------------------------------------------------------

function AnalyseBlock(exemples,separators)

  if typename(exemples)=&quot;Array&quot; and typename(separators)=&quot;Array&quot; then   
    if len(separators)=0 then
      'end of recurtion 
      AnalyseBlock = BuildTemplate(exemples)
    else
        curSeparator = separators(0)
        RemoveFromArray(separators,curSeparator)
        nbBlock = len(split(exemples(0),curSeparator))
        BlockArray = Array
        template = &quot;&quot;
        for each ex in exemples
            AppendToArray(BlockArray,Split(ex,curSeparator))
        next
        for i=0 to nbBlock-1
            tempBlock = Array
            for each block in BlockArray
                try
                    AppendtoArray(tempBlock,block(i))
                catch
                    AppendtoArray(tempBlock,&quot;&quot;)
                end try
            next
            template = template + curSeparator + AnalyseBlock(tempBlock,separators)
        next
      AnalyseBlock = mid(template,2)
    end if
  end if
end function

'-------------------------------------- VDOMEvent ----------------------------------------------
' Generate a js to launch a macro.
' 
'-----------------------------------------------------------------------------------------------

function VDOMEvent(macro,data)  
  VDOMEvent=&quot;&quot;
  if TypeName(data)=&quot;Dictionary&quot; then
    if macro in macrodic then
      data(&quot;macros_id&quot;)=macrodic(macro)
      VDOMEvent = &quot;javascript:execEventBinded('724748df_a464_486f_a324_4e9b3fc36fe0', 'custom', &quot; &amp; replace(tojson(data),&quot;&quot;&quot;&quot;,&quot;'&quot;) &amp; &quot;)&quot;
    end if
  end if
end function


'-------------------------------------- genTable ----------------------------------------------
' Allow to generate a table with data
' 
'-----------------------------------------------------------------------------------------------

function genTable(header,data,nbLigne,pos,color,csvname,token)

  refreshtable = false
  pos = cint(pos)
  mode = &quot;normal&quot;
  if nbLigne = 0 then
    mode=&quot;full&quot;
    nbligne = len(data)
  end if
  if mode=&quot;normal&quot; then
    if token = &quot;&quot; then
        token = cstr(cint(rnd * 1000))
        key = csvname+&quot;_&quot;+token 
        if dbdictionary(&quot;tabledata_session&quot;)&lt;&gt;&quot;&quot; then
            tabledata_session =  asjson(dbdictionary(&quot;tabledata_session&quot;))
            tabledata_session(key) = now
            dbdictionary(&quot;tabledata_session&quot;) = tojson(tabledata_session)
            set objTimer = getTimer(&quot;Session Clean up&quot;)
            objTimer.is_active=true
        else
            tabledata_session =  Dictionary
            tabledata_session(key) = now
            dbdictionary(&quot;tabledata_session&quot;) = tojson(tabledata_session)
        end if
        dbdictionary(key)= tojson(Dictionary(&quot;header&quot;,header,&quot;data&quot;,data,&quot;nbLigne&quot;,nbLigne,&quot;color&quot;,color))
    else
      refreshtable = true
    end if
  else
    token = cstr(cint(rnd * 1000))
  end if
  
  if mode=&quot;normal&quot; then
      colorCss = Dictionary(&quot;blue&quot;,&quot;genTable-blue.css&quot;,&quot;brown&quot;,&quot;genTable-brown.css&quot;,&quot;gray&quot;,&quot;genTable-gray.css&quot;,&quot;green&quot;,&quot;genTable-green.css&quot;,&quot;purple&quot;,&quot;genTable-purple.css&quot;,&quot;red&quot;,&quot;genTable-red.css&quot;)
      if lcase(color) in colorCss then
          tableStyle = &quot;&lt;Style&gt;&quot; &amp; replace(resources.open(colorCss(lcase(color))).getValue,&quot;datagrid&quot;,&quot;datagrid-&quot;+token) &amp; &quot;&lt;/Style&gt;&quot;
      else
          tableStyle = &quot;&lt;Style&gt;&quot; &amp; replace(resources.open(colorCss(&quot;blue&quot;)).getValue,&quot;datagrid&quot;,&quot;datagrid-&quot;+token) &amp; &quot;&lt;/Style&gt;&quot;    
      end if
  end if
  
  set tableData = buffer.create
      if not refreshtable then
          tableData.write(&quot;&lt;div id='datagrid_&quot;+token+&quot;' class='datagrid-&quot;+token+&quot;'&gt;&quot;)
      end if
      tableData.write(&quot;&lt;table &quot;+SimpleIf(mode=&quot;normal&quot;,&quot;&quot;,&quot;style='border:solid 1px #777777; border-collapse:collapse; font-family:verdana; font-size:11px;'&quot;)+&quot; &gt;&quot;)
      tableData.write(&quot;   &lt;thead&gt;&quot;)
      tableData.write(&quot;      &lt;tr &quot;+SimpleIf(mode=&quot;normal&quot;,&quot;&quot;,&quot;style='background-color:lightgrey;'&quot;)+&quot;&gt;&quot;)
      cpt=0
      selcol= -1
    for each col in header
      tableData.write(&quot;         &lt;th&gt;&quot;&amp;cstr(col)&amp;&quot;&lt;/th&gt;&quot;)
      if cstr(col)=&quot;sel&quot; then
        selcol=cpt
      end if
      cpt = cpt + 1
    next
      tableData.write(&quot;      &lt;/tr&gt;&quot;)
      tableData.write(&quot;   &lt;thead&gt;&quot;)
      tableData.write(&quot;   &lt;tfoot&gt;&quot;)
      tableData.write(&quot;      &lt;tr&gt;&quot;)
      tableData.write(&quot;         &lt;td colspan=&quot;&quot;&quot;&amp;cstr(len(header))&amp;&quot;&quot;&quot;&gt;&quot;)
      tableData.write(&quot;            &lt;div id=&quot;&quot;paging&quot;&quot;&gt;&quot;)
    if len(data)&gt;nbligne then
      tableData.write(&quot;               &lt;ul&gt;&quot;)
    if pos&lt;&gt;1 then
      tableData.write(&quot;                  &lt;li&gt;&lt;a href=&quot;&quot;javascript:getTable('&quot; + csvname + &quot;','&quot; + cstr(pos-1) + &quot;','&quot; + token + &quot;')&quot;&quot;&gt;&lt;span&gt;Précédent&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&quot;)
    end if
    for k=1 to (int(len(data)/nbLigne))+1
      tableData.write(&quot;                  &lt;li&gt;&lt;a href=&quot;&quot;javascript:getTable('&quot; + csvname + &quot;','&quot; + cstr(k) + &quot;','&quot; + token + &quot;')&quot;&quot; &quot;&amp;SimpleIf(k=pos,&quot;class=&quot;&quot;active&quot;&quot;&quot;,&quot;&quot;)&amp;&quot; &gt;&lt;span&gt;&quot;&amp;k&amp;&quot;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&quot;)
    next
    if pos*nbligne&lt;len(data) then
      tableData.write(&quot;                  &lt;li&gt;&lt;a href=&quot;&quot;javascript:getTable('&quot; + csvname + &quot;','&quot; + cstr(pos+1) + &quot;','&quot; + token + &quot;')&quot;&quot;&gt;&lt;span&gt;Suivant&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&quot;)
    end if
      tableData.write(&quot;              &lt;/ul&gt;&quot;)
    end if
      tableData.write(&quot;           &lt;/div&gt;&quot;)
      tableData.write(&quot;     &lt;/tr&gt;&quot;)
      tableData.write(&quot;   &lt;/tfoot&gt;&quot;)
      tableData.write(&quot;   &lt;tbody&gt;&quot;)
   if (pos-1)*nbligne+nbligne&gt;len(data) then
     max = len(data)-1
   else
     max = (pos-1)*nbligne+nbligne-1
   end if
   for i=(pos-1)*nbligne to max
      line = data(i)
      tableData.write(&quot;      &lt;tr&gt;&quot;) 
      for j=0 to len(header)-1
        if j=selcol then
          if mode=&quot;normal&quot; then
              tableData.write(&quot;        &lt;td&gt;&lt;INPUT type='checkbox' name='&quot;+csvname+&quot;:&quot;+cstr(line(j))+&quot;'&gt;&lt;/INPUT&gt;&lt;/td&gt;&quot;)
          else
              tableData.write(&quot;        &lt;td&gt;&lt;/td&gt;&quot;)
          end if
        else
          tableData.write(&quot;        &lt;td &quot;+SimpleIf(mode=&quot;normal&quot;,&quot;&quot;,&quot;style='padding-left:10px; color:midnightblue;'&quot;)+&quot; &gt;&quot;&amp;cstr(line(j))&amp;&quot;&lt;/td&gt;&quot;)
        end if
      next
      tableData.write(&quot;      &lt;/tr&gt;&quot;)
   next
      tableData.write(&quot;   &lt;/tbody&gt;&quot;)
      tableData.write(&quot;&lt;/table&gt;&quot;)
      if not refreshtable then
          tableData.write(&quot;&lt;/div&gt;&quot;)
      end if
   genTable = tableStyle &amp; tableData.getvalue
   
end function

'-------------------------------------- genEditableTable ---------------------------------------
' Allow to generate an editable table with data
' 
'-----------------------------------------------------------------------------------------------


function genEditableTable(header,data,nbLigne,pos,color,csvname,token,editable)

  refreshtable = false
  pos = cint(pos)
  mode = &quot;normal&quot;
  if nbLigne = 0 then
    mode=&quot;full&quot;
    nbligne = len(data)
  end if
  if mode=&quot;normal&quot; then
    if token = &quot;&quot; then
        token = cstr(cint(rnd * 1000))
        key = csvname+&quot;_&quot;+token 
        if dbdictionary(&quot;tabledata_session&quot;)&lt;&gt;&quot;&quot; then
            tabledata_session =  asjson(dbdictionary(&quot;tabledata_session&quot;))
            tabledata_session(key) = now
            dbdictionary(&quot;tabledata_session&quot;) = tojson(tabledata_session)
            set objTimer = getTimer(&quot;Session Clean up&quot;)
            objTimer.is_active=true
        else
            tabledata_session =  Dictionary
            tabledata_session(key) = now
            dbdictionary(&quot;tabledata_session&quot;) = tojson(tabledata_session)
        end if
        dbdictionary(key)= tojson(Dictionary(&quot;header&quot;,header,&quot;data&quot;,data,&quot;nbLigne&quot;,nbLigne,&quot;color&quot;,color,&quot;editable&quot;,editable))
    else
      refreshtable = true
    end if
  else
    token = cstr(cint(rnd * 1000))
  end if
  
  if mode=&quot;normal&quot; then
      colorCss = Dictionary(&quot;blue&quot;,&quot;genTable-blue.css&quot;,&quot;brown&quot;,&quot;genTable-brown.css&quot;,&quot;gray&quot;,&quot;genTable-gray.css&quot;,&quot;green&quot;,&quot;genTable-green.css&quot;,&quot;purple&quot;,&quot;genTable-purple.css&quot;,&quot;red&quot;,&quot;genTable-red.css&quot;)
      if lcase(color) in colorCss then
          tableStyle = &quot;&lt;Style&gt;&quot; &amp; replace(resources.open(colorCss(lcase(color))).getValue,&quot;datagrid&quot;,&quot;datagrid-&quot;+token) &amp; &quot;&lt;/Style&gt;&quot;
      else
          tableStyle = &quot;&lt;Style&gt;&quot; &amp; replace(resources.open(colorCss(&quot;blue&quot;)).getValue,&quot;datagrid&quot;,&quot;datagrid-&quot;+token) &amp; &quot;&lt;/Style&gt;&quot;    
      end if
  end if
  
  set tableData = buffer.create
      if not refreshtable then
          tableData.write(&quot;&lt;div id='datagrid_&quot;+token+&quot;' class='datagrid-&quot;+token+&quot;'&gt;&quot;)
      end if
      tableData.write(&quot;&lt;table &quot;+SimpleIf(mode=&quot;normal&quot;,&quot;&quot;,&quot;style='border:solid 1px #777777; border-collapse:collapse; font-family:verdana; font-size:11px;'&quot;)+&quot; &gt;&quot;)
      tableData.write(&quot;   &lt;thead&gt;&quot;)
      tableData.write(&quot;      &lt;tr &quot;+SimpleIf(mode=&quot;normal&quot;,&quot;&quot;,&quot;style='background-color:lightgrey;'&quot;)+&quot;&gt;&quot;)
      cpt=0
      selcol= -1
    for each col in header
      tableData.write(&quot;         &lt;th&gt;&quot;&amp;cstr(col)&amp;&quot;&lt;/th&gt;&quot;)
      if cstr(col)=&quot;sel&quot; then
        selcol=cpt
      end if
      cpt = cpt + 1
    next
      tableData.write(&quot;      &lt;/tr&gt;&quot;)
      tableData.write(&quot;   &lt;thead&gt;&quot;)
      tableData.write(&quot;   &lt;tfoot&gt;&quot;)
      tableData.write(&quot;      &lt;tr&gt;&quot;)
      tableData.write(&quot;         &lt;td colspan=&quot;&quot;&quot;&amp;cstr(len(header))&amp;&quot;&quot;&quot;&gt;&quot;)
      tableData.write(&quot;            &lt;div id=&quot;&quot;paging&quot;&quot;&gt;&quot;)
    if len(data)&gt;nbligne then
      tableData.write(&quot;               &lt;ul&gt;&quot;)
    if pos&lt;&gt;1 then
      tableData.write(&quot;                  &lt;li&gt;&lt;a href=&quot;&quot;javascript:getTable('&quot; + csvname + &quot;','&quot; + cstr(pos-1) + &quot;','&quot; + token + &quot;')&quot;&quot;&gt;&lt;span&gt;Précédent&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&quot;)
    end if
    for k=1 to (int(len(data)/nbLigne))+1
      tableData.write(&quot;                  &lt;li&gt;&lt;a href=&quot;&quot;javascript:getTable('&quot; + csvname + &quot;','&quot; + cstr(k) + &quot;','&quot; + token + &quot;')&quot;&quot; &quot;&amp;SimpleIf(k=pos,&quot;class=&quot;&quot;active&quot;&quot;&quot;,&quot;&quot;)&amp;&quot; &gt;&lt;span&gt;&quot;&amp;k&amp;&quot;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&quot;)
    next
    if pos*nbligne&lt;len(data) then
      tableData.write(&quot;                  &lt;li&gt;&lt;a href=&quot;&quot;javascript:getTable('&quot; + csvname + &quot;','&quot; + cstr(pos+1) + &quot;','&quot; + token + &quot;')&quot;&quot;&gt;&lt;span&gt;Suivant&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&quot;)
    end if
      tableData.write(&quot;              &lt;/ul&gt;&quot;)
    end if
      tableData.write(&quot;           &lt;/div&gt;&quot;)
      tableData.write(&quot;     &lt;/tr&gt;&quot;)
      tableData.write(&quot;   &lt;/tfoot&gt;&quot;)
      tableData.write(&quot;   &lt;tbody&gt;&quot;)
   if (pos-1)*nbligne+nbligne&gt;len(data) then
     max = len(data)-1
   else
     max = (pos-1)*nbligne+nbligne-1
   end if
   for i=(pos-1)*nbligne to max
      line = data(i)
      tableData.write(&quot;      &lt;tr&gt;&quot;) 
      for j=0 to len(header)-1
        if j=selcol then
          if mode=&quot;normal&quot; then
              tableData.write(&quot;        &lt;td&gt;&lt;INPUT type='checkbox' name='&quot;+csvname+&quot;I&quot;+cstr(line(j))+&quot;'&gt;&lt;/INPUT&gt;&lt;/td&gt;&quot;)
			  lign = cstr(line(j))
          else
              tableData.write(&quot;        &lt;td&gt;&lt;/td&gt;&quot;)
          end if
        else
          tableData.write(&quot;        &lt;td &quot; &amp; SimpleIf(mode=&quot;normal&quot;,&quot;&quot;,&quot;style='padding-left:10px; color:midnightblue;'&quot;)+&quot; &gt;&quot; &amp; SimpleIf(editable(header(j)),&quot;&lt;input class='inputFullWidth ' type='text' name='&quot;+lign+&quot;:&quot;+header(j)+&quot;' value='&quot;+cstr(line(j))+&quot;' onchange='$(&quot;&quot;input[name=&quot;+csvname+&quot;I&quot;+lign+&quot;]&quot;&quot;).attr(&quot;&quot;checked&quot;&quot;,true)'&gt;&quot;,cstr(line(j))) &amp; &quot;&lt;/td&gt;&quot;)
        end if
      next
      tableData.write(&quot;      &lt;/tr&gt;&quot;)
   next
      tableData.write(&quot;   &lt;/tbody&gt;&quot;)
      tableData.write(&quot;&lt;/table&gt;&quot;)
      if not refreshtable then
          tableData.write(&quot;&lt;/div&gt;&quot;)
      end if
   genEditableTable = tableStyle &amp; tableData.getvalue
   
end function

'-------------------------------------- chkFunctionOpt ----------------------------------------------
' Gnerate function for check process
' 
'-----------------------------------------------------------------------------------------------

sub chkFunctionOpt(funcname,parameters)

  if not SessionDictionary(&quot;checkscreen&quot;) then
    paramlist=&quot;&quot;
	for each p in parameters
        if typename(p)=&quot;String&quot; then
            paramlist = paramlist + &quot;&quot;&quot;&quot;+p+&quot;&quot;&quot;,&quot;
		elseif typename(p)=&quot;Boolean&quot; then
			if p then
				paramlist = paramlist + &quot;oui,&quot;
			else 
				paramlist = paramlist + &quot;non,&quot;
			end if
		elseif typename(p)=&quot;Date&quot; then
            paramlist = paramlist + &quot;convertirvers(&quot;&quot;&quot;+ cstr(p) +&quot;&quot;&quot;,&quot;&quot;date&quot;&quot;),&quot;
        else
			paramlist = paramlist + cstr(p) +&quot;,&quot;
		end if
	next
	functoeval = funcname+&quot;(&quot;+mid(paramlist,1,len(paramlist)-1)+&quot;)&quot;
	AppendToArray(SessionDictionary(&quot;checkscreenData&quot;),functoeval)   
  end if

end sub</source>
		
	
		<class_name></class_name>
		
	
		<is_button>0</is_button>
		
	
		<ob_board>0</ob_board>
		
	
		<macros_picture></macros_picture>
		
	
		<description></description>
		
	
		<guid>4409638e-aae9-4cb5-aa1b-ac4f00b7427d</guid>
		
	
		<timer_guid></timer_guid>
		
	
		<custom_event_guid></custom_event_guid>
		
	
		<page></page>
		
	
		<type>library</type>
	</macro>
	
	
	<macro>
		
	
		<name>Permissions</name>
		
	
		<source>'#include(lib_utils)
'#include(lib_dialog_2)

abi = &quot;[{&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: true, &quot;&quot;name&quot;&quot;: &quot;&quot;guid&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;uint16&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_year&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_month&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_day&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;setBirthday&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_email&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;setEmail&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;address&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;addr&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;field&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;getAccess&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;bool&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_firstName&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;setFirstName&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;getLastName&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;address&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;addr&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;field&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;revokeAccess&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;getEmail&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;address&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;addr&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;field&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;grantAccess&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;getPhone&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: true, &quot;&quot;name&quot;&quot;: &quot;&quot;owner&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;address&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_lastName&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;setLastName&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;getFirstName&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;getBirthday&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;uint16&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;year&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;month&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;day&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_phone&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;setPhone&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_guid&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_firstName&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_lastName&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_email&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_phone&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint16&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_birthYear&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_birthMonth&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_birthDay&quot;&quot;}], &quot;&quot;type&quot;&quot;: &quot;&quot;constructor&quot;&quot;, &quot;&quot;payable&quot;&quot;: false}]&quot;

client_host = &quot;10.41.0.16&quot;
client_port = 8545
client_password = &quot;password&quot;

FIRST_NAME = 0
LAST_NAME = 1
EMAIL = 2
PHONE = 3
BIRTHDAY = 4

function read_account
  try
    read_account = tempresources.open(&quot;account&quot;).read()
    logger &quot;Account &quot; &amp; read_account
  catch
    read_account = &quot;&quot;
  end try
end function

function read_contract
try
    read_contract = tempresources.open(&quot;contract&quot;).read()
    logger &quot;Contract &quot; &amp; read_contract
  catch
    read_contract = &quot;&quot;
  end try
end function

account_id = read_account()
contract_id = read_contract()

set myclient = new web3client
myclient.host = client_host
myclient.port = client_port
if account_id &lt;&gt; &quot;&quot; then
  myclient.account = account_id
  myclient.unlock_account(client_password)
end if

args = xml_dialog.get_answer

if &quot;step&quot; in args then
  if args( &quot;step&quot; )&lt;&gt;&quot;&quot; then
    operation_step = args( &quot;step&quot; )
  end if
else
  operation_step =&quot;&quot;
end if

if operation_step = &quot;&quot; then
  operation_step = &quot;Start&quot;
end if

set MyForms = New XMLDialogBuilder

MyForms.addScreen(&quot;NoProfile&quot;)
MyForms.Screen(&quot;NoProfile&quot;).width  = 600
MyForms.Screen(&quot;NoProfile&quot;).Height = 400
MyForms.Screen(&quot;NoProfile&quot;).Title = &quot;Share profile&quot;
MyForms.Screen(&quot;NoProfile&quot;).addComponent(&quot;caption&quot;, &quot;text&quot;)
MyForms.Screen(&quot;NoProfile&quot;).Component(&quot;caption&quot;).value(&quot;You don't have an Identity profile yet. Run MyProfile macro to create it.&quot;)
MyForms.Screen(&quot;NoProfile&quot;).addComponent(&quot;btns&quot;, &quot;btngroup&quot;)
MyForms.Screen(&quot;NoProfile&quot;).Component(&quot;btns&quot;).addBtn(&quot;OK&quot;, &quot;End&quot;)

MyForms.addScreen(&quot;Start&quot;)
MyForms.Screen(&quot;Start&quot;).width  = 600
MyForms.Screen(&quot;Start&quot;).Height = 400
MyForms.Screen(&quot;Start&quot;).Title = &quot;Permissions&quot;
MyForms.Screen(&quot;Start&quot;).addComponent(&quot;caption&quot;, &quot;text&quot;)
MyForms.Screen(&quot;Start&quot;).Component(&quot;caption&quot;).value(&quot;View/Edit permissions of other users to be able to view your account&quot;)
MyForms.Screen(&quot;Start&quot;).addComponent(&quot;account&quot;, &quot;TextBox&quot;)
MyForms.Screen(&quot;Start&quot;).Component(&quot;account&quot;).label(&quot;Other user account :&quot;)
MyForms.Screen(&quot;Start&quot;).addComponent(&quot;btns&quot;, &quot;btngroup&quot;)
MyForms.Screen(&quot;Start&quot;).Component(&quot;btns&quot;).addBtn(&quot;Load&quot;, &quot;Load&quot;)

if instr(operation_step,&quot;&gt;&quot;)&lt;&gt;0 then
  mainStep = split(operation_step,&quot;&gt;&quot;)(0)
  subStep = split(operation_step,&quot;&gt;&quot;)(1)
else
  mainStep = operation_step
  subStep = &quot;&quot;
end if

function load_permissions(account)
    d = new dictionary
    param = Array
    Redim param(1)
    param(0) = account
    param(1) = FIRST_NAME
    d(&quot;firstName&quot;) = myclient.contract_call(abi, contract_id, &quot;getAccess&quot;, param)
    param(1) = LAST_NAME
    d(&quot;lastName&quot;) = myclient.contract_call(abi, contract_id, &quot;getAccess&quot;, param)
    param(1) = EMAIL
    d(&quot;email&quot;) = myclient.contract_call(abi, contract_id, &quot;getAccess&quot;, param)
    param(1) = PHONE
    d(&quot;phone&quot;) = myclient.contract_call(abi, contract_id, &quot;getAccess&quot;, param)
    param(1) = BIRTHDAY
    d(&quot;birthday&quot;) = myclient.contract_call(abi, contract_id, &quot;getAccess&quot;, param)
    load_permissions = d
end function

function show_load_screen
    another_account = args(&quot;account&quot;)

    p = load_permissions(another_account)

    MyForms.addScreen(&quot;Load&quot;)
    MyForms.Screen(&quot;Load&quot;).width  = 600
    MyForms.Screen(&quot;Load&quot;).Height = 400
    MyForms.Screen(&quot;Load&quot;).Title = &quot;Permissions&quot;
    MyForms.Screen(&quot;Load&quot;).addComponent(&quot;caption&quot;, &quot;text&quot;)
    MyForms.Screen(&quot;Load&quot;).Component(&quot;caption&quot;).value(&quot;View/Edit permissions of other users to be able to view your account&quot;)
    MyForms.Screen(&quot;Load&quot;).addComponent(&quot;account&quot;, &quot;TextBox&quot;)
    MyForms.Screen(&quot;Load&quot;).Component(&quot;account&quot;).label(&quot;Other user account :&quot;)
    MyForms.Screen(&quot;Load&quot;).Component(&quot;account&quot;).defaultValue(another_account)

    opt = dictionary
    opt(&quot;firstName&quot;) = &quot;Read First name&quot;
    opt(&quot;lastName&quot;) = &quot;Read Last name&quot;
    opt(&quot;email&quot;) = &quot;Read Email&quot;
    opt(&quot;phone&quot;) = &quot;Read Phone&quot;
    opt(&quot;birthday&quot;) = &quot;Read Birthday&quot;
    selected = &quot;&quot;
    if p(&quot;firstName&quot;) then
      if selected &lt;&gt; &quot;&quot; then
        selected = selected &amp; &quot;,&quot;
      end if
      selected = selected &amp; &quot;firstName&quot;
    end if
    if p(&quot;lastName&quot;) then
      if selected &lt;&gt; &quot;&quot; then
        selected = selected &amp; &quot;,&quot;
      end if
      selected = selected &amp; &quot;lastName&quot;
    end if
    if p(&quot;email&quot;) then
      if selected &lt;&gt; &quot;&quot; then
        selected = selected &amp; &quot;,&quot;
      end if
      selected = selected &amp; &quot;email&quot;
    end if
    if p(&quot;phone&quot;) then
      if selected &lt;&gt; &quot;&quot; then
        selected = selected &amp; &quot;,&quot;
      end if
      selected = selected &amp; &quot;phone&quot;
    end if
    if p(&quot;birthday&quot;) then
      if selected &lt;&gt; &quot;&quot; then
        selected = selected &amp; &quot;,&quot;
      end if
      selected = selected &amp; &quot;birthday&quot;
    end if

    MyForms.Screen(&quot;Load&quot;).addComponent(&quot;permissions&quot;, &quot;CheckBox&quot;)
    MyForms.Screen(&quot;Load&quot;).Component(&quot;permissions&quot;).label(&quot;Current permissions :&quot;)
    MyForms.Screen(&quot;Load&quot;).Component(&quot;permissions&quot;).setOptions(opt)
    if selected &lt;&gt; &quot;&quot; then
      MyForms.Screen(&quot;Load&quot;).Component(&quot;permissions&quot;).setSelected(selected)
    end if
    MyForms.Screen(&quot;Load&quot;).Component(&quot;permissions&quot;).breakline(&quot;true&quot;)
    MyForms.Screen(&quot;Load&quot;).addComponent(&quot;btns&quot;, &quot;btngroup&quot;)
    MyForms.Screen(&quot;Load&quot;).Component(&quot;btns&quot;).addBtn(&quot;Save&quot;, &quot;Save&quot;)
    MyForms.Screen(&quot;Load&quot;).Component(&quot;btns&quot;).addBtn(&quot;Load&quot;, &quot;Load&quot;)

    MyForms.ShowScreen(&quot;Load&quot;)
end function

function set_permission(param, id, currentValue, newValue)
    param(1) = id
    if currentValue &lt;&gt; newValue then
      if newValue then
        myclient.contract_call(abi, contract_id, &quot;grantAccess&quot;, param, 0, true)
      else
        myclient.contract_call(abi, contract_id, &quot;revokeAccess&quot;, param, 0, true)
      end if
    end if
end function

Select case mainStep

  case &quot;Start&quot;
    if contract_id = &quot;&quot; then
      MyForms.ShowScreen(&quot;NoProfile&quot;)
    else
      MyForms.ShowScreen(&quot;Start&quot;)
    end if

  case &quot;Load&quot;
    show_load_screen()

  case &quot;Save&quot;
    another_account = args(&quot;account&quot;)

    p = load_permissions(another_account)

    bFirstName = false
    if args(&quot;permissions[firstName]&quot;) = &quot;on&quot; then
      bFirstName = true
    end if
    bLastName = false
    if args(&quot;permissions[lastName]&quot;) = &quot;on&quot; then
      bLastName = true
    end if
    bEmail = false
    if args(&quot;permissions[email]&quot;) = &quot;on&quot; then
      bEmail = true
    end if
    bPhone = false
    if args(&quot;permissions[phone]&quot;) = &quot;on&quot; then
      bPhone = true
    end if
    bBirthday = false
    if args(&quot;permissions[birthday]&quot;) = &quot;on&quot; then
      bBirthday = true
    end if

    param = Array
    Redim param(1)
    param(0) = another_account

    set_permission(param, FIRST_NAME, p(&quot;firstName&quot;), bFirstName)
    set_permission(param, LAST_NAME, p(&quot;lastName&quot;), bLastName)
    set_permission(param, EMAIL, p(&quot;email&quot;), bEmail)
    set_permission(param, PHONE, p(&quot;phone&quot;), bPhone)
    set_permission(param, BIRTHDAY, p(&quot;birthday&quot;), bBirthday)

    show_load_screen()

end select</source>
		
	
		<class_name></class_name>
		
	
		<is_button>1</is_button>
		
	
		<ob_board>1</ob_board>
		
	
		<macros_picture></macros_picture>
		
	
		<description></description>
		
	
		<guid>dcb37417-3682-42a6-a37b-3de8e7281568</guid>
		
	
		<timer_guid></timer_guid>
		
	
		<custom_event_guid></custom_event_guid>
		
	
		<page>home</page>
		
	
		<type>button</type>
	</macro>
	
	
	<macro>
		
	
		<name>DeleteAccount</name>
		
	
		<source>'#include(lib_utils)
'#include(lib_dialog_2)

args = xml_dialog.get_answer

if &quot;step&quot; in args then
  if args( &quot;step&quot; )&lt;&gt;&quot;&quot; then
    operation_step = args( &quot;step&quot; )
  end if
else
  operation_step =&quot;&quot;
end if

if operation_step = &quot;&quot; then
  operation_step = &quot;Start&quot;
end if

set MyForms = New XMLDialogBuilder

MyForms.addScreen(&quot;Start&quot;)
MyForms.Screen(&quot;Start&quot;).width  = 600
MyForms.Screen(&quot;Start&quot;).Height = 400
MyForms.Screen(&quot;Start&quot;).Title = &quot;Delete account&quot;
MyForms.Screen(&quot;Start&quot;).addComponent(&quot;caption&quot;, &quot;text&quot;)
MyForms.Screen(&quot;Start&quot;).Component(&quot;caption&quot;).value(&quot;Do you really want to delete your account?&quot;)
MyForms.Screen(&quot;Start&quot;).addComponent(&quot;btns&quot;, &quot;btngroup&quot;)
MyForms.Screen(&quot;Start&quot;).Component(&quot;btns&quot;).addBtn(&quot;Yes&quot;, &quot;Yes&quot;)
MyForms.Screen(&quot;Start&quot;).Component(&quot;btns&quot;).addBtn(&quot;No&quot;, &quot;No&quot;)
MyForms.addScreen(&quot;Deleted&quot;)
MyForms.Screen(&quot;Deleted&quot;).width  = 600
MyForms.Screen(&quot;Deleted&quot;).Height = 400
MyForms.Screen(&quot;Deleted&quot;).Title = &quot;Delete account&quot;
MyForms.Screen(&quot;Deleted&quot;).addComponent(&quot;caption&quot;, &quot;text&quot;)
MyForms.Screen(&quot;Deleted&quot;).Component(&quot;caption&quot;).value(&quot;Your account was deleted&quot;)
MyForms.Screen(&quot;Deleted&quot;).addComponent(&quot;timeout&quot;,&quot;Timer&quot;)
MyForms.Screen(&quot;Deleted&quot;).Component(&quot;timeout&quot;).setTimer(&quot;Exit&quot;, 1000)
MyForms.Screen(&quot;Deleted&quot;).addComponent(&quot;btns&quot;, &quot;btngroup&quot;)
MyForms.Screen(&quot;Deleted&quot;).Component(&quot;btns&quot;).addBtn(&quot;OK&quot;, &quot;End&quot;)

if instr(operation_step,&quot;&gt;&quot;)&lt;&gt;0 then
  mainStep = split(operation_step,&quot;&gt;&quot;)(0)
  subStep = split(operation_step,&quot;&gt;&quot;)(1)
else
  mainStep = operation_step
  subStep = &quot;&quot;
end if

Select case mainStep

  case &quot;Start&quot;
    MyForms.ShowScreen(&quot;Start&quot;)
    
  case &quot;Yes&quot;
    try
      tempresources.delete(&quot;account&quot;)
    catch
    end try
    try
      tempresources.delete(&quot;contract&quot;)
    catch
    end try
    try
      tempresources.delete(&quot;transaction&quot;)
    catch
    end try
    MyForms.ShowScreen(&quot;Deleted&quot;)

end select</source>
		
	
		<class_name></class_name>
		
	
		<is_button>1</is_button>
		
	
		<ob_board>1</ob_board>
		
	
		<macros_picture></macros_picture>
		
	
		<description></description>
		
	
		<guid>e240548d-118c-4fab-85f6-3d5495ce152a</guid>
		
	
		<timer_guid></timer_guid>
		
	
		<custom_event_guid></custom_event_guid>
		
	
		<page>home</page>
		
	
		<type>button</type>
	</macro>
	
	
	<macro>
		
	
		<name>ShareProfile</name>
		
	
		<source>'#include(lib_utils)
'#include(lib_dialog_2)

abi = &quot;[{&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: true, &quot;&quot;name&quot;&quot;: &quot;&quot;guid&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;uint16&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_year&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_month&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_day&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;setBirthday&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_email&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;setEmail&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;address&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;addr&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;field&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;getAccess&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;bool&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_firstName&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;setFirstName&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;getLastName&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;address&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;addr&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;field&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;revokeAccess&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;getEmail&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;address&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;addr&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;field&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;grantAccess&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;getPhone&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: true, &quot;&quot;name&quot;&quot;: &quot;&quot;owner&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;address&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_lastName&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;setLastName&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;getFirstName&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;getBirthday&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;uint16&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;year&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;month&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;day&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_phone&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;setPhone&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_guid&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_firstName&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_lastName&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_email&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_phone&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint16&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_birthYear&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_birthMonth&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_birthDay&quot;&quot;}], &quot;&quot;type&quot;&quot;: &quot;&quot;constructor&quot;&quot;, &quot;&quot;payable&quot;&quot;: false}]&quot;

client_host = &quot;10.41.0.16&quot;
client_port = 8545
client_password = &quot;password&quot;

FIRST_NAME = 0
LAST_NAME = 1
EMAIL = 2
PHONE = 3
BIRTHDAY = 4

function read_account
  try
    read_account = tempresources.open(&quot;account&quot;).read()
    logger &quot;Account &quot; &amp; read_account
  catch
    read_account = &quot;&quot;
  end try
end function

function read_contract
try
    read_contract = tempresources.open(&quot;contract&quot;).read()
    logger &quot;Contract &quot; &amp; read_contract
  catch
    read_contract = &quot;&quot;
  end try
end function

account_id = read_account()
contract_id = read_contract()

set myclient = new web3client
myclient.host = client_host
myclient.port = client_port
if account_id &lt;&gt; &quot;&quot; then
  myclient.account = account_id
  myclient.unlock_account(client_password)
end if

args = xml_dialog.get_answer

if &quot;step&quot; in args then
  if args( &quot;step&quot; )&lt;&gt;&quot;&quot; then
    operation_step = args( &quot;step&quot; )
  end if
else
  operation_step =&quot;&quot;
end if

if operation_step = &quot;&quot; then
  operation_step = &quot;Start&quot;
end if

set MyForms = New XMLDialogBuilder

MyForms.addScreen(&quot;NoProfile&quot;)
MyForms.Screen(&quot;NoProfile&quot;).width  = 600
MyForms.Screen(&quot;NoProfile&quot;).Height = 400
MyForms.Screen(&quot;NoProfile&quot;).Title = &quot;Share profile&quot;
MyForms.Screen(&quot;NoProfile&quot;).addComponent(&quot;caption&quot;, &quot;text&quot;)
MyForms.Screen(&quot;NoProfile&quot;).Component(&quot;caption&quot;).value(&quot;You don't have an Identity profile yet. Run MyProfile macro to create it.&quot;)
MyForms.Screen(&quot;NoProfile&quot;).addComponent(&quot;btns&quot;, &quot;btngroup&quot;)
MyForms.Screen(&quot;NoProfile&quot;).Component(&quot;btns&quot;).addBtn(&quot;OK&quot;, &quot;End&quot;)

MyForms.addScreen(&quot;Start&quot;)
MyForms.Screen(&quot;Start&quot;).width  = 600
MyForms.Screen(&quot;Start&quot;).Height = 400
MyForms.Screen(&quot;Start&quot;).Title = &quot;Share profile&quot;
MyForms.Screen(&quot;Start&quot;).addComponent(&quot;caption&quot;, &quot;text&quot;)
MyForms.Screen(&quot;Start&quot;).Component(&quot;caption&quot;).value(&quot;Enter recipient email address and account&quot;)
MyForms.Screen(&quot;Start&quot;).addComponent(&quot;toemail&quot;,&quot;livesearch&quot;)
MyForms.Screen(&quot;Start&quot;).Component(&quot;toemail&quot;).label(&quot;Recipient e-mail :&quot;)
MyForms.Screen(&quot;Start&quot;).Component(&quot;toemail&quot;).sourceURI(&quot;/recipientlivesearch&quot;)
MyForms.Screen(&quot;Start&quot;).addComponent(&quot;account&quot;,&quot;TextBox&quot;)
MyForms.Screen(&quot;Start&quot;).Component(&quot;account&quot;).label(&quot;Recipient account :&quot;)
opt = dictionary
opt(&quot;firstName&quot;) = &quot;Read First name&quot;
opt(&quot;lastName&quot;) = &quot;Read Last name&quot;
opt(&quot;email&quot;) = &quot;Read Email&quot;
opt(&quot;phone&quot;) = &quot;Read Phone&quot;
opt(&quot;birthday&quot;) = &quot;Read Birthday&quot;
MyForms.Screen(&quot;Start&quot;).addComponent(&quot;permissions&quot;, &quot;CheckBox&quot;)
MyForms.Screen(&quot;Start&quot;).Component(&quot;permissions&quot;).label(&quot;Set allowed access :&quot;)
MyForms.Screen(&quot;Start&quot;).Component(&quot;permissions&quot;).setOptions(opt)
MyForms.Screen(&quot;Start&quot;).Component(&quot;permissions&quot;).breakline(&quot;true&quot;)
MyForms.Screen(&quot;Start&quot;).addComponent(&quot;btns&quot;, &quot;btngroup&quot;)
MyForms.Screen(&quot;Start&quot;).Component(&quot;btns&quot;).addBtn(&quot;Share&quot;, &quot;Share&quot;)

MyForms.addScreen(&quot;Done&quot;)
MyForms.Screen(&quot;Done&quot;).width  = 600
MyForms.Screen(&quot;Done&quot;).Height = 400
MyForms.Screen(&quot;Done&quot;).Title = &quot;Share profile&quot;
MyForms.Screen(&quot;Done&quot;).addComponent(&quot;caption&quot;, &quot;text&quot;)
MyForms.Screen(&quot;Done&quot;).Component(&quot;caption&quot;).value(&quot;Email sent&quot;)
MyForms.Screen(&quot;Done&quot;).addComponent(&quot;timeout&quot;,&quot;Timer&quot;)
MyForms.Screen(&quot;Done&quot;).Component(&quot;timeout&quot;).setTimer(&quot;Exit&quot;, 1000)
MyForms.Screen(&quot;Done&quot;).addComponent(&quot;btns&quot;, &quot;btngroup&quot;)
MyForms.Screen(&quot;Done&quot;).Component(&quot;btns&quot;).addBtn(&quot;OK&quot;, &quot;End&quot;)

if instr(operation_step,&quot;&gt;&quot;)&lt;&gt;0 then
  mainStep = split(operation_step,&quot;&gt;&quot;)(0)
  subStep = split(operation_step,&quot;&gt;&quot;)(1)
else
  mainStep = operation_step
  subStep = &quot;&quot;
end if

function load_permissions(account)
    d = new dictionary
    param = Array
    Redim param(1)
    param(0) = account
    param(1) = FIRST_NAME
    d(&quot;firstName&quot;) = myclient.contract_call(abi, contract_id, &quot;getAccess&quot;, param)
    param(1) = LAST_NAME
    d(&quot;lastName&quot;) = myclient.contract_call(abi, contract_id, &quot;getAccess&quot;, param)
    param(1) = EMAIL
    d(&quot;email&quot;) = myclient.contract_call(abi, contract_id, &quot;getAccess&quot;, param)
    param(1) = PHONE
    d(&quot;phone&quot;) = myclient.contract_call(abi, contract_id, &quot;getAccess&quot;, param)
    param(1) = BIRTHDAY
    d(&quot;birthday&quot;) = myclient.contract_call(abi, contract_id, &quot;getAccess&quot;, param)
    load_permissions = d
end function

function set_permission(param, id, currentValue, newValue)
    param(1) = id
    if currentValue &lt;&gt; newValue then
      if newValue then
        myclient.contract_call(abi, contract_id, &quot;grantAccess&quot;, param, 0, true)
      else
        myclient.contract_call(abi, contract_id, &quot;revokeAccess&quot;, param, 0, true)
      end if
    end if
end function

function share_profile(e, mailbox)
    vdomxml = &quot;&lt;CONTAINER name=&quot;&quot;container1&quot;&quot; designcolor=&quot;&quot;84A2F0&quot;&quot; top=&quot;&quot;9&quot;&quot; height=&quot;&quot;443&quot;&quot; width=&quot;&quot;561&quot;&quot; left=&quot;&quot;18&quot;&quot;&gt;&quot;&amp;_
               &quot;  &lt;RICHTEXT name=&quot;&quot;richtext2&quot;&quot; top=&quot;&quot;75&quot;&quot; left=&quot;&quot;37&quot;&quot;/&gt;&quot;&amp;_
               &quot;    &lt;TEXT name=&quot;&quot;text1&quot;&quot; top=&quot;&quot;23&quot;&quot; value=&quot;&quot;Loading&quot;&quot; width=&quot;&quot;185&quot;&quot; fontsize=&quot;&quot;20&quot;&quot; left=&quot;&quot;125&quot;&quot;/&gt;&quot;&amp;_
               &quot;&lt;/CONTAINER&gt;&quot;
    myguid = generateguid()        
    e.dynamic = true
    e.auth = &quot;internal&quot;
    e.session_token = &quot;&quot;
    e.login_container = &quot;5073ff75-da99-44fb-a5d7-e44e5ab28598&quot;
    e.login_method = &quot;login&quot;
    e.get_container = &quot;5073ff75-da99-44fb-a5d7-e44e5ab28598&quot;
    e.get_method = &quot;call_macro&quot;
    e.get_data = &quot;{&quot;&quot;plugin_guid&quot;&quot;: &quot;&quot;6787f2ab-39ff-4dbc-9d1a-04a6ee684857&quot;&quot;, &quot;&quot;async&quot;&quot;: 0, &quot;&quot;data&quot;&quot;: {&quot;&quot;contract&quot;&quot;: &quot;&quot;&quot; + contract_id +&quot;&quot;&quot;}, &quot;&quot;name&quot;&quot;: &quot;&quot;loaddata&quot;&quot;}&quot;
    e.api_server = &quot;localhost&quot;
    e.app_id = &quot;7f459762-e1ba-42d3-a0e1-e74beda2eb85&quot;
    e.vdomxml_data = vdomxml
    e.eac_token = myguid
    e.eac_method = &quot;update&quot;
    'logger e.get_wholexml()

    Appinmail.acl.registerEac(myguid)
    toEmails = Appinmail.utils.parseEmails(args)
    Appinmail.acl.add(myguid, toEmails, &quot;r&quot;)
    users = Appinmail.users.resolve(toEmails)
    for each user in users
        try
            e.send(mailbox, user(&quot;login&quot;), &quot;&quot;, &quot;&quot;, user(&quot;short_login&quot;) &amp; &quot; Identity profile&quot;, &quot;&quot;)
        catch
        end try
    next
end function

Select case mainStep

  case &quot;Start&quot;
    if contract_id = &quot;&quot; then
      MyForms.ShowScreen(&quot;NoProfile&quot;)
    else
      MyForms.ShowScreen(&quot;Start&quot;)
    end if

  case &quot;Share&quot;
    another_account = args(&quot;account&quot;)
    p = load_permissions(another_account)

    bFirstName = false
    if args(&quot;permissions[firstName]&quot;) = &quot;on&quot; then
      bFirstName = true
    end if
    bLastName = false
    if args(&quot;permissions[lastName]&quot;) = &quot;on&quot; then
      bLastName = true
    end if
    bEmail = false
    if args(&quot;permissions[email]&quot;) = &quot;on&quot; then
      bEmail = true
    end if
    bPhone = false
    if args(&quot;permissions[phone]&quot;) = &quot;on&quot; then
      bPhone = true
    end if
    bBirthday = false
    if args(&quot;permissions[birthday]&quot;) = &quot;on&quot; then
      bBirthday = true
    end if

    param = Array
    Redim param(1)
    param(0) = another_account

    set_permission(param, FIRST_NAME, p(&quot;firstName&quot;), bFirstName)
    set_permission(param, LAST_NAME, p(&quot;lastName&quot;), bLastName)
    set_permission(param, EMAIL, p(&quot;email&quot;), bEmail)
    set_permission(param, PHONE, p(&quot;phone&quot;), bPhone)
    set_permission(param, BIRTHDAY, p(&quot;birthday&quot;), bBirthday)

    Set e = new EAC 
    share_profile(e, ProMail.selected_mailbox)
    MyForms.ShowScreen(&quot;Done&quot;)

end select</source>
		
	
		<class_name></class_name>
		
	
		<is_button>1</is_button>
		
	
		<ob_board>3</ob_board>
		
	
		<macros_picture></macros_picture>
		
	
		<description></description>
		
	
		<guid>52ae3a82-e891-44e1-823b-474d63a4a20b</guid>
		
	
		<timer_guid></timer_guid>
		
	
		<custom_event_guid></custom_event_guid>
		
	
		<page>home</page>
		
	
		<type>button</type>
	</macro>
	
	
	<macro>
		
	
		<name>API</name>
		
	
		<source>abi = &quot;[{&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: true, &quot;&quot;name&quot;&quot;: &quot;&quot;guid&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;uint16&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_year&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_month&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_day&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;setBirthday&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_email&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;setEmail&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;address&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;addr&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;field&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;getAccess&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;bool&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_firstName&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;setFirstName&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;getLastName&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;address&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;addr&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;field&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;revokeAccess&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;getEmail&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;address&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;addr&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;field&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;grantAccess&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;getPhone&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: true, &quot;&quot;name&quot;&quot;: &quot;&quot;owner&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;address&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_lastName&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;setLastName&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;getFirstName&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;getBirthday&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;uint16&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;year&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;month&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;day&quot;&quot;}], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_phone&quot;&quot;}], &quot;&quot;constant&quot;&quot;: false, &quot;&quot;name&quot;&quot;: &quot;&quot;setPhone&quot;&quot;, &quot;&quot;outputs&quot;&quot;: [], &quot;&quot;payable&quot;&quot;: false, &quot;&quot;type&quot;&quot;: &quot;&quot;function&quot;&quot;}, {&quot;&quot;inputs&quot;&quot;: [{&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_guid&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_firstName&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_lastName&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_email&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;string&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_phone&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint16&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_birthYear&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_birthMonth&quot;&quot;}, {&quot;&quot;type&quot;&quot;: &quot;&quot;uint8&quot;&quot;, &quot;&quot;name&quot;&quot;: &quot;&quot;_birthDay&quot;&quot;}], &quot;&quot;type&quot;&quot;: &quot;&quot;constructor&quot;&quot;, &quot;&quot;payable&quot;&quot;: false}]&quot;

client_host = &quot;10.41.0.16&quot;
client_port = 8545
client_password = &quot;password&quot;

FIRST_NAME = 0
LAST_NAME = 1
EMAIL = 2
PHONE = 3
BIRTHDAY = 4

function read_account
  try
    read_account = tempresources.open(&quot;account&quot;).read()
    logger &quot;Account &quot; &amp; read_account
  catch
    read_account = &quot;&quot;
  end try
end function

account_id = read_account()

set myclient = new web3client
myclient.host = client_host
myclient.port = client_port
if account_id &lt;&gt; &quot;&quot; then
  myclient.account = account_id
  myclient.unlock_account(client_password)
end if

args = event.data
contract = args(&quot;additional&quot;)(&quot;contract&quot;)

function read_profile(client, contract_id)
  d = new dictionary
  d(&quot;firstName&quot;) = client.contract_call(abi, contract_id, &quot;getFirstName&quot;)
  d(&quot;lastName&quot;) = client.contract_call(abi, contract_id, &quot;getLastName&quot;)
  d(&quot;email&quot;) = client.contract_call(abi, contract_id, &quot;getEmail&quot;)
  d(&quot;phone&quot;) = client.contract_call(abi, contract_id, &quot;getPhone&quot;)
  birthday = client.contract_call(abi, contract_id, &quot;getBirthday&quot;)
  d(&quot;birthday&quot;) = birthday(2) &amp; &quot;.&quot; &amp; birthday(1) &amp; &quot;.&quot; &amp; birthday(0)
  read_profile = d
end function

function get_profile
    set EACAnswer = buffer.create

    p = read_profile(myclient, contract)
    htmldata = &quot;First name: &quot; &amp; p(&quot;firstName&quot;) &amp; &quot;&lt;br&gt;Last name: &quot; &amp; p(&quot;lastName&quot;) &amp; &quot;&lt;br&gt;E-mail: &quot; &amp; p(&quot;email&quot;) &amp; &quot;&lt;br&gt;Phone: &quot; &amp; p(&quot;phone&quot;) &amp; &quot;&lt;br&gt;Birthday: &quot; &amp; p(&quot;birthday&quot;)

    EACAnswer.write(&quot;  &lt;WHOLEXML Content=&quot;&quot;dynamic&quot;&quot; SessionToken=&quot;&quot;&quot;&quot; Auth=&quot;&quot;internal&quot;&quot;&gt;&quot;)
    EACAnswer.write (&quot;&lt;EVENTS&gt;&quot;)
    EACAnswer.write (&quot;&lt;/EVENTS&gt;&quot;)
    EACAnswer.write (&quot; &lt;VDOMXML&gt;&quot;)
    EACAnswer.write (&quot; &lt;![CDATA[&quot;)
    EACAnswer.write (&quot;&lt;CONTAINER name=&quot;&quot;container1&quot;&quot; backgroundcolor=&quot;&quot;DFDBE8&quot;&quot; designcolor=&quot;&quot;84A2F0&quot;&quot; top=&quot;&quot;0&quot;&quot; height=&quot;&quot;500&quot;&quot; width=&quot;&quot;600&quot;&quot; left=&quot;&quot;0&quot;&quot;&gt;&quot;)
    EACAnswer.write (&quot;    &lt;RICHTEXT name=&quot;&quot;richtext2&quot;&quot; top=&quot;&quot;20&quot;&quot; left=&quot;&quot;200&quot;&quot; value=&quot;&quot;Identity profile data&quot;&quot;/&gt;&quot;)
    EACAnswer.write (&quot;    &lt;HYPERTEXT name=&quot;&quot;text1&quot;&quot; left=&quot;&quot;15&quot;&quot; top=&quot;&quot;50&quot;&quot; width=&quot;&quot;500&quot;&quot; height=&quot;&quot;400&quot;&quot;&gt;&quot;)
    EACAnswer.write (&quot;        &lt;Attribute Name=&quot;&quot;htmlcode&quot;&quot;&gt;&quot;)
    EACAnswer.write (&quot;            &lt;![CDATA[&quot; &amp; htmldata &amp; &quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;]]]]&gt;&lt;![CDATA[&gt;&quot;)
    EACAnswer.write (&quot;        &lt;/Attribute&gt;&quot;)
    EACAnswer.write (&quot;    &lt;/HYPERTEXT&gt;&quot;)
    EACAnswer.write (&quot;&lt;/CONTAINER&gt;&quot;)
    EACAnswer.write (&quot; ]]&gt;&quot;)
    EACAnswer.write (&quot; &lt;/VDOMXML&gt;&quot;)
    EACAnswer.write (&quot;&lt;/WHOLEXML&gt;&quot;)
    logger (EACAnswer.getValue)
    
    get_profile = EACAnswer.getValue()
end function

result = get_profile()
response.write(result)</source>
		
	
		<class_name>VEE_CustomEvent</class_name>
		
	
		<is_button>0</is_button>
		
	
		<ob_board>0</ob_board>
		
	
		<macros_picture></macros_picture>
		
	
		<description></description>
		
	
		<guid>03381f55-010d-46b4-a869-1386e298ec6c</guid>
		
	
		<timer_guid></timer_guid>
		
	
		<custom_event_guid>c957ee1c-d5a2-40c1-a04b-1bdbb74b710a</custom_event_guid>
		
	
		<page></page>
		
	
		<type>event</type>
	</macro>
</plugin>
